var WSB;(function(n){var t;(function(t){var i;(function(i){function l(){var n;if((n=e())!==null&&n!==void 0)return n.isDarkMode}function a(){var n;return((n=e())===null||n===void 0?void 0:n.errorBoundaryResetKey)||0}function r(){const{mainPageState:n}=o();return n.mainPageData}function v(){const{mainPageState:n}=o();return n.mainPageLayout}function y(){var n;if((n=r())!==null&&n!==void 0)return n.dynamicAnswer}function h(n){var t;const i=(t=r())===null||t===void 0?void 0:t.feedAnswers;return i?React.useMemo(()=>i.filter(t=>t.answerPlacement==n),[i,n]):[]}function s(){return h("Default")}function p(){return h("Hero")}function w(){var n;if((n=r())!==null&&n!==void 0)return n.learningAnswer}function b(){var n;if((n=r())!==null&&n!==void 0)return n.popularSearchesAnswer}function k(){const n=s();return n.find(n=>n.answerPlacement=="Hero")}function d(){var n;if((n=r())!==null&&n!==void 0)return n.acronymsAnswer}function g(){var n;if((n=r())!==null&&n!==void 0)return n.dynamicAnswerState}function nt(){var n;if((n=r())!==null&&n!==void 0)return n.eduAssignmentAnswer}function tt(){var n;if((n=r())!==null&&n!==void 0)return n.eduClassAnswer}function it(n){var t,i,r;switch(n){case"MyOrgChart":return(t=e())===null||t===void 0?void 0:t.isMyOrgChartExpanded;case"EduClasses":return(i=e())===null||i===void 0?void 0:i.isEduClassesExpanded;case"EduAssignments":return(r=e())===null||r===void 0?void 0:r.isEduAssignmentsExpanded}}function c(){var n,i;return(i=(n=e())===null||n===void 0?void 0:n.blendMode)!==null&&i!==void 0?i:t.DEFAULT_BLEND_MODE}function rt(){var n;if((n=r())!==null&&n!==void 0)return n.eduCardAnswer}function ut(){var n;if((n=r())!==null&&n!==void 0)return n.recommendedPeopleAnswer}function ft(){var n;if((n=r())!==null&&n!==void 0)return n.myOrgChart}function et(){var n;if((n=oi())!==null&&n!==void 0)return n.recommendedPeoplePaginationSetting}function ot(){return n.msbDsbHost.isConsumerContentEnabled()}function st(){const n=u();return React.useCallback((i,r)=>n(t.DataContext.setWsbRequeryAction(i,r)),[])}function ht(n){const i=u();return React.useCallback(r=>{switch(n){case"MyOrgChart":i(t.DataContext.setMyOrgChartExpansionAction(r));break;case"EduClasses":i(t.DataContext.setEduClassesExpansionAction(r));break;case"EduAssignments":i(t.DataContext.setEduAssignmentsExpansionAction(r))}},[])}function ct(){const n=u();return React.useCallback((i,r,u)=>{n(t.DataContext.dismissAnswerAction(i,r,u))},[])}function lt(){const n=u();return React.useCallback((i,r)=>{n(t.DataContext.hideAnswerAction(i,r))},[])}function at(){const n=u();return React.useCallback(i=>{n(t.DataContext.launchUriAction(i))},[])}function vt(){const n=u();return React.useCallback(i=>{n(t.DataContext.launchProactiveWorkSearch(i))},[])}function yt(){const n=u();return React.useCallback(()=>{n(t.DataContext.forceDSBRefreshAction())},[])}function pt(){const n=u();return React.useCallback((i,r)=>{n(t.DataContext.navigatePageAction(i,r))},[])}function wt(){const n=u();return React.useCallback(i=>{n(t.DataContext.setLastSelectedScopeAction(i))},[])}function bt(){const{state:{imageOfTheDay:i},dispatch:r}=f(),n=i.imageOfTheDay;return React.useEffect(()=>{n===undefined&&r(t.DataContext.fetchImageOfTheDayAction())},[n]),n}function kt(n){const{state:{personPhotos:r},dispatch:u}=f();if(!n)return null;const i=r[n];return React.useEffect(()=>{i===undefined&&u(t.DataContext.fetchPersonPhotoAction(n))},[i]),(i===null||i===void 0?void 0:i.imageInBase64)||null}function dt(){const{state:{m365AppsState:i},dispatch:r}=f(),n=i.appStateList;return React.useEffect(()=>{n===undefined&&r(t.DataContext.fetchM365AppStateAction())},[n]),n||null}function gt(n){const{state:{groupPhotos:r},dispatch:u}=f();if(!n)return null;const i=r[n];return React.useEffect(()=>{i===undefined&&u(t.DataContext.fetchGroupPhotoAction(n))},[i]),i===null||i===void 0?void 0:i.imageInBase64}function ni(n,i="Medium"){const{itemId:u}=n;if(!u)return null;const{state:{feedItemPreviews:e},dispatch:o}=f(),r=e[u];return React.useEffect(()=>{r===undefined&&o(t.DataContext.fetchFeedItemPreviewAction(n,i))},[r]),(r===null||r===void 0?void 0:r.imageInBase64)||null}function ti(n){const{state:{fileIcons:r},dispatch:u}=f();if(!n)return t.DEFAULT_FILE_ICON;const i=r[n];return React.useEffect(()=>{i===undefined&&u(t.DataContext.fetchFileIconAction(n))},[i]),i||t.DEFAULT_FILE_ICON}function ii(n){const{state:{fluentIconSvgHtmls:r},dispatch:u}=f();if(!n)return null;const i=r[n];return React.useEffect(()=>{i===undefined&&u(t.DataContext.fetchFluentIconSvgHtmlAction(n))},[i]),i}function ri(){const{chatUpsellState:n}=o();return n}function ui(){const t=c()==="Blended";return n.config.msbDsbHidePeopleSearchBox||t}function fi(){const t=n.msbDsbHost.getLocString("CompanyNamePlaceholder");return n.msbHost.getTenantName()||t}function ei(){const t=s();return n.msbDsbHost.isWideLayoutEnabled()&&t.length>0}function e(){const{uiOptions:n}=o();return n}function oi(){const{paginationSettings:n}=o();return n}function o(){const{state:n}=f();return n}function u(){const{dispatch:n}=f();return n}function f(){return React.useContext(t.DataContext.ViewDataContext)}i.useIsDarkMode=l;i.useErrorBoundaryResetKey=a;i.useMainPageData=r;i.useMainPageLayout=v;i.useDynamicAnswer=y;i.useFeedAnswers=s;i.useHeroAnswers=p;i.useLearningAnswer=w;i.usePopularSearchesAnswer=b;i.useHeroAnswer=k;i.useAcronymsAnswer=d;i.useDynamicAnswerState=g;i.useEduAssignmentAnswer=nt;i.useEduClassAnswer=tt;i.useIsElementExpanded=it;i.useBlendMode=c;i.useEduCardAnswer=rt;i.useRecommendedPeopleAnswer=ut;i.useOrgChartAnswer=ft;i.useRecommendedPeoplePaginationSetting=et;i.useIsConsumerContentEnabled=ot;i.useDispatchSetWsbRequeryAction=st;i.useDispatchSetElementExpansionAction=ht;i.useDispatchDismissAnswerAction=ct;i.useDispatchHideAnswerAction=lt;i.useDispatchLaunchUriAction=at;i.useDispatchLaunchProactiveWorkSearchAction=vt;i.useDispatchForceDsbRefreshAction=yt;i.useDispatchNavigatePageAction=pt;i.useDispatchSetLastSelectedScopeAction=wt;i.useImageOfTheDay=bt;i.usePersonPhotoBase64=kt;i.useM365AppStateList=dt;i.useGroupPhotoBase64=gt;i.useFeedItemPreviewBase64=ni;i.useFileIcon=ti;i.useFluentIconSvgHtml=ii;i.useChatUpsell=ri;i.useShouldHideSearchBox=ui;i.useTenantDisplayName=fi;i.useShouldShowWideLayout=ei})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))})(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){i.MainPageTemplate=()=>React.createElement(i.MsbDsbErrorBoundary,{fallback:React.createElement(h,null),fallbackInstrumentSectionName:"MainPageErrorBoundaryFallback",wrappedComponentName:"MainPageTemplateWrapper"},React.createElement(f,null));const f=()=>{const t=i.useMainPageData();if(!t)return null;const r=!n.msbDsbHost.isWideLayoutEnabled(),u=!!n.msbHost.isEduTenant();return u?React.createElement(i.EduMainPageTemplateImpl,null):r?React.createElement(o,null):React.createElement(e,null)},e=()=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("MainPage");const f=i.useMainPageData(),r=i.useDynamicAnswerState(),u=i.useShouldShowWideLayout();React.useEffect(()=>{n.msbDsbHost.updateInteractionModel()},[f]);n.msbDsbHost.setWideModeStyle(!!u);const e=r===null||r===void 0?void 0:r.isAnswerStatusSucceeded;return React.createElement("div",{className:"msbdsb-mp","data-id":t.MAINPAGE_CONTAINER_ID},React.createElement(i.HeaderSection,null),React.createElement("div",{className:"msbdsb-mp-content",id:t.MAINPAGE_CONTAINER_SCROLL},u&&React.createElement(c,null),!u&&(e?React.createElement(l,null):React.createElement(a,null))))},o=()=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("MainPage");const u=i.useMainPageData(),r=i.useMainPageLayout();if(r.length==0)throw new Error("Empty main page layout");return React.useEffect(()=>{n.msbDsbHost.updateInteractionModel()},[u]),React.createElement("div",{className:"msbdsb-mp","data-id":t.MAINPAGE_CONTAINER_ID},React.createElement(i.HeaderSection,null),React.createElement("div",{className:"msbdsb-mp-content",id:t.MAINPAGE_CONTAINER_SCROLL},r.map(n=>React.createElement(s,{component:n,key:n}))))},s=({component:t})=>{switch(t){case"SearchBox":return i.useShouldHideSearchBox()?null:React.createElement(i.WorkSearchBox,{isIndependent:!0});case"ScopeSwitch":return React.createElement(i.ScopeEntrySection,null);case"M365AppList":return React.createElement(i.M365AppList,null);case"Feed":return React.createElement(i.MicrosoftFeedCard,null);case"FileHero":return React.createElement(i.HeroSection,null);case"RecommendedPeople":return React.createElement(i.RecommendedPeopleSection,null);case"OrgChart":return React.createElement(i.OrgChart,{isIndependent:!0});case"Dynamic":return React.createElement(i.DynamicAnswerCard,null);case"SearchSuggestions":return React.createElement(u,null);case"PopularSearch":return React.createElement(i.PopularTenantSearchesCard,null);case"Acronyms":return React.createElement(i.AcronymsCard,null);case"WorkChatCard":return React.createElement(i.WorkChatCard,{chatEligibility:n.msbHost.getChatEligibility()});default:return null}},h=()=>React.createElement("div",{className:"msbdsb_mainpage_fallback_boundary msbdsb-mp-content"},React.createElement(i.MsbDsbErrorBoundaryDefaultFallback,null)),c=()=>React.createElement(React.Fragment,null,React.createElement("div",{className:"left-col"},React.createElement(i.DynamicAnswerCard,null),React.createElement(i.MicrosoftFeedCard,null)),React.createElement(r,{isOnDsbTop:!1})),l=()=>{const n=i.useDynamicAnswerState();return React.createElement(React.Fragment,null,React.createElement(i.DynamicAnswerCard,null),!(n===null||n===void 0?void 0:n.isAnswerM365Content)&&React.createElement(i.MicrosoftFeedCard,null),React.createElement(r,{isOnDsbTop:!1}))},a=()=>React.createElement(React.Fragment,null,React.createElement(r,{isOnDsbTop:!0}),React.createElement(i.MicrosoftFeedCard,null)),r=({isOnDsbTop:t})=>{const e=i.useShouldShowWideLayout(),o=e?"right-col":"msbdsb_card_background",s=i.useHeroAnswers(),r=n.config.msbDsbFileHero&&s.length>0&&!e&&t,f=i.useShouldHideSearchBox();return React.createElement("div",{className:o},r?React.createElement("div",null,f?null:React.createElement(i.WorkSearchBox,{isIndependent:!0}),React.createElement(i.HeroSection,null)):undefined,n.msbDsbHost.isPeopleExplanationEnabled()?React.createElement(i.SplitPeopleSection,{hidePeopleSearchBox:r||f}):React.createElement(i.PeopleCard,{hideSearchBox:r||f}),React.createElement(u,null))},u=()=>{var t;const r=i.useShouldShowWideLayout(),u=!r,f=r;return React.createElement(React.Fragment,null,((t=n.msbHost.msbWorkChatUtils)===null||t===void 0?void 0:t.validChatEligibilityStateForCard())&&React.createElement(i.WorkChatCard,{chatEligibility:n.msbHost.getChatEligibility()}),u?React.createElement(i.AcronymsCard,null):undefined,f?React.createElement(i.PopularTenantSearchesCard,null):undefined)}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){const e=6,o=4,s="https://www.bing.com/th?id=ODSWG.b012cfe4-e2fc-482a-a28e-2efadac0fdf3",h="https://www.bing.com/th?id=ODSWG.7336a8ee-7373-4f81-8d7e-5b15cf0d4146";i.PeopleCard=({hideSearchBox:t})=>{const r=i.useTenantDisplayName(),u=n.msbDsbHost.getLocString("PeopleCardTitle",r),f=i.useRecommendedPeopleAnswer(),e=i.useOrgChartAnswer();return React.createElement("div",{className:"msbdsb-mp-ppl","data-region":"PeopleSection",role:"group","aria-label":u},!t&&React.createElement(i.WorkSearchBox,null),(f||e)&&React.createElement("div",{className:"msbdsb_people_box_content"},React.createElement(i.RecommendedPeople,null),React.createElement(i.OrgChart,null)))};i.SplitPeopleSection=({hidePeopleSearchBox:n})=>{const t=i.useRecommendedPeopleAnswer();return React.createElement(React.Fragment,null,!n&&React.createElement(i.WorkSearchBox,{isIndependent:!0}),t&&React.createElement(i.RecommendedPeopleSection,null),React.createElement(i.OrgChart,{isIndependent:!0}))};i.WorkSearchBox=({isIndependent:n})=>React.createElement(i.MsbDsbErrorBoundary,{wrappedComponentName:"WorkSearchBox"},React.createElement(c,{isIndependent:n}));const c=({isIndependent:r})=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("WorkSearchBox");const{searchBoxInstrumentedItem:f}=i.useMainPageData(),e=i.useDispatchSetWsbRequeryAction(),o=t=>{var i;if((i=t.target)===null||i===void 0?void 0:i.value){const i=n.msbHost.features.isWorkScopeDsbRedirectEnabled()?n.Scope.Work:n.Scope.People;e(t.target.value,i);t.target.value=""}},s=i.useTenantDisplayName(),u=n.msbHost.features.isWorkScopeDsbRedirectEnabled()?n.msbDsbHost.getLocString("WorkSearchPlaceholder"):n.msbDsbHost.getLocString("PeopleSearchPlaceholder",s);return React.createElement(i.WithInstrumentation,{instrumentedItem:f},React.createElement("div",{className:`msb_dsb_people_search ${!!r&&"msb_dsb_independent_searchbox"}`},React.createElement("input",{id:"msbdsb_people_search_box",tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:"msb_dsb_search_box",type:"text","aria-label":u,placeholder:u,onClick:t=>{var i;n.Host.setFocusInWebView("MsbDsb");(i=t.currentTarget)===null||i===void 0?void 0:i.focus()},onChange:o}),React.createElement(n.View.Icon,{icon:{content:"&#xE721",type:2}})))};i.ScopeEntrySection=()=>React.createElement("div",null,React.createElement(u,{scope:n.Scope.People,entryScope:"people",iconSvg:h,buttonText:n.msbDsbHost.getLocString("PeopleScopeOnRampButton")}),React.createElement(u,{scope:n.Scope.Documents,entryScope:"documents",iconSvg:s,buttonText:n.msbDsbHost.getLocString("DocumentScopeOnRampButton")}));const u=({scope:f,entryScope:r,iconSvg:u,buttonText:t})=>{const e=i.useDispatchSetLastSelectedScopeAction(),o=t=>{e(t),n.msbDsbLogger.logClickEvent(`${r}Entry`)};return React.createElement("div",{className:`msb_dsb_scope_entry_button msb_dsb_scope_entry_button_${r}`,onClick:()=>o(f),"aria-label":"onramp-button",role:"button",tabIndex:-1,id:`msb_dsb_scope_entry_button_${r}`},React.createElement(n.View.Icon,{icon:{type:0,content:u}}),React.createElement("div",{className:"msb_dsb_scope_entry_button_text"},t))};i.RecommendedPeopleSection=()=>{const u=i.useRecommendedPeopleAnswer();if(!u)return null;let t="msbdsb-mp-ppl";const r=n.msbDsbHost.isPeopleExplanationEnabled(),f=r?"PeopleExplanationSectionTitle":"recommendedSectionTitle";r&&(t=t+" msbdsb_people_explanations");const e=n.msbDsbHost.getLocString(f);return React.createElement("div",{role:"heading","aria-labelledby":"recommended-section",className:t},React.createElement("div",{className:"msbdsb-recommended-section-header",id:"recommended-section"},React.createElement(i.FluentIcon,{icon:"peopleIcon",additionalCssClasses:"recommended-header-icon"}),e),React.createElement(i.RecommendedPeople,null))};i.RecommendedPeople=()=>{const n=i.useRecommendedPeopleAnswer();if(!n)return null;const{answerType:t}=n;return React.createElement(i.MsbDsbErrorBoundary,{wrappedComponentName:"RecommendedPeople",answerType:t},React.createElement(l,{people:n}))};const l=({people:r})=>{var s,h;t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("RecommendedPeople");const f=i.useRecommendedPeoplePaginationSetting();if(!r.recommendedPeople||r.recommendedPeople.length==0)return null;let e=0,c=r.recommendedPeople.length,u=1,o=0;if(f){const i=r.recommendedPeople.length,l=(s=f.pageSize)!==null&&s!==void 0?s:(h=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbRecommendedPeoplePageSize)!==null&&h!==void 0?h:t.RECOMMENDED_PEOPLE_DISPLAY_COUNT;u=Math.floor(i/l)||1;o=f.currentPageIndex%u;e=Math.min(o*f.pageSize,i-1);c=Math.min(e+f.pageSize,i)}const y=r.recommendedPeople.slice(e,c),p=c-e,l=n.msbDsbHost.isPeopleExplanationEnabled(),w=l?"msb_dsb_peoplehero_container":"msb_dsb_recommendedpeople_container";return React.createElement("div",{className:w},React.createElement("div",{className:"msb_dsb_recommendedpeople_upper"},u>1&&React.createElement(i.PaginationFlippersControl,{paginationId:`RecommendedPeople`,numberOfPages:u,currentPageIndex:o}),React.createElement(i.WithInstrumentation,{instrumentedItem:r.instrumentedItem},React.createElement("ul",{tabIndex:-1,className:`msb_dsb_top_collaborators ${t.MDSB_LIST_CONTAINER_CLASS}`},y.map((t,i)=>{const f=n.msbDsbHost.getLocString("RecentContactsAnnouncementFallback",t.fullName),u=`msbdsb-recommended-person-${e+i}`;return React.createElement(React.Fragment,{key:t.uid},l?React.createElement(v,{person:t,personId:u}):React.createElement(a,{person:t,personId:u,traceId:r===null||r===void 0?void 0:r.traceId,accessibilityProps:{ariaLabel:f,ariaSetPosition:i+1,ariaSetSize:p}}))})))),u>1&&React.createElement(i.PaginationDotList,{paginationId:`RecommendedPeople`,numberOfPages:u,currentPageIndex:o}))},a=({person:t,personId:r,traceId:u,accessibilityProps:n})=>{const{firstName:f,lastName:o,fullName:e,referenceId:s}=t;return React.createElement("li",{key:t.uid},React.createElement(i.WsbPeopleRequery,{id:r,query:e,referenceId:s,answerType:"RecommendedPeople",accessibilityProps:n,isTabbable:!0,traceId:u},React.createElement(i.PersonIcon,{additionalCssClass:"msb_dsb_top_people_icon",person:t}),React.createElement("div",{className:"msb_dsb_recommended_name"},React.createElement("p",null,f!==null&&f!==void 0?f:e),React.createElement("p",{className:"msb_dsb_last_name"},o))))},v=({person:n,personId:t})=>{const{fullName:r,rankingExplanation:u}=n;return React.createElement("div",{id:t,className:"msb_dsb_person_explanation_container"},React.createElement("div",{className:"msb_dsb_person_explanation_header"},React.createElement("div",{className:"msb_dsb_pxai_icon_container"},React.createElement(i.PersonIcon,{additionalCssClass:"msb_dsb_top_people_icon",person:n})),React.createElement("div",{className:"msb_dsb_person_explanation_textsection"},React.createElement("div",{className:"msb_dsb_recommended_name"},React.createElement("p",null,r)),React.createElement("p",{className:"msb_dsb_person_reason_explainer"},u))),React.createElement(i.PeopleCentricSuggestions,{fullName:r,sectionName:"PeopleSection"}))},y=()=>React.createElement("div",{className:"header"},React.createElement("div",{className:"horizontal_stack"},React.createElement("span",{className:"horizontal_stack"},React.createElement(i.Microsoft365Icon,{cssClasses:"company_icon"}),React.createElement("h2",{id:"header_title",className:"header_title"},n.msbDsbHost.getLocString("AppListCardTitle")))));i.M365AppList=()=>{const n=i.useM365AppStateList();return n?React.createElement(i.MsbDsbErrorBoundary,{answerType:undefined,wrappedComponentName:"M365AppListCard"},React.createElement(p,{appStateList:n})):null};const p=({appStateList:i})=>React.createElement("div",{className:"msbdsb_card_background"},React.createElement("div",{className:`msbdsb-mp-feed-card`,role:"feed","aria-label":n.msbDsbHost.getLocString("AppListCardTitle")},React.createElement(y,null),React.createElement("ul",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`msb_dsb_top_collaborators ${t.MDSB_LIST_CONTAINER_CLASS}`},i.map((n,t)=>React.createElement(w,{appState:n,index:t}))))),w=({appState:t,index:i})=>{var r;const u={ariaLabel:t.appItem.id,ariaSetPosition:i+1,ariaSetSize:o};return React.createElement("li",{key:i},React.createElement(b,{id:t.appItem.id,app:t===null||t===void 0?void 0:t.appItem,dataSource:"1",accessibilityProps:u},React.createElement(n.View.Icon,{icon:t===null||t===void 0?void 0:t.appIcon,additionalCssClass:"msb_dsb_recommend_app_list"}),React.createElement("div",{className:"msb_dsb_recommended_app_name"},React.createElement("p",null,(r=t===null||t===void 0?void 0:t.appItem)===null||r===void 0?void 0:r.displayName))))},b=({id:s,accessibilityProps:i,app:u,dataSource:o,additionalCssClasses:r,children:e,childRef:f,isTabbable:h})=>{const c=React.useCallback(()=>{n.Host.launchAppItemAsync(u,o)},[u,o]),l=n.View.classNames("app_list_button",r);return React.createElement("button",{id:s,className:l,tabIndex:h?t.TAB_NAVIGATION_TAB_INDEX:undefined,ref:f,role:"button",onClick:n=>{c(),n.stopPropagation()},"aria-label":i.ariaLabel,"aria-posinset":i.ariaSetPosition,"aria-setsize":i.ariaSetSize},e)},f=({id:e,person:o,referenceId:s,ariaSetPosition:u,ariaSetSize:f,additionalCssClasses:r,traceId:h})=>{if(!o)return null;const{fullName:c,jobTitle:l,uid:p}=o,a=n.msbDsbHost.getLocString("SearchForNarration"),v=l?`${a} ${c}, ${l}`:`${a} ${c}`,w=n.View.classNames("msb-dsb-tooltip msb-dsb-person-with-tooltip",r),y=React.useRef(null),b=i.makeEnterKeyAsClickInRefComponentHandler(y);return React.createElement("div",{id:e,"aria-label":v,"aria-posinset":u,"aria-setsize":f,className:w,onKeyPress:b,role:"button",tabIndex:t.TAB_NAVIGATION_TAB_INDEX},React.createElement("span",{className:"msb-dsb-tooltip-text"},React.createElement("div",null,c),l&&React.createElement("div",null,l)),React.createElement(i.WsbPeopleRequery,{id:`msbdsb_person_${p}`,query:c,referenceId:s,answerType:"OrgChart",accessibilityProps:{ariaLabel:v},childRef:y,traceId:h},React.createElement(i.PersonIcon,{person:o})))},r=({people:l,numLeftAdjusted:s,numRightAdjusted:h,onSeeMoreClick:c,idPrefix:r,isHeroRow:u,isTabbable:o})=>{if(!(l===null||l===void 0?void 0:l.length))return null;const[a,p]=React.useState(l.slice(0,5));i.useEffectSkipFirstRender(()=>{n.msbDsbHost.updateInteractionModel()},[a.length]);const w=React.useRef(null);React.useEffect(()=>{const n=w.current,t=new IntersectionObserver(i=>{const u=i[0],r=n===null||n===void 0?void 0:n.firstElementChild,f=r===null||r===void 0?void 0:r.nextElementSibling;if((u===null||u===void 0?void 0:u.isIntersecting)&&f){const u=n.clientWidth,e=Math.abs(f.getBoundingClientRect().left-r.getBoundingClientRect().left),i=Math.floor(u/e);l.length>i?p(l.slice(0,i-1)):p(l);t.disconnect()}});return n&&t.observe(n),()=>{t.disconnect()}},[l]);const v=l.length-a.length,b=v>0?a.length+1:a.length,y=u?b+1:b,k="msb-dsb-persona dsb-persona-text";return React.createElement("div",{ref:w,tabIndex:o&&t.TAB_NAVIGATION_TAB_INDEX,className:o?t.MDSB_LIST_CONTAINER_CLASS:""},a.map((t,i)=>{const o=s>i,c=i>e-h,l=n.View.classNames(k,o?"leftAdjust":"",c?"rightAdjust":""),a=u?i+2:i+1;return React.createElement(f,{id:`${r}-${i}`,key:t.uid,person:t,ariaSetPosition:a,ariaSetSize:y,additionalCssClasses:l})}),v>0&&React.createElement("div",{className:"msb-dsb-persona"},React.createElement("button",{id:`msbdsb-more-${r}-button`,className:"extra-people-container",tabIndex:t.TAB_NAVIGATION_TAB_INDEX,role:"link","aria-label":n.msbDsbHost.getLocString("MoreButtonLabel",v.toString()),"aria-posinset":y,"aria-setsize":y,onClick:c,"data-msb-dsb-bing-transfer":!0},React.createElement("span",{className:"msb-dsb-extra-people-circle"},"+",v))))};i.OrgChart=({isIndependent:n})=>{const t=i.useOrgChartAnswer();return t?React.createElement(i.MsbDsbErrorBoundary,{wrappedComponentName:"MyOrgChart",answerType:"OrgChart"},React.createElement(k,{orgChart:t,isIndependent:n})):null};const k=({orgChart:u,isIndependent:r})=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("OrgChart");const e="MyOrgChart",f=i.useIsElementExpanded(e),s=i.useDispatchSetElementExpansionAction(e),h={type:2,content:f?"&#xE70E":"&#xE70D"},c=()=>s(!f),o=n.msbDsbHost.getLocString("OrgChartTitle"),l=f?"opened":"collapsed";return i.useEffectSkipFirstRender(()=>{n.msbDsbHost.updateInteractionModel()},[f]),React.createElement("div",{className:`msb_dsb_your_organization  ${!!r&&"msb_dsb_independent_orgchart"}`},React.createElement("button",{id:"msbdsb-orgchart-title",className:"msb_dsb_orgchart_title",tabIndex:t.TAB_NAVIGATION_TAB_INDEX,onClick:c,"aria-label":`${o} dropdown ${l}`,"aria-live":"polite"},React.createElement(n.View.Icon,{additionalCssClass:"msb_dsb_chevron",icon:h}),React.createElement("div",{id:"OrgChartTitle"},o)),f&&React.createElement(d,{orgChart:u}))},d=({orgChart:u})=>{var l,a;const y=i.useDispatchLaunchProactiveWorkSearchAction(),{hero:s,managers:e,peers:o,directReports:h}=u,p=n.msbDsbHost.getLocString("ManagersOrgName",(l=e===null||e===void 0?void 0:e[0])===null||l===void 0?void 0:l.fullName),w=React.useMemo(()=>{var t;return{query:p,intent:"PersonOrgChart",entityId:(t=e===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.userPrincipalName,formCode:n.msbDsbHost.getFormCode()}},[p,(a=e===null||e===void 0?void 0:e[0])===null||a===void 0?void 0:a.userPrincipalName]),g=React.useCallback(()=>{y(w)},[w]),b=s===null||s===void 0?void 0:s.fullName,k=React.useMemo(()=>({query:b,intent:"PersonOrgChart",formCode:n.msbDsbHost.getFormCode()}),[b]),v=React.useCallback(()=>{y(k)},[k]),[c,d]=React.useState(o.slice(0,5));i.useEffectSkipFirstRender(()=>{n.msbDsbHost.updateInteractionModel()},[c.length]);const nt=React.useRef(null);React.useEffect(()=>{const n=nt.current,t=new IntersectionObserver(i=>{const u=i[0],r=n.firstElementChild,f=r===null||r===void 0?void 0:r.nextElementSibling;if((u===null||u===void 0?void 0:u.isIntersecting)&&f){const u=n.clientWidth,e=Math.abs(f.getBoundingClientRect().left-r.getBoundingClientRect().left),i=Math.floor(u/e);o.length>i?d(o.slice(0,i-1)):d(o);t.disconnect()}});return n&&t.observe(n),()=>{t.disconnect()}},[o]);const tt=o.length-c.length,it=tt>0?c.length+1:c.length;return React.createElement(i.WithInstrumentation,{instrumentedItem:u.instrumentedItem},React.createElement("div",{className:"org-chart-container"},(e===null||e===void 0?void 0:e.length)>0&&React.createElement("div",null,React.createElement("div",{className:"dsb-manager-row"},React.createElement(r,{idPrefix:"msbdsb-orgchart-manager",people:e,numLeftAdjusted:2,numRightAdjusted:1,onSeeMoreClick:v,isTabbable:!0})),React.createElement("svg",{role:"img","aria-hidden":"true",focusable:"false",xmlns:"http://www.w3.org/2000/svg",className:"dsb-orgChartLine dsb-svg"},React.createElement("line",{x1:"50%",y1:"0",x2:"50%",y2:"100%"}))),s&&React.createElement("div",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`${t.MDSB_LIST_CONTAINER_CLASS} dsb-hero-row ${(e===null||e===void 0?void 0:e.length)?"":"dsb-hero-row-no-manager"}`},React.createElement(f,{id:"msbdsb-orgchart-hero",ariaSetPosition:1,ariaSetSize:it+1,key:s.uid,person:s,additionalCssClasses:"dsb-hero-circle dsb-hero-persona dsb-persona-text leftAdjust"}),o.length>0&&React.createElement("div",{className:`peerPersonaList ${(e===null||e===void 0?void 0:e.length)>0?"":"noManager"}`},React.createElement("div",{className:"ms-search-orgPersonaListLabel ms-search-text-s dsb-label",id:"heroPersonaListHeader",role:"heading"},n.msbDsbHost.getLocString("SharesSameManager")," (",o.length,")"),React.createElement(r,{idPrefix:"msbdsb-orgchart-peer",isHeroRow:!0,people:o,numLeftAdjusted:1,numRightAdjusted:1,onSeeMoreClick:()=>(e===null||e===void 0?void 0:e.length)>0?g():v()}))),(h===null||h===void 0?void 0:h.length)>0&&React.createElement("div",null,React.createElement("svg",{"aria-hidden":"true",focusable:"false",role:"img",className:"msb-dsb-direct-report-svg",xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%"},React.createElement("path",{fill:"none",d:"M 16 0 L 16 45 L 60 45"})),React.createElement("div",{className:"msb_dsb_direct_reports"},React.createElement("div",{className:"ms-search-orgPersonaListLabel ms-search-text-s dsb-label",id:"reportsPersonaListHeader",role:"heading"},n.msbDsbHost.getLocString("YourDirects")," (",h.length,")"),React.createElement(r,{idPrefix:"msbdsb-orgchart-report",people:h,numLeftAdjusted:1,numRightAdjusted:1,onSeeMoreClick:v,isTabbable:!0})))))};i.AcronymsCard=()=>{const n=i.useAcronymsAnswer();if(!n)return null;const{answerType:t}=n;return React.createElement(i.MsbDsbErrorBoundary,{answerType:t,wrappedComponentName:"AcronymsCard"},React.createElement(g,{acronymsAnswer:n}))};const g=({acronymsAnswer:r})=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("Acronyms");const{acronyms:h,acronymFeaturedSuggestion:c,instrumentedItem:l,subItemInstrumentedItem:a}=r,e=t=>n.msbDsbHost.getLocString("AcronymsSuggestionsQuery",t.abbreviatedName),u=c,f=h.map(t=>({title:t.abbreviatedName,query:e(t),scope:n.Scope.Work})),v=n.msbDsbHost.getLocString("AcronymsCardTitle"),y=n.msbDsbHost.getLocString("AcronymFeaturedCount",u.numberOfResults.toString()),o=i.useDispatchSetWsbRequeryAction(),s=i.useDispatchLaunchProactiveWorkSearchAction(),p=React.createElement(React.Fragment,null,React.createElement("div",{className:"msbdsb_search_suggestions_acronyms_card_subtitle"},n.msbDsbHost.getLocString("AcronymsCardSubtitle")),React.createElement("div",{className:"msbdsb_search_suggestions_acronyms_pills"},f.map((t,r)=>React.createElement(i.WithInstrumentation,{instrumentedItem:a,key:`${t.title}`},React.createElement(i.SuggestionPill,{searchText:t.title,icon:"searchIcon",id:`msbdsb_search_suggestions_acronyms_${r+1}`,key:t.title,accessibilityProps:{ariaSetPosition:r+2,ariaSetSize:f.length+1},onClick:()=>n.config.msbDsbOpenInEdge?s({query:t.query,intent:"Acronym",formCode:n.msbDsbHost.getFormCode()}):o(t.query,t.scope)})))));return React.createElement(i.SearchSuggestionsContainer,{title:v,icon:"acronymsIcon",sectionId:"acronyms",additionalCssClasses:"msbdsb_search_suggestions_acronyms_card"},u&&React.createElement(i.WithInstrumentation,{instrumentedItem:l},React.createElement("button",{id:`msbdsb_search_suggestions_acronyms_${0}`,className:"msbdsb_search_suggestions_acronyms_card_top",tabIndex:t.TAB_NAVIGATION_TAB_INDEX,"aria-label":`${u.abbreviatedName} ${u.displayName}`,"aria-posinset":1,"aria-setsize":f.length+1,onClick:()=>n.config.msbDsbOpenInEdge?s({query:e(u),intent:"Acronym",formCode:n.msbDsbHost.getFormCode()}):o(e(u),n.Scope.Work)},React.createElement("div",{className:"msbdsb_search_suggestions_acronyms_card_top_content"},React.createElement("span",{className:"msbdsb_search_suggestions_acronyms_card_top_title"},u.abbreviatedName),React.createElement("div",null,React.createElement("span",{className:"msbdsb_search_suggestions_acronyms_card_top_displayname"},u.displayName),React.createElement("span",{className:"msbdsb_search_suggestions_acronyms_card_top_displayname_count"},y))))),f.length>0&&p)};i.DynamicAnswerCard=()=>{const n=i.useDynamicAnswer();if(!n)return null;switch(n.answerType){case"MeetingPrep":return React.createElement(i.MeetingPrepCard,{answer:n});case"IndustryNews":return React.createElement(i.IndustryNewsFeed,{answer:n});case"PeopleHighlights":return React.createElement(i.PeopleHighlightsFeed,{answer:n});default:return null}};i.HeroSection=()=>{const n=i.useHeroAnswers();return n.length==0?null:React.createElement(i.MsbDsbErrorBoundary,{wrappedComponentName:"HeroSection"},React.createElement(i.HeroSectionImpl,{heroAnswers:n}))};i.HeroSectionImpl=({heroAnswers:r})=>{const s=r.length,[f,h]=React.useState(n.config.undocked?1.65:1.53);i.useEffectSkipFirstRender(()=>{n.msbDsbHost.updateInteractionModel()},[f]);const u=12,e=React.useRef(null);React.useEffect(()=>{const n=e.current,t=new IntersectionObserver(i=>{const r=i[0],f=_ge("msbdsb-hero-card-1");if((r===null||r===void 0?void 0:r.isIntersecting)&&n&&f){const i=n.offsetWidth+u,r=f.offsetWidth+u;h(i/r);t.disconnect()}});return n&&t.observe(n),()=>{t.disconnect()}},[r]);const o="msbdsb-file-hero-section",c={dsbScenario:"FileHero",tilesToShow:f,showAriaMessage:!1,tileSpacing:u,containerID:o,verticalSpacing:"12px",moveSlides:1,supportLRNav:!0,supportWraparound:!0,instrumentDirection:!0};return React.createElement("div",{"data-msb-dsb-prevent-scroll":!0,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`msbdsb-hero-section ${t.MDSB_LIST_CONTAINER_CLASS}`,id:o,ref:e,role:"feed","aria-label":n.msbDsbHost.getLocString("HeroFilesTitle")},React.createElement(n.View.DSB.Templates.MegaCarouselComponent,Object.assign({},c),r.map((n,t)=>{const r=t+1;return React.createElement(i.HeroCardRouter,{heroAnswer:n,setPosition:r,setSize:s})})))}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){i.EduMainPageTemplateImpl=()=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("EduMainPage");const s=i.useMainPageData(),e=i.useShouldShowWideLayout();React.useEffect(()=>{n.msbDsbHost.updateInteractionModel()},[s]);n.msbDsbHost.setWideModeStyle(!!e);const h=e?"right-col":"",c=e?"left-col":"",l=i.useEduAssignmentAnswer(),a=i.useEduClassAnswer(),o=n.config.msbDsbEnableEduScenario&&(l||a),v=i.useFeedAnswers().length>0,y=i.useIsConsumerContentEnabled(),p=!o&&!v&&y&&!n.config.msbDsbBlendEdu;return React.createElement("div",{className:"msbdsb-mp","data-id":t.MAINPAGE_CONTAINER_ID},React.createElement(i.HeaderSection,null),React.createElement("div",{className:"msbdsb-mp-content",id:t.MAINPAGE_CONTAINER_SCROLL},React.createElement("div",{className:h},React.createElement(u,null),o&&React.createElement(f,null)),p&&React.createElement(r,null),React.createElement("div",{"data-region":"M365",className:c},React.createElement(i.MicrosoftFeedCard,null))))};const r=()=>React.createElement("div",{role:"ImageOfTheDayCard","aria-label":n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.getLocString("ImageOfTheDayCardTitle")},React.createElement(i.ImageOfTheDayCard,null)),u=()=>React.createElement("div",{className:"msbdsb_card_background"},React.createElement("div",{className:"msbdsb-mp-edu-card",role:"EduCard","aria-label":n.msbDsbHost.getLocString("EduCardTitle")},React.createElement(i.EduCard,null))),f=()=>{const t=i.useEduAssignmentAnswer(),r=i.useEduClassAnswer();return React.createElement("div",{"data-region":"Edu"},React.createElement("div",{className:"msbdsb_card_background"},t&&React.createElement(i.EduExpandableCard,{answerType:t.answerType,items:t.entities,elementType:"EduAssignments",instrumentedItem:t.instrumentedItem,subItemInstrumentedItem:t.subItemInstrumentedItem,title:n.msbDsbHost.getLocString("EduAssignmentCardTitle"),cardType:"Assignments",seeMoreQuery:n.Host.getLocString("EduCardAssignmentsQuery"),seeMoreVerticalHash:"EducationAssignment",totalCount:t.totalCount})),React.createElement("div",{className:"msbdsb_card_background"},r&&React.createElement(i.EduExpandableCard,{answerType:r.answerType,items:r.entities,elementType:"EduClasses",instrumentedItem:r.instrumentedItem,subItemInstrumentedItem:r.subItemInstrumentedItem,title:n.msbDsbHost.getLocString("EduClassCardTitle"),cardType:"Classes",seeMoreQuery:n.Host.getEnUsLocString("EduCardClassesQuery"),totalCount:r.totalCount})))}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){function e(n){switch(n){case"Assignments":return React.createElement(i.FluentIcon,{icon:"backpackIcon",additionalCssClasses:"edu_dynamic_section_icon"});case"Classes":default:return React.createElement(i.FluentIcon,{icon:"calendarIcon",additionalCssClasses:"edu_dynamic_section_icon"})}}i.EduExpandableCard=({answerType:n,items:e,elementType:u,instrumentedItem:f,subItemInstrumentedItem:h,title:c,cardType:t,seeMoreQuery:o,seeMoreVerticalHash:s,totalCount:l})=>!e||e.length==0?null:React.createElement(i.MsbDsbErrorBoundary,{answerType:n,wrappedComponentName:"EduExpandableCard"},React.createElement(r,{items:e,elementType:u,instrumentedItem:f,subItemInstrumentedItem:h,title:c,cardType:t,seeMoreQuery:o,seeMoreVerticalHash:s,totalCount:l}));const r=({items:e,elementType:t,instrumentedItem:r,subItemInstrumentedItem:c,title:l,cardType:n,seeMoreQuery:o,seeMoreVerticalHash:h,totalCount:a})=>{const v=i.useIsElementExpanded(t),y=i.useDispatchSetElementExpansionAction(t),p=()=>y(!v);return React.createElement(i.WithInstrumentation,{instrumentedItem:r},React.createElement("div",{className:"msbdsb-mp-edu-dynamic-card",role:"feed","aria-label":l},React.createElement(f,{title:l,isExpanded:v,onToggleClick:p,cardType:n}),v&&React.createElement(React.Fragment,null,e.map((n,t)=>React.createElement(u,{name:n.name,instrumentedItem:n.instrumentedItem,itemId:n.classId,link:n.link,index:t,description:n.description,key:t,isOverDue:n.isOverDue,dueDate:n.dueDate,initials:n.classInitials})),React.createElement(i.WithInstrumentation,{instrumentedItem:c,isBingTransfer:!0},React.createElement(s,{seeMoreQuery:o,seeMoreVerticalHash:h,totalCount:a})))))},u=({name:l,description:t,instrumentedItem:e,itemId:h,link:c,index:u,isOverDue:s,dueDate:r,initials:f})=>{const a=i.useDispatchLaunchUriAction(),v=s?"msbdsb-edu-dynamic-description-pastDue":"msbdsb-edu-dynamic-description-dueDate";return React.createElement(i.WithInstrumentation,{instrumentedItem:e,key:u},React.createElement("div",{className:"msbdsb-mp-edu-dynamic-item",role:"button",key:u,onClick:()=>{c&&a(c)}},React.createElement("div",{className:"msbdsb-edu-dynamic-header"},React.createElement("div",{className:"msbdsb-edu-dynamic-header-icon"},React.createElement("span",{className:"msbdsb-edu-dynamic-icon"},React.createElement(o,{additionalCssClass:"edu_dynamic_icon",classId:h,initials:f}))),React.createElement("div",{className:"msbdsb-edu-dynamic-header-details"},React.createElement("div",{className:"msbdsb-edu-dynamic-title"+((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isEduViewButtonEnabled())?", msbdsb-edu-dynamic-title-with-view-button":"")},l),t&&React.createElement("div",{className:"msbdsb-edu-dynamic-description"},React.createElement("div",{className:"msbdsb-edu-dynamic-description-class"},t)," ","•"," ",React.createElement("div",{className:v},s?n.msbDsbHost.getLocString("PastDue"):r))),(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isEduViewButtonEnabled())?React.createElement("div",{className:"msbdsb-edu-dynamic-header-view-button"},n.msbDsbHost.getLocString("View")):null)))},f=({title:r,isExpanded:t,onToggleClick:i,cardType:n})=>React.createElement("div",{className:"header"},React.createElement("div",{className:"horizontal_stack"},e(n),React.createElement("h2",{id:"header_title",className:"header_title"},r),React.createElement(h,{isExpanded:t,onToggleClick:i})));const o=({classId:r,additionalCssClass:t,initials:u})=>{const f=i.useGroupPhotoBase64(r);if(!f){const r=i.generateColourIndexFromId(u),f=n.View.classNames("edu_class_initials",`profile-color-${r}`,t);return React.createElement("div",{className:f,"aria-hidden":"true"},u)}return React.createElement("img",{className:t,src:`data:image/jpeg;base64,${f}`,alt:n.msbDsbHost.getLocString("ClassIconAltText")})},s=({seeMoreQuery:t,seeMoreVerticalHash:r,totalCount:u})=>{const e=i.useDispatchLaunchProactiveWorkSearchAction();let f=n.msbDsbHost.getLocString("EduSeeMoreLink");u>2&&(f=n.msbDsbHost.getLocString("EduSeeMoreLinkWithCount",(u-2).toString()));const o=i=>{i.preventDefault(),e({query:t,intent:"None",formCode:n.msbDsbHost.getFormCode(!0),verticalHash:r})};return React.createElement("div",{className:"msbdsb-mp-assignment-link"},React.createElement("a",{target:"_blank",href:"#",className:"msbdsb-mp-seemore-link",onClick:o},f))},h=({isExpanded:i,onToggleClick:r})=>{const u={type:2,content:i?"&#xE70E":"&#xE70D"},f=i?"opened":"collapsed";return React.createElement("button",{id:"msbdsb-eduClass-expand-button",className:"msbdsb-edu-expand-button",tabIndex:t.TAB_NAVIGATION_TAB_INDEX,onClick:r,"aria-label":`eduClass dropdown ${f}`},React.createElement(n.View.Icon,{additionalCssClass:"msb-edu-expand",icon:u}))}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){function s(t){switch(t){case"Organizer":return n.msbDsbHost.getLocString("MeetingOrganizer");case"Accepted":return n.msbDsbHost.getLocString("MeetingAccepted");case"Tentative":return n.msbDsbHost.getLocString("MeetingTentative");case"Declined":return n.msbDsbHost.getLocString("MeetingDeclined");case"None":return n.msbDsbHost.getLocString("MeetingNoResponse")}}i.MeetingPrepCard=({answer:n})=>{const{answerType:t,answerId:r}=n;return React.createElement(i.MsbDsbErrorBoundary,{answerId:r,answerType:t,wrappedComponentName:"MeetingPrepCard"},React.createElement(u,{answer:n,isIndependent:!0}))};const u=({answer:r,isIndependent:u})=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("MeetingPrep");const{answerId:c,meetingId:e,answerType:l,subject:a,start:v,topAttendees:y,totalNumberOfAttendees:p,webLink:o,instrumentedItem:w,subItemInstrumentedItem:b,traceId:s}=r,k=t=>{return t.toLocaleString(n.Host.getLanguage(),{hour:"numeric",minute:"numeric"})},h=n.msbDsbHost.getLocString("MeetingUpcomingTitle",k(v)),d=i.useDispatchLaunchUriAction();return React.createElement(i.FeedCardBase,{additionalCssClasses:`msbdsb_selectable msbdsb_meeting_card ${!!u&&"msbdsb_independent_meeting_card"}`,onClick:()=>{n.msbDsbSubstrateLogger.logSearchEntityActions("MeetingPrep",n.getDateWithTimezone(),"entityclicked",e,s),d(o)},isClickable:!0,accessibilityProps:{role:"article",ariaLabel:i.combineLabelAndHintText(h,n.msbDsbHost.getLocString("OpenInOutlookHintText"))},instrumentedItem:w,dismissalInstrumentedItem:b,answerId:c,answerType:l},React.createElement("div",{className:"meeting_info"},React.createElement("div",{className:"upcoming_row horizontal_stack"},React.createElement("div",{className:"horizontal_stack"},React.createElement(i.FluentIcon,{icon:"calendarIcon",additionalCssClasses:"calendar_icon"}),React.createElement("p",{className:"upcoming_meeting_text"},h))),React.createElement("div",{"aria-labelledby":"meeting_title",className:"meeting_details"},React.createElement("rect",{className:"coloured_bar"}),React.createElement("div",{className:"contents"},React.createElement("p",{id:"meeting_title",className:"meeting_title"},a),React.createElement(i.MeetingAttendees,{numberToShow:6,totalNumber:p,attendees:y,meetingUrl:o,referenceId:e,traceId:s})))),React.createElement("hr",{className:"msbdsb_divider"}),React.createElement(f,{answer:r,numberToShow:2}))},f=({answer:r,numberToShow:u})=>{const{fileResults:f,conversationResults:s,totalNumberOfResults:h,webLink:p,meetingId:w}=r;if(!f||!s)return null;const b=h!==null&&h!==void 0?h:f.length+s.length,k=i.useDispatchLaunchUriAction(),c=b-u,l=f.length>0,a=u>f.length&&s.length>0;let v;v=l?a?n.msbDsbHost.getLocString("GenericSuggestionsText"):n.msbDsbHost.getLocString(f.length===1?"SingleFileSuggestionText":"FileSuggestionsText"):n.msbDsbHost.getLocString(s.length===1?"SingleConversationSuggestionText":"ConversationSuggestionsText");const d=()=>{n.msbDsbSubstrateLogger.logSearchEntityActions("MeetingPrep",n.getDateWithTimezone(),"entityclicked",w,r===null||r===void 0?void 0:r.traceId),k(p)},y=React.useRef(null),[g,nt]=i.useSuggestionsInfoTooltipDimensions(y);return React.createElement("div",{ref:y},React.createElement("div",{className:"suggestion_header_container"},React.createElement("span",{className:"suggestion_header"},v),React.createElement(i.SuggestedInfoIcon,{containerLeft:g,containerRight:nt})),React.createElement("div",{className:`suggested_files_list`},l&&f.filter((n,t)=>t<u).map((n,t)=>React.createElement(e,{answer:r,propertyIndex:t,file:n})),a&&s.filter((n,t)=>t<u-f.length).map((n,t)=>React.createElement(o,{answer:r,propertyIndex:t+f.length,message:n})),c>0&&React.createElement("button",{id:"msbdsb-mp-more-suggestions-button",tabIndex:t.TAB_NAVIGATION_TAB_INDEX,"aria-label":i.combineLabelAndHintText(n.msbDsbHost.getLocString("MoreButtonLabel",c.toString()),n.msbDsbHost.getLocString("OpenInOutlookHintText")),className:"more_files_count msbdsb_nested_button",onClick:n=>{n.stopPropagation(),d()}},n.msbDsbHost.getLocString("MoreText",c.toString()))))},e=({propertyIndex:f,file:u,answer:t})=>{const{referenceId:e,title:o,subtitle:s,fileExtension:h,url:c}=u,l=i.useFileIcon(h);return React.createElement(r,{propertyIndex:f,preview:React.createElement(n.View.Icon,{additionalCssClass:"meeting_file_icon",icon:l}),title:o,subtitle:s,url:c,hint:n.msbDsbHost.getLocString("OpenInBrowserHintText"),referenceId:e,answer:t})},o=({propertyIndex:f,message:u,answer:t})=>{const{referenceId:o,from:e,conversationUri:s,subject:h}=u;return React.createElement(r,{propertyIndex:f,title:h,preview:React.createElement(i.MessageSenderPreview,{iconSize:"40",person:e,isEmailMessage:!0}),url:s,hint:n.msbDsbHost.getLocString("OpenInOutlookHintText"),subtitle:e===null||e===void 0?void 0:e.fullName,referenceId:o,answer:t,traceId:t===null||t===void 0?void 0:t.traceId})},r=({propertyIndex:e,title:h,subtitle:s,preview:f,referenceId:o,answer:r,url:l,hint:u,traceId:c})=>{const v=i.useDispatchLaunchUriAction(),y=()=>{n.msbDsbSubstrateLogger.logSearchEntityActions("MeetingPrep",n.getDateWithTimezone(),"relatedentityclicked",o,c),l&&v(l)},a=React.useRef(null);return React.createElement("div",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`${t.MDSB_LIST_CONTAINER_CLASS}`},React.createElement("button",{ref:a,id:`msbdsb-mp-suggested-item-${e}`,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,role:"link","aria-label":i.combineLabelAndHintText(h,u),className:"suggested_entity msbdsb_nested_button msb-dsb-tooltip msb-dsb-item-with-feedback",onClick:n=>{n.stopPropagation(),y()}},React.createElement("div",{className:"suggestion_icon"},f),React.createElement("div",{className:"entity_title"},h,React.createElement("div",{className:"entity_subtitle"},s)),o&&React.createElement(i.FeedbackTooltip,{propertyIndex:e,parentButtonRef:a,answer:r,itemId:o})))};i.MeetingAttendees=({numberToShow:f,attendees:r,meetingUrl:u,totalNumber:o,referenceId:e,traceId:s})=>{if(!r||!f||r.length==0)return null;const k=i.useDispatchLaunchUriAction(),v=["None","Declined","Tentative","Accepted","Organizer"];o=o?o:r.length;const c=Math.min(f,r.length),l=o>c,y=o-c>=9;r=r.sort((n,t)=>v.indexOf(t.status)-v.indexOf(n.status));const p=l?r.slice(0,f-1):r,w=()=>{n.msbDsbSubstrateLogger.logSearchEntityActions("MeetingPrep",n.getDateWithTimezone(),"entityclicked",e,s),k(u)},a=o-p.length,h=l&&f<=r.length?c+1:c,d=n.msbDsbHost.getLocString("OpenInOutlookHintText"),b=i.combineLabelAndHintText(n.msbDsbHost.getLocString("MoreButtonLabel",a.toString()),d);return React.createElement("span",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`msbdsb_status_profile_icon_container ${t.MDSB_LIST_CONTAINER_CLASS}`,"aria-labelledby":"meeting_title"},p.map((n,t)=>React.createElement("div",{className:"status_profile"},React.createElement(i.MeetingAttendeeWithTooltip,{id:`msbdsb-mp-meeting-attendee-${t}`,attendee:n,additionalCssClasses:t<2?"leftAdjust":"",ariaSetPosition:t+1,ariaSetSize:h,traceId:s}))),l&&!y&&React.createElement("button",{id:"msbdsb-mp-more-attendees-button",tabIndex:t.TAB_NAVIGATION_TAB_INDEX,"aria-label":b,className:"more_icon msbdsb_nested_button",onClick:n=>{n.stopPropagation(),w()},"aria-posinset":h,"aria-setsize":h},n.msbDsbHost.getLocString("MoreAttendeesIconText",a.toString())),l&&y&&React.createElement("button",{id:"msbdsb-more-attendees-link",tabIndex:t.TAB_NAVIGATION_TAB_INDEX,role:"link","aria-label":b,className:"more_text msbdsb_hyperlink",onClick:n=>{n.stopPropagation(),w()},"aria-posinset":h,"aria-setsize":h},n.msbDsbHost.getLocString("MoreAttendeesLinkText",a.toString())))};i.MeetingAttendeeWithTooltip=({attendee:e,additionalCssClasses:r,ariaSetPosition:u,ariaSetSize:f,id:o,traceId:h})=>{var c,l;if(!e)return null;const{fullName:a,status:w,uid:v}=e,b=n.View.classNames("msb-dsb-tooltip msb-dsb-person-with-tooltip",r),k=n.View.classNames("meeting_attendee_icon_container msbdsb_nested_button",e.status==="Organizer"?"meeting_organizer":""),y=s(w),p=React.useRef(null),d=i.makeEnterKeyAsClickInRefComponentHandler(p);return React.createElement("div",{id:o,"aria-labelledby":`attendee_${v}`,"aria-posinset":u,"aria-setsize":f,className:b,onKeyPress:d,role:"button",tabIndex:t.TAB_NAVIGATION_TAB_INDEX},React.createElement("div",{className:"msb-dsb-tooltip-text"},React.createElement("div",{className:"msb-dsb-tooltip-lines"},a),React.createElement("div",{className:"msb-dsb-tooltip-lines"},y)),React.createElement(i.WsbPeopleRequery,{id:`attendee_${v}`,query:a,answerType:"MeetingPrep",accessibilityProps:{ariaLabel:`${a}, ${y}`},additionalCssClasses:k,childRef:p,traceId:h},React.createElement(i.PersonIcon,{additionalCssClass:"meeting_attendee_icon",person:e}),React.createElement("div",{className:n.View.classNames("status_circle",(l=(c=e.status)===null||c===void 0?void 0:c.toLowerCase())!==null&&l!==void 0?l:"none")},(e.status=="Accepted"||e.status=="Organizer")&&React.createElement("svg",{role:"img",xmlns:"http://www.w3.org/2000/svg",className:"status_icon",width:"5",height:"5",viewBox:"0 0 4 4",fill:"none"},React.createElement("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.4459 3.5C1.51566 3.5 1.58224 3.48682 1.64566 3.46047C1.70908 3.43411 1.76457 3.39767 1.81213 3.35116L3.85256 1.35581C3.90012 1.3093 3.93658 1.25504 3.96195 1.19302C3.98732 1.13101 4 1.06744 4 1.00233C4 0.934108 3.98652 0.868993 3.95957 0.806977C3.93262 0.744961 3.89616 0.691473 3.85018 0.646512C3.8042 0.60155 3.7495 0.565892 3.68609 0.539535C3.62267 0.513178 3.55608 0.5 3.48633 0.5C3.41974 0.5 3.35394 0.512403 3.28894 0.537209C3.22394 0.562016 3.16766 0.597674 3.1201 0.644186L1.4459 2.2814L0.884661 1.73256C0.783194 1.63333 0.661118 1.58372 0.51843 1.58372C0.448672 1.58372 0.382085 1.5969 0.318668 1.62326C0.255251 1.64961 0.199762 1.68605 0.1522 1.73256C0.104637 1.77907 0.0673802 1.83256 0.0404281 1.89302C0.0134759 1.95349 0 2.01783 0 2.08605C0 2.15116 0.0134759 2.2155 0.0404281 2.27907C0.0673802 2.34264 0.104637 2.39767 0.1522 2.44419L1.07967 3.35116C1.12723 3.39767 1.18351 3.43411 1.24851 3.46047C1.31352 3.48682 1.37931 3.5 1.4459 3.5Z",fill:"white"})),e.status=="Declined"&&React.createElement("svg",{role:"img",xmlns:"http://www.w3.org/2000/svg",className:"status_icon",width:"5",height:"5",viewBox:"0 0 4 4",fill:"none"},React.createElement("path",{d:"M4 0.76396L2.75896 2.00054L3.99461 3.23712L3.23189 4L1.99731 2.76342L0.762726 4L0 3.23712L1.23566 2.00054L0 0.762881L0.762726 0L1.99731 1.23766L3.23189 0L4 0.76396Z",fill:"white"})),e.status=="Tentative"&&React.createElement("svg",{role:"img",className:"status_icon tentative",width:"8",height:"8",viewBox:"0 0 4 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M2 0.75C1.37967 0.75 0.875 1.25467 0.875 1.875C0.875 2.03033 1.00092 2.15625 1.15625 2.15625C1.31158 2.15625 1.4375 2.03033 1.4375 1.875C1.4375 1.56533 1.69033 1.3125 2 1.3125C2.30967 1.3125 2.5625 1.56533 2.5625 1.875C2.5625 2.12 2.51693 2.2568 2.4674 2.34393C2.41591 2.43452 2.34682 2.49723 2.24182 2.58472L2.22267 2.60063C2.12555 2.68119 1.9934 2.7908 1.89287 2.95275C1.78057 3.1337 1.71875 3.35769 1.71875 3.65625V3.84375C1.71875 3.99908 1.84467 4.125 2 4.125C2.15533 4.125 2.28125 3.99908 2.28125 3.84375V3.65625C2.28125 3.43919 2.3249 3.32333 2.3708 3.24939C2.4217 3.16739 2.4893 3.1107 2.60193 3.01684C2.70787 2.92856 2.84971 2.80962 2.95642 2.62189C3.0651 2.4307 3.125 2.1925 3.125 1.875C3.125 1.25467 2.62033 0.75 2 0.75ZM2 5.34375C2.20711 5.34375 2.375 5.17586 2.375 4.96875C2.375 4.76164 2.20711 4.59375 2 4.59375C1.79289 4.59375 1.625 4.76164 1.625 4.96875C1.625 5.17586 1.79289 5.34375 2 5.34375Z",fill:"white"})),e.status=="None"&&React.createElement("div",{className:"unknown_circle"}))))}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){function e(n,t,r,u,f){return i.combineLabelAndHintText(` ${t}, ${u!==null&&u!==void 0?u:""} ${n} ${f!==null&&f!==void 0?f:""}`,r)}const s=4,f=26;i.MicrosoftFeedCard=()=>React.createElement(i.MsbDsbErrorBoundary,{fallback:React.createElement(i.MsbDsbErrorBoundaryDefaultFallback,null),fallbackInstrumentSectionName:"FeedErrorBoundaryFallback",wrappedComponentName:"MicrosoftFeedCard"},React.createElement(h,null));const h=()=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("Feed");const f=i.useLearningAnswer(),h=i.useShouldShowWideLayout();let r=i.useFeedAnswers();const l=Math.max(n.config.msbDsbMaxM365Cards,s),a=h?l:n.config.msbDsbMaxM365Cards;r=r.slice(0,a);const u=r.length>0,e=f&&!u,v=u||e;if(!v)return null;const o=u&&!n.msbHost.isEduTenant();return React.createElement(i.M365HeaderCard,{isCondensed:o},React.createElement(React.Fragment,null,u&&r.filter(n=>n.item).map((n,t)=>{const i=t+1;return React.createElement(c,{feedAnswer:n,key:n.answerId,setPosition:i,setSize:r.length,isCondensedFeed:o})}),e&&React.createElement(i.LearningCard,{learningAnswer:f})))},c=({feedAnswer:n,setPosition:i,setSize:r,isCondensedFeed:t})=>{var u;switch((u=n.item)===null||u===void 0?void 0:u.category){case"file":return React.createElement(v,{feedAnswer:n,setPosition:i,setSize:r,isCondensedFeed:t});case"video":return React.createElement(l,{feedAnswer:n,setPosition:i,setSize:r,isCondensedFeed:t});case"emailMessage":case"teamsChatMessage":return React.createElement(p,{feedAnswer:n,setPosition:i,setSize:r,isCondensedFeed:t});default:return null}},l=({feedAnswer:n,setPosition:r,setSize:u,isCondensedFeed:t})=>{const{answerId:f,answerType:e}=n;return React.createElement(i.MsbDsbErrorBoundary,{answerId:f,answerType:e,wrappedComponentName:"VideoFeedItemCard"},React.createElement(a,{feedAnswer:n,setPosition:r,setSize:u,isCondensedFeed:t}))},a=({feedAnswer:u,setPosition:e,setSize:o,isCondensedFeed:f})=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("VideoFeedItem");const s=u.item,h=n.msbDsbHost.getLocString("VideoIconAltText");return React.createElement(r,{tidbitItem:s.tidbitItem,body:s.title,bodyLabel:s.title,footer:s.duration,icon:s.icon,answerId:u.answerId,uri:s.uri,preview:f?React.createElement(n.View.Icon,{additionalCssClass:"feed_preview_icon",icon:s.previewIcon,suggestionText:h}):React.createElement(i.FeedItemPreview,{feedItem:s,previewIcon:s.previewIcon,previewDescription:n.msbDsbHost.getLocString("MeetingRecordingAltTextPattern",s.title),iconDescription:h}),hint:n.msbDsbHost.getLocString("OpenInSharepointHintText"),setPosition:e,setSize:o,instrumentedItem:u.instrumentedItem,isCondensedFeed:f,category:s.category})},v=({feedAnswer:n,setPosition:r,setSize:u,isCondensedFeed:t})=>{const{answerId:f,answerType:e}=n;return React.createElement(i.MsbDsbErrorBoundary,{answerId:f,answerType:e,wrappedComponentName:"FileFeedItemCard"},React.createElement(y,{feedAnswer:n,setPosition:r,setSize:u,isCondensedFeed:t}))},y=({feedAnswer:u,setPosition:e,setSize:o,isCondensedFeed:f})=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("FileFeedItem");const s=u.item,c=i.useFileIcon(s.extension);let h="";switch(s.extension){case"pptx":h=n.msbDsbHost.getLocString("PowerpointApplicationIconAltText");break;case"docx":h=n.msbDsbHost.getLocString("WordApplicationIconAltText");break;case"xlsx":h=n.msbDsbHost.getLocString("ExcelApplicationIconAltText");break;default:h=n.msbDsbHost.getLocString("FileIconAltText")}return React.createElement(r,{tidbitItem:s.tidbitItem,body:s.title,bodyLabel:s.title,footer:s.location,icon:s.icon,answerId:u.answerId,uri:s.uri,preview:f?React.createElement(n.View.Icon,{icon:c,suggestionText:h}):React.createElement(i.FeedItemPreview,{feedItem:s,previewIcon:c,previewDescription:n.msbDsbHost.getLocString("FilePreviewAltTextPattern",s.title),iconDescription:h}),hint:n.msbDsbHost.getLocString("OpenInBrowserHintText"),setPosition:e,setSize:o,instrumentedItem:u.instrumentedItem,isCondensedFeed:f,category:s.category})},p=({feedAnswer:n,setPosition:r,setSize:u,isCondensedFeed:t})=>{const{answerId:f,answerType:e}=n;return React.createElement(i.MsbDsbErrorBoundary,{answerId:f,answerType:e,wrappedComponentName:"MentionFeedItemCard"},React.createElement(w,{feedAnswer:n,setPosition:r,setSize:u,isCondensedFeed:t}))},w=({feedAnswer:u,setPosition:e,setSize:o,isCondensedFeed:f})=>{var c;t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("MentionFeedItem");const l=u.item,{processedMessageBody:s,title:a,icon:v,uri:y,tidbitItem:p,category:h,isEmailMention:w}=l;return React.createElement(r,{category:l.category,tidbitItem:l.tidbitItem,body:s.isHtml?React.createElement("div",{dangerouslySetInnerHTML:{__html:s.messageContent}}):React.createElement("p",null,s.messageContent),bodyLabel:(c=s.messageString)!==null&&c!==void 0?c:s.messageContent,footer:a,icon:v,answerId:u.answerId,uri:y,useIcon:!0,preview:f?React.createElement(i.MessageSenderIcon,{iconSize:"64",isTeamsMessage:h==="teamsChatMessage",isEmailMessage:h==="emailMessage"}):React.createElement(i.MessageSenderPreview,{person:p.firstActor,iconSize:"64",isTeamsMessage:h=="teamsChatMessage",isEmailMessage:h=="emailMessage"}),hint:w?n.msbDsbHost.getLocString("OpenEmailHintText"):n.msbDsbHost.getLocString("OpenChatHintText"),setPosition:e,setSize:o,instrumentedItem:u.instrumentedItem,isCondensedFeed:f})};const r=({tidbitItem:w,body:u,bodyLabel:f,category:o,footer:s,icon:c,answerId:r,uri:b,preview:v,useIcon:g,hint:h,setPosition:y,setSize:p,instrumentedItem:l,isCondensedFeed:a})=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("FeedItem");const{firstActor:nt,tidbit:ft,secondActor:tt}=w,et=i.useDispatchLaunchUriAction(),ut=n.msbDsbHost.getLocString("YouTidbit"),it=(nt===null||nt===void 0?void 0:nt.isMe)?ut:nt===null||nt===void 0?void 0:nt.fullName,rt=(tt===null||tt===void 0?void 0:tt.isMe)?ut:tt===null||tt===void 0?void 0:tt.fullName;return React.createElement(i.FeedCardBase,{additionalCssClasses:"msbdsb_feed_item msbdsb_selectable",onClick:()=>{et(b)},isClickable:!0,accessibilityProps:{ariaLabel:e(ft,f,h,it,rt),ariaSetPosition:y,ariaSetSize:p},instrumentedItem:l,answerId:r,answerType:"Feed",isCondensedFeed:a},a?React.createElement(k,{tidbitItem:w,category:o,icon:c,preview:v,body:u,firstActorText:it,secondActorText:rt,footer:s,useIcon:g}):React.createElement(d,{useIcon:g,tidbitItem:w,icon:c,firstActorText:it,secondActorText:rt,body:u,footer:s,preview:v}))},o=({tidbitItem:i,firstActorText:n,secondActorText:t})=>{const{firstActor:r,tidbit:f,secondActor:u}=i;return React.createElement(React.Fragment,null,r&&React.createElement("span",{className:`msbdsb_person_name first_actor ${r.isMe?"is_me":""}`},n),React.createElement("span",{className:"msbdsb_annotation"},f),u&&React.createElement("span",{className:`msbdsb_person_name ${u.isMe?"is_me":""}`},t))},b=({useIcon:r,firstActor:n,icon:t})=>React.createElement(React.Fragment,null,!r&&n&&n.fullName?React.createElement("span",{className:"person_icon_container"},React.createElement(i.PersonIcon,{additionalCssClass:"small_person_icon",person:n})):React.createElement(i.FluentIcon,{icon:t,additionalCssClasses:"msbdsb_tidbit_icon"})),k=({tidbitItem:h,icon:f,firstActorText:i,secondActorText:s,category:t,footer:r,useIcon:c,preview:e,body:n})=>{const l=t==="video"?r:null,a=t==="emailMessage"||t==="teamsChatMessage";return React.createElement("div",{className:"msbdsb_condensed_feed"},React.createElement("div",{className:"msbdsb_condensed_feed_icon"},e),React.createElement("div",{className:"msbdsb_feed_card_body"},React.createElement("div",{className:"msbdsb_feed_item_body"},React.createElement("div",{className:"feed_item_details"},a?React.createElement(u,{tidbitItem:h,useIcon:c,icon:f,firstActorText:i,secondActorText:s}):React.createElement("span",{className:"feed_item_content"},n),React.createElement("div",{className:"feed_item_footer"},a?React.createElement("div",{className:"msbdsb_mention_body"},n):React.createElement("div",{className:"msbdsb_feed_tidbit"},React.createElement(o,{tidbitItem:h,firstActorText:i,secondActorText:s}),l?React.createElement("span",null,React.createElement("span",{className:"msbdsb_feed_duration"},"• "),React.createElement("span",null,l)):null))))))},u=({tidbitItem:r,icon:t,firstActorText:n,secondActorText:i,useIcon:u})=>{const{firstActor:f}=r;return React.createElement("div",{className:"msbdsb_feed_item_header"},React.createElement("div",{className:"msbdsb_feed_item_title"},React.createElement(b,{useIcon:u,icon:t,firstActor:f}),React.createElement(o,{tidbitItem:r,firstActorText:n,secondActorText:i})))},d=({useIcon:s,tidbitItem:o,icon:r,firstActorText:t,secondActorText:e,body:n,footer:i,preview:f})=>React.createElement(React.Fragment,null,React.createElement(u,{tidbitItem:o,useIcon:s,icon:r,firstActorText:t,secondActorText:e}),React.createElement("div",{className:"msbdsb_feed_item_body"},React.createElement("div",{className:"feed_item_details"},React.createElement("div",{className:"feed_item_content"},n),React.createElement("div",{className:"feed_item_footer"},i)),f));i.HeroCardRouter=({heroAnswer:n,setPosition:t,setSize:i})=>{var r;switch((r=n.item)===null||r===void 0?void 0:r.category){case"file":return React.createElement(g,{heroAnswer:n,setPosition:t,setSize:i});default:return null}};const g=({heroAnswer:n,setSize:r,setPosition:t})=>{const{answerId:u,answerType:f}=n;return React.createElement(i.MsbDsbErrorBoundary,{answerId:u,answerType:f,wrappedComponentName:"FileHeroCard"},React.createElement(nt,{heroAnswer:n,setPosition:t,setSize:r}))},nt=({heroAnswer:r,setPosition:o,setSize:s})=>{const v=r.item,{extension:k,tidbitItem:y,uri:d,title:l,location:g,icon:nt}=v,tt=i.useFileIcon(k),it=i.useFeedItemPreviewBase64(v,"HeroCard"),rt=`msbdsb-hero-card-${o}`,{firstActor:h,tidbit:ut,secondActor:c}=y,p=(h===null||h===void 0?void 0:h.isMe)?n.msbDsbHost.getLocString("YouTidbit"):h===null||h===void 0?void 0:h.fullName,w=(c===null||c===void 0?void 0:c.isMe)?n.msbDsbHost.getLocString("YouTidbit"):c===null||c===void 0?void 0:c.fullName,ft=i.useDispatchLaunchUriAction();let a=l;const b=a.length>f;return b&&(a=t.DataContext.getTruncatedText(l,f)),React.createElement(i.WithInstrumentation,{instrumentedItem:r.instrumentedItem},React.createElement("button",{role:"link","aria-label":e(ut,l,n.msbDsbHost.getLocString("OpenInBrowserHintText"),p,w),"aria-posinset":o,"aria-setsize":s,className:"msbdsb-file-hero",id:rt,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,onClick:()=>{ft(d)}},React.createElement("div",{className:"msbdsb-hero-preview"},React.createElement("img",{className:"msbdsb-hero-preview-image",src:it}),React.createElement("img",{className:"msbdsb-hero-preview-overlay"}),React.createElement("div",{className:"horizontal_stack msbdsb-hero-title-overlay"},React.createElement(u,{icon:nt,tidbitItem:y,firstActorText:p,secondActorText:w}))),React.createElement("div",{className:"msbdsb-hero-footer"},React.createElement("div",{className:"msbdsb-hero-footer-content horizontal_stack",title:b?l:""},React.createElement("img",{className:"msbdsb-file-hero-icon",role:"presentation",src:tt.content}),React.createElement("div",{className:"hero_body"},React.createElement("div",{className:"msbdsb-file-hero-name"},a),React.createElement("div",{className:"msbdsb-file-hero-tidbit"},g)))),React.createElement("div",{className:"hero-focus-overlay"})))}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){t.IndustryNewsFeed=({answer:n})=>{const{answerType:r}=n;return React.createElement(t.MsbDsbErrorBoundary,{answerType:r,wrappedComponentName:"IndustryNewsFeed"},React.createElement(i,{industryNewsAnswer:n}))};const i=({industryNewsAnswer:i})=>{var f;const{instrumentedItem:e,answerId:o,answerType:s}=i,u=i===null||i===void 0?void 0:i.newsItems,h=(f=u===null||u===void 0?void 0:u.length)!==null&&f!==void 0?f:0;return React.createElement(t.WithInstrumentation,{instrumentedItem:e},React.createElement("div",{className:"msbdsb_card_background industry-news"},React.createElement("div",{className:"msbdsb-mp-feed-card msbdsb_indnews",role:"feed","aria-label":n.msbDsbHost.getLocString("IndustryNewsTitle"),id:"msbdsb_industrynews_feed"},React.createElement("div",{className:"header"},React.createElement("div",{className:"horizontal_stack"},React.createElement("span",{className:"horizontal_stack"},React.createElement(t.FluentIcon,{icon:"newsIcon",additionalCssClasses:"news_icon"}),React.createElement("h2",{id:"header_title",className:"header_title news_header_title"},n.msbDsbHost.getLocString("IndustryNewsTitle"))))),React.createElement(t.DismissButton,{answerId:o,answerType:s,buttonId:"msbdsb_industrynews_dismiss",additionalCssClass:"msbdsb_feed_item msbdsb_selectable"}),React.createElement("div",{className:"dsb-suggestions"},u===null||u===void 0?void 0:u.map((n,t)=>React.createElement(r,{feedItem:n,key:t,setPosition:t+1,setSize:h,answerType:i.answerType}))))))},r=({feedItem:i,setPosition:r,setSize:e,answerType:n})=>{const{url:s,instrumentedItem:c,imageInfo:o}=i,l=t.useDispatchLaunchUriAction(),h=o===null||o===void 0?void 0:o.msnImageUrl;return React.createElement(t.FeedCardBase,{additionalCssClasses:"msbdsb_feed_item msbdsb_selectable",onClick:()=>{s&&l(s)},isClickable:!0,accessibilityProps:{ariaLabel:"",ariaSetPosition:r,ariaSetSize:e},instrumentedItem:c,answerId:r.toString(),answerType:n,canBeClosed:!1},React.createElement("div",{className:"msbdsb_news_feed_item_body msbdsb_feed_item_body"},React.createElement("div",{className:"news_feed_item_details feed_item_details"},React.createElement(u,{feedItem:i}),React.createElement(f,{feedItem:i})),h&&React.createElement("img",{className:"msbdsb-news-preview",src:h})))},u=({feedItem:t})=>{const{title:f,publishDate:r,provider:e,msnProviderLogoUrl:i}=t,o=n.getCurrentDate(),u=r?`${n.formatTimePassed(r,o)}`:null,s=i?"msbdsb-news-title":"msbdsb-news-title msbdsb-news-title-extended";return React.createElement("div",{className:"msbdsb-newsfeed_item_content"},i&&React.createElement("img",{className:"msbdsb-news-provider-img",src:i}),React.createElement("span",{className:"msbdsb-news-provider"},e),u&&React.createElement(React.Fragment,null,React.createElement("span",{className:"msbdsb-news-dot"},"·"),React.createElement("span",{className:"msbdsb-timestamp"},u)),React.createElement("div",{className:s},f))},f=({feedItem:t})=>{var r;const{displayFeatures:u}=t,i=(r=u===null||u===void 0?void 0:u.find(n=>n.name==="TenantMostClicked"))===null||r===void 0?void 0:r.value;if(!i)return null;const f=i&&parseInt(i)>1?n.msbDsbHost.getLocString("CoworkersPluralText"):n.msbDsbHost.getLocString("CoworkerSingularText");return React.createElement("div",{className:"msbdsb-newsfeed_item_footer"},React.createElement("div",{className:"msbdsb-news-coworkers"},`${i} ${f}`))}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){i.PeopleHighlightsFeed=({answer:n})=>{const{answerType:t}=n;return React.createElement(i.MsbDsbErrorBoundary,{answerType:t,wrappedComponentName:"PeopleHighlightsFeed"},React.createElement(r,{peopleHighlightsAnswer:n}))};const r=({peopleHighlightsAnswer:i})=>{const r=n.msbDsbHost.getLocString("PeopleHighlightsTitle");return React.createElement("div",{className:"msbdsb_card_background"},React.createElement("div",{className:"msbdsb-mp-feed-card msbdsb-peoplehighlights-feed-card",role:"feed","aria-label":r,id:"msbdsb_peoplehighlights_feed"},React.createElement("div",{className:"header"},React.createElement("span",{className:"horizontal_stack"},React.createElement("h2",{className:"header_title"},r))),React.createElement("div",{className:`msbdsb-peoplehighlights-feed ${t.MDSB_LIST_CONTAINER_CLASS}`,tabIndex:t.TAB_NAVIGATION_TAB_INDEX},React.createElement(u,{peopleHighlightsAnswer:i}))))},u=({peopleHighlightsAnswer:n})=>{const{peopleHighlights:t,answerType:r,instrumentedItem:u}=n;return React.createElement(React.Fragment,null,t.map((n,e)=>{const{person:o}=n,{uid:s}=o;return React.createElement(i.WithInstrumentation,{key:s,instrumentedItem:u,isBingTransfer:!0,additionalCssClass:"msbdsb-peoplehighlights-feed-item"},React.createElement(f,{personHighlight:n,answerType:r,accessibilityProps:{ariaSetPosition:e+1,ariaSetSize:t.length}}))}))},f=({personHighlight:f,accessibilityProps:r,answerType:u})=>{const h=i.useDispatchDismissAnswerAction(),c=i.useDispatchLaunchProactiveWorkSearchAction(),l=i.useDispatchSetWsbRequeryAction(),{person:o,highlightType:p,showBadge:w,answerId:a}=f,{fullName:e}=o,{ariaSetSize:b,ariaSetPosition:v}=r,[s,k]=React.useState(w),d=React.useCallback(()=>{if(s&&(k(!1),h(u,a,{dismissOnView:!1,dismissViaRequest:!0})),n.config.msbDsbPeopleHighlightsToWorkVertical){const t={query:e,intent:"Person",formCode:n.msbDsbHost.getFormCode()};c(t)}else l(e,n.Scope.Work)},[o,s,a,h,c,l]),y=React.useMemo(()=>{switch(p){case"NewManager":case"NewTeamMember":case"NewDirectReport":return n.msbDsbHost.getLocString("PeopleHighlightsNewTeamMember");case"ManagerNewJobTitle":case"TeamMemberNewJobTitle":case"DirectReportNewJobTitle":return n.msbDsbHost.getLocString("PeopleHighlightsNewJobTitle");default:return""}},[]),g=n.View.classNames({"msbdsb-peoplehighlights-badge":!!n.config.msbDsbPeopleHighlightsBadge,"msbdsb-peoplehighlights-badge-hidden":!n.config.msbDsbPeopleHighlightsBadge||!s});return React.createElement("button",{id:`msbdsb_peoplehighlights_${v}`,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,"aria-label":`${e} ${y}`,"aria-posinset":v,"aria-setsize":b,onClick:d,className:"msbdsb-peoplehighlights-feed-item-button"},React.createElement(i.PersonIcon,{additionalCssClass:"person-highlight-icon",person:o}),React.createElement("div",{className:"msbdsb-peoplehighlights-content-container"},React.createElement("div",{className:"msbdsb-peoplehighlights-content"},React.createElement("span",{className:"msbdsb-peoplehighlights-fullname"},e),React.createElement("span",{className:"msbdsb-peoplehighlights-highlight"},y)),React.createElement("div",{className:g})))}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){function u(t,r){switch(t){case"MyProfileSearchSuggestion":return React.createElement(i.PersonIcon,{additionalCssClass:"person_icon",person:r});case"EduCardFiles":return React.createElement(n.View.Icon,{additionalCssClass:"edu_icon",icon:{content:n.FILES_SVG_URL,type:0}});case"EduCardMessages":return React.createElement(n.View.Icon,{additionalCssClass:"edu_icon",icon:{content:n.MESSAGES_SVG_URL,type:0}});case"EduCardCalendar":return React.createElement(n.View.Icon,{additionalCssClass:"edu_icon",icon:{content:n.CALENDAR_SVG_URL,type:0}});case"EduCardAssignments":return React.createElement(n.View.Icon,{additionalCssClass:"edu_icon",icon:{content:n.ASSIGNMENTS_SVG_URL,type:0}});case"EduCardClasses":default:return React.createElement(n.View.Icon,{additionalCssClass:"edu_icon",icon:{content:n.CLASSES_SVG_URL,type:0}})}}i.EduCard=()=>{const n=i.useEduCardAnswer();if(!n)return null;const{answerType:t}=n;return React.createElement(i.MsbDsbErrorBoundary,{answerType:t,wrappedComponentName:"EduCard"},React.createElement(r,{eduCardAnswer:n}))};const r=({eduCardAnswer:r})=>{const{suggestions:f,user:e,instrumentedItem:o}=r,s=i.useDispatchLaunchProactiveWorkSearchAction(),h=i.useDispatchLaunchUriAction(),c=React.useCallback(t=>{const{key:i}=t,r=i=="EduCardAssignments"||i=="MyProfileSearchSuggestion"?n.msbDsbHost.getLocString(i+"Query"):n.Host.getEnUsLocString(i+"Query");n.config.msbQwqsEnableWsbClickTarget?n.msbDsbHost.setWsbQuery(r,n.Scope.Work):n.config.eduWsbToZQPEnabled&&i=="EduCardFiles"?n.msbHost.urlUtils.buildZQPUrlAsync(n.msbDsbHost.getFormCode(!0)).then(n=>h(n)):s({query:r,intent:"None",formCode:n.msbDsbHost.getFormCode(!0),verticalHash:i==="EduCardMessages"?"Message-conversations":undefined})},[]);return React.createElement(i.WithInstrumentation,{instrumentedItem:o},React.createElement("div",{tabIndex:-1,className:`msb_dsb_edu_card ${t.MDSB_LIST_CONTAINER_CLASS}`},f.map((n,r)=>React.createElement(i.WithInstrumentation,{instrumentedItem:n.instrumentedItem,additionalCssClass:"msb_dsb_edu_card_items",isBingTransfer:!0,key:r},React.createElement("button",{className:"msb_dsb_edu_card_item",role:"button",id:`msbdsb-edu_card_${r}`,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,onClick:()=>c(n)},React.createElement("div",{className:"msb_dsb_edu_card_icon_section "+n.color},u(n.key,e)),React.createElement("div",{className:"msb_dsb_edu_card_text_section"},React.createElement("p",{className:"msb_dsb_edu_card_item_text"},n.title)))))))}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){const i=({cardAriaLabel:t,clickThroughUrl:r,divStyle:u,isFullText:e,onHoverHandler:o,instrumentedItem:f,children:i})=>React.createElement("div",{className:"msbdsb-mp-edu-imageoftheday-card"},React.createElement("div",{className:n.View.classNames("dsb-hero",e&&"fullText"),onClick:t=>n.clickDSBHandler(t.nativeEvent,r,f),role:"link","aria-label":t,onMouseEnter:o},React.createElement("div",{className:`dsb-hero__img-container`},React.createElement("div",{className:"dsb-hero__img",style:u})),React.createElement("div",{className:"dsb-hero__content-container focusable"},i))),r=()=>React.createElement("div",{className:"msbdsb-mp-edu-fromtheweb-title"},n.msbDsbHost.getLocString("FromTheWebTitle"));t.ImageOfTheDayCard=()=>{var f;const o=t.useImageOfTheDay();if(!o)return null;const{imageOfTheDayScenarios:e,imageHostName:s,instrumentedItem:h}=o;if(!e||e.length<1)return null;const u=e[0],c=n.getImageStyle((f=u.thumbnail)===null||f===void 0?void 0:f.ThumbnailId,0,n.DSBScenario.ImageOfTheDay,s,!1,!0,!0),l=n.generateBingThumbnailUrlFromId("ODSWG.IotdLocalIcon",s,16,16);return React.createElement(t.WithInstrumentation,{instrumentedItem:h},React.createElement(r,null),React.createElement(i,{cardAriaLabel:u.title,clickThroughUrl:u.clickThroughUrl,divStyle:c,instrumentedItem:h,isFullText:u.caption?!0:!1},React.createElement("div",{className:"msbdsb-mp-edu-imageday-hover-card"},React.createElement("div",{className:"msbdsb-mp-edu-imageday-hover-card__title-caption-content"},React.createElement("div",{className:"msbdsb-mp-edu-imageday-hover-card__title-content"},u.title&&React.createElement("div",{className:"msbdsb-mp-edu-imageday-hover-card__title-text"},u.title),React.createElement("div",{className:"msbdsb-mp-edu-imageday-hover-card__title-copyright"},u.copyright)),React.createElement("div",{className:"msbdsb-mp-edu-imageday-hover-card__caption focusable selectable"},React.createElement("div",{className:"msbdsb-mp-edu-imageday-hover-card__caption-icon"},React.createElement("img",{src:l})),React.createElement("div",{className:"msbdsb-mp-edu-imageday-hover-card__caption-text"},u.caption)))),React.createElement("div",{className:"msbdsb-mp-edu-imageday-hover-card__bing-logo"},React.createElement(n.View.DSB.BingLogo,null))))}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){t.MsbDsbContainer=()=>{const i=n.msbDsbHost.viewDataManager;return i?React.createElement(i.ContextProvider,{blendedRegion:"BrMain"},React.createElement(t.MainPageTemplate,null)):null};t.MsbDsbTopContainer=()=>{const i=n.msbDsbHost.viewDataManager;return i?React.createElement(i.ContextProvider,{blendedRegion:"BrTop"},React.createElement(t.MainPageTemplate,null)):null}})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){function f(n,t){var i;((i=n===null||n===void 0?void 0:n.current)===null||i===void 0?void 0:i.classList)&&(n.current.classList.contains(t)||n.current.classList.add(t))}function v(n,t){var i;((i=n===null||n===void 0?void 0:n.current)===null||i===void 0?void 0:i.classList)&&n.current.classList.remove(t)}function r(n,t){return t?`${n}, ${t}`:n}function w(n,t){return i=>{var r;const{charCode:u,ctrlKey:f,shiftKey:e,altKey:o}=i;u!==13||f||e||o||((r=n===null||n===void 0?void 0:n.current)===null||r===void 0?void 0:r.click(),t||i.stopPropagation())}}function b(n){const[t,i]=React.useState(0),[r,u]=React.useState(0);return React.useEffect(()=>{const t=n.current,r=new IntersectionObserver(n=>{const f=n[0];if((f===null||f===void 0?void 0:f.isIntersecting)&&t){const n=t.getBoundingClientRect();i(Math.round(n.left));u(Math.round(n.right));r.disconnect()}});return r.observe(t),()=>{r.disconnect()}},[n.current]),[t,r]}function u(n,t){const i=React.useRef(!0);React.useEffect(()=>{if(i.current){i.current=!1;return}n()},t)}function o(n){if(!n)return Math.floor(Math.random()*t.NUMBER_OF_PROFILE_COLOURS)+1;const i=n.split("").reduce((n,t)=>n+t.charCodeAt(0),0)%t.NUMBER_OF_PROFILE_COLOURS;return i+1}const s=12,h=2,c=40;i.WithInstrumentation=({instrumentedItem:u,additionalCssClass:i,isSelectEvent:e,isBingTransfer:f,children:r})=>{if(!u)return React.createElement("div",{className:i},r);const h=u.getHValue(),o=u.getQsCode(),c=u.getKValue(),s=n.msbDsbHost.instrumentationManager.getInstrumentedItemKey(o,c),l=(i,r)=>{var h;const l=r,c=t.DataContext.getNearestAncestorWithAttribute(l,t.MDSB_INSTRUMENTED_ITEM_ATTRIBUTE),v=c===null||c===void 0?void 0:c.getAttribute(t.MDSB_INSTRUMENTED_ITEM_ATTRIBUTE);if(v===s){const a=n.SequenceNumberManager.getSequenceNumber();if(e&&o)n.InstrumentationHelper.logClientInstEvent("Select",o,a);else{const e=n.getInputType(i);n.InstrumentationHelper.instrumentItemClick(n.getCurrentTime(),u,a,null,e,null);n.msbHost.substrateLogger.logSearchEntityActions("Wsb.DynamicSearchBox");const r=((h=t.DataContext.getNearestAncestorWithAttribute(l,t.MDSB_BING_TRANSFER_ATTRIBUTE))===null||h===void 0?void 0:h.getAttribute(t.MDSB_BING_TRANSFER_ATTRIBUTE))||f?n.msbHost.urlUtils.getTransferIg():undefined;n.msbDsbLogger.logClickEvent(o,Object.assign({redirectTo:n.msbHost.mapRedirectTarget(o)},r?{transferIg:r}:{}))}}};return React.createElement("div",{className:i,onClickCapture:n=>l(n.nativeEvent,n.target),"data-h":h,"data-msb-dsb-inst-key":s},r)};i.DynamicIcons=({icon:t})=>React.createElement(React.Fragment,null,t&&React.createElement(n.View.DSB[t],t));i.PersonIcon=({additionalCssClass:t,person:r})=>{const e=(r===null||r===void 0?void 0:r.uid)?r===null||r===void 0?void 0:r.uid:r===null||r===void 0?void 0:r.email,u=i.usePersonPhotoBase64(e),f=n.View.classNames("icon peopleIcon msbdsb_people_icon people_icon_size",t),s=n.msbDsbHost.getLocString("ProfilePictureAltTextPattern",r.fullName);if(!u){const t=o(r.email||r.fullName),u=n.View.classNames("msbdsb_person_initials",`profile-color-${t}`,f);return React.createElement("div",{className:u,"aria-hidden":"true"},r.initials||React.createElement(i.FluentIcon,{icon:"personIcon",additionalCssClasses:"msbdsb_person_icon_fallback"}))}return React.createElement("img",{className:f,src:`data:image/png;base64,${u}`,alt:s})};i.HeaderSection=()=>!n.config.useCobaltCSS||n.msbDsbHost.isInBlendedMode()?null:React.createElement("div",{className:"msbdsb-mp-header"},React.createElement(l,null));const l=()=>{const t=i.useTenantDisplayName(),r=n.msbDsbHost.getLocString("CobaltTodayAtHeader",t),u=n.msbDsbHost.getLocString("RecommendedForYou");return React.createElement("h4",{className:"groupTitle msb-dsb-today-at"},n.msbHost.isEduTenant()?u:r)};i.PopularTenantSearchesCard=()=>{const n=i.usePopularSearchesAnswer();if(!n)return null;const{answerType:t}=n;return React.createElement(i.MsbDsbErrorBoundary,{answerType:t,wrappedComponentName:"PopularTenantSearchesCard"},React.createElement(a,{popularSearchesAnswer:n}))};const a=({popularSearchesAnswer:r})=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError("PopularTenantSearches");const u=i.useTenantDisplayName();if(!r)return null;const{searchQueries:f,instrumentedItem:e}=r;if(!f||f.length===0)return null;const o=u&&(u===null||u===void 0?void 0:u.length)<s?n.msbDsbHost.getLocString("PopularSearchesTitle",u):n.msbDsbHost.getLocString("PopularSearchesFallbackTitle"),h=f.map(t=>({title:t.title,scope:n.Scope.Work}));return React.createElement(i.SearchSuggestionsCard,{title:o,icon:"arrowTrendingIcon",sectionId:"popular_search",suggestions:h,instrumentedItem:e,maxRows:t.MDSB_POPULAR_SEARCH_ROWS})};i.SearchSuggestionsContainer=React.forwardRef(({title:e,icon:u,sectionId:f,additionalCssClasses:n,children:r},o)=>React.createElement("div",{className:`msbdsb_feed_card msbdsb_search_suggestions_card ${n}`,role:"group","aria-labelledby":`msbdsb_search_suggestions_title_${f}`},React.createElement("div",{className:"msbdsb_search_suggestions_card_title_container msbdsb_feed_item_header"},React.createElement(i.FluentIcon,{icon:u,additionalCssClasses:"msbdsb_search_suggestions_card_title_icon"}),React.createElement("div",{role:"heading",className:"msbdsb_search_suggestions_title",id:`msbdsb_search_suggestions_title_${f}`},e)),React.createElement("div",{ref:o,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`msbdsb_search_suggestions_container ${t.MDSB_LIST_CONTAINER_CLASS}`},r)));i.SearchSuggestionsCard=({title:a,icon:f,sectionId:c,suggestions:l,instrumentedItem:e,maxRows:s,additionalCssClasses:r,maxCharLimit:o})=>{const[v,p]=React.useState(l.length),w=i.useDispatchSetWsbRequeryAction(),b=i.useDispatchLaunchProactiveWorkSearchAction(),y=React.useRef(null),k=n=>`msbdsb_search_suggestions_${c}_${n}`;return React.useEffect(()=>{const n=y.current,t=new IntersectionObserver(i=>{var r;if(n){const u=n.firstElementChild;if(((r=i[0])===null||r===void 0?void 0:r.isIntersecting)&&u){const i=u.getBoundingClientRect(),f=i.bottom-i.top,e=s!==null&&s!==void 0?s:h,o=f*e+i.top;let n=u.nextElementSibling,r=1;while(n&&r<l.length&&n.getBoundingClientRect().top<o)n=n.nextElementSibling,r++;p(r);t.disconnect()}}});return n&&t.observe(n),()=>t.disconnect()},[l]),u(()=>{n.msbDsbHost.updateInteractionModel()},[v]),React.createElement(i.WithInstrumentation,{instrumentedItem:e},React.createElement(i.SearchSuggestionsContainer,{title:a,icon:f,sectionId:c,ref:y,additionalCssClasses:r},l.slice(0,v).map((r,u)=>{var f;const h=u+1,l=r.title,e=(f=r.query)!==null&&f!==void 0?f:r.title,a=r.scope,s=k(u);return React.createElement(i.SuggestionPill,{searchText:l,key:s,id:s,maxDisplayedChars:o!==null&&o!==void 0?o:t.DEFAULT_SUGGESTION_CARD_CHAR_LIMIT,icon:r.icon,accessibilityProps:{ariaSetPosition:h,ariaSetSize:v},onClick:c=="popular_search"&&n.config.msbDsbOpenInEdge?()=>b({query:e,intent:"None",formCode:n.msbDsbHost.getFormCode()}):()=>w(e,a)})})))};i.FeedCardBase=({isClickable:l,additionalCssClasses:u,onClick:v,accessibilityProps:r,answerType:e,answerId:f,instrumentedItem:c,dismissalInstrumentedItem:h,children:s,canBeClosed:o,isCondensedFeed:a})=>{const{ariaLabel:nt,ariaLabelledBy:tt,ariaSetPosition:p,ariaSetSize:it,role:w}=r;let b=a?"msbdsb_condensed_feed_card":"msbdsb_feed_card";const rt=n.msbDsbHost.getLocString("FeedDismissalButtonToolTipText");l&&(b=n.View.classNames(b,"msbdsb_feed_card_clickable"));const ut=n.View.classNames(b,u),k=t.DataContext.isViewModelAnswerTypeDynamicM365(e),d=k&&!p?1:p,ft=k?`msbdsb-dynamic-card-${d}`:`msbdsb-feed-card-${d}`,et=`msbdsb-feed-dismiss-${k?"d":"f"}${d}`,y=React.useRef(null),g=React.useRef(null),ot=o===undefined||o;return React.createElement("div",{ref:g,className:ut},ot&&React.createElement(i.WithInstrumentation,{instrumentedItem:h,isSelectEvent:!0,additionalCssClass:"overlapping_area dismiss_button"},React.createElement(i.DismissButton,{ref:y,buttonId:et,answerType:e,answerId:f,parentCardRef:g,additionalCssClass:"dismiss",buttonHint:rt,isCondensedFeed:a})),React.createElement(i.WithInstrumentation,{instrumentedItem:c,additionalCssClass:"overlapping_area"},React.createElement("button",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,role:w!==null&&w!==void 0?w:"link","aria-label":nt,"aria-labelledby":tt,"aria-posinset":p,"aria-setsize":it,onClick:v,className:"msbdsb_feed_card_content",onFocus:()=>{var n,t;(n=y.current)===null||n===void 0?void 0:n.classList.remove("collapsed");(t=y.current)===null||t===void 0?void 0:t.classList.add("visible")},onBlur:()=>{var n,t;(n=y.current)===null||n===void 0?void 0:n.classList.remove("visible");(t=y.current)===null||t===void 0?void 0:t.classList.add("collapsed")},id:ft},React.createElement("div",{className:`msbdsb_feed_card_body ${a&&"msbdsb_feed_condensed_body"}`},s))))};i.FeedItemPreview=({feedItem:t,previewIcon:f,previewDescription:u,iconDescription:r})=>{const e=i.useFeedItemPreviewBase64(t);return React.createElement("div",null,e?React.createElement("div",{className:"feed_item_preview"},React.createElement("img",{className:"feed_preview_image",src:e,alt:u}),f&&React.createElement(n.View.Icon,{additionalCssClass:"feed_preview_icon",icon:f,suggestionText:r})):f&&React.createElement("div",{className:"feed_item_preview"},React.createElement(n.View.Icon,{additionalCssClass:"feed_icon_no_preview",icon:f,suggestionText:r})))};i.DismissButton=React.forwardRef(({answerType:e,answerId:f,buttonId:s,additionalCssClass:u,buttonHint:o,parentCardRef:c,isCondensedFeed:h},l)=>{const v=i.useDispatchDismissAnswerAction(),y=i.useShouldShowWideLayout();if(y)return null;const a=()=>{n.msbDsbLogger.logClickEvent("DismissAnswer",{answerType:e}),v(e,f,{dismissOnView:!0,dismissViaRequest:!0})},p=()=>{var t;(t=n.msbDsbHost.keyNavManager)===null||t===void 0?void 0:t.reapplyKeyboardFocus(s);a()},w=n.View.classNames("dismiss msbdsb_nested_button",u);return React.createElement("button",{ref:l,id:s,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:w,"aria-label":r(n.msbDsbHost.getLocString("DismissButtonLabel"),o),onClick:n=>{n.stopPropagation(),a()},onMouseOver:()=>{var n;h&&((n=c===null||c===void 0?void 0:c.current)===null||n===void 0?void 0:n.classList.add("condensed_feed_card_background"))},onMouseOut:()=>{var n;h&&((n=c===null||c===void 0?void 0:c.current)===null||n===void 0?void 0:n.classList.remove("condensed_feed_card_background"))},onKeyPress:p},React.createElement(i.FluentIcon,{icon:"cancelIcon",additionalCssClasses:"cancel_icon"}))});i.MessageSenderPreview=({person:f,iconSize:t,isEmailMessage:r,isTeamsMessage:u})=>{const e="sender_"+t.toString();return React.createElement("div",{className:"sender_preview"},React.createElement(i.PersonIcon,{person:f,additionalCssClass:n.View.classNames(e,"sender_person_icon")}),React.createElement(i.MessageSenderIcon,{iconSize:t,isEmailMessage:r,isTeamsMessage:u}))};i.MessageSenderIcon=({isEmailMessage:r,isTeamsMessage:u,iconSize:t})=>{const e="sender_"+t.toString(),f=n.View.classNames(e,"sender_location_icon");return React.createElement(React.Fragment,null,r?React.createElement(i.OutlookIcon,{cssClasses:f}):u?React.createElement(i.TeamsIcon,{cssClasses:f}):null)};i.FeedbackTooltip=({propertyIndex:h,parentButtonRef:s,answer:e,itemId:o})=>{const{traceId:at,answerType:p,positiveFeedbackInstrumentedItem:vt,negativeFeedbackInstrumentedItem:yt}=e,[c,pt]=React.useState("RequestFeedback"),it=n.msbDsbHost.getLocString("FeedbackButtonHintText"),rt=n.msbDsbHost.getLocString("PositiveFeedback"),ut=n.msbDsbHost.getLocString("NegativeFeedback"),ft=`msb-dsb-negative-feedback-button-${h}`,et=`msb-dsb-positive-feedback-button-${h}`,l="msb-dsb-feedback-tooltip-id",w=n.View.classNames(t.MDSB_FEEDBACK_ELEMENT_CLASS,"msbdsb_hyperlink","feedback-button"),wt="msb-dsb-visible-item",[bt,b]=React.useState(!1);React.useEffect(()=>{n.msbDsbFeedbackTracker.getHasProvidedFeedbackAsync(o).then(t=>{b(!t),n.msbDsbHost.updateInteractionModel(!0)})},[o]);const[ot,k]=React.useState(!1),[kt,dt]=React.useState(!1),st=React.useRef(null),a=React.useRef(null),ht=n.msbDsbHost.getLocString("FeedbackQueryText");let d=!1;const gt=300,y=(n,t,i)=>{d=!1,sb_st(()=>{var n;d||((n=a.current)===null||n===void 0?void 0:n.contains(document.activeElement))||!i||v(t,i)},n),kt&&b(!1)},g=(n,t)=>{d=!0,t&&f(n,t)},ct=n=>{const i=n===a?wt:t.VISIBLE_TOOLTIP_CLASS;(n===null||n===void 0?void 0:n.current)&&(n===s&&(n.current.onfocus=()=>{g(n,i)},n.current.onblur=()=>{y(0,n,i)}),n.current.onmouseenter=()=>{g(n,i)},n.current.onmouseleave=()=>{y(gt,n,i)})};ct(s);ct(a);const nt=()=>g(s,t.VISIBLE_TOOLTIP_CLASS),tt=()=>y(0,s,t.VISIBLE_TOOLTIP_CLASS),lt=async(t,i)=>{t.stopPropagation();const r=i||p=="MeetingPrep"?"AcknowledgeFeedbackProvided":"RequestAdvancedFeedback";pt(r);await n.msbDsbFeedbackTracker.updateProvidedFeedbackIdAsync(o);p==="MeetingPrep"&&n.msbDsbSubstrateLogger.logSearchFeedbackEvent(p,n.getDateWithTimezone(),i?"Yes":"No",ht,o,at);dt(!0)};return u(()=>{var i;if(c==="RequestAdvancedFeedback"?n.msbDsbHost.updateInteractionModel(!0):(ot&&((i=n.msbDsbHost.keyNavManager)===null||i===void 0?void 0:i.reapplyKeyboardFocus(et)),n.msbDsbHost.updateInteractionModel()),c!=="RequestFeedback"&&ot){const n=c=="AcknowledgeFeedbackProvided"?s:st;(n===null||n===void 0?void 0:n.current)&&(n.current.focus(),f(n,t.MDSB_KEYBOARD_FOCUS_CLASS),c=="AcknowledgeFeedbackProvided"&&(n.current.onblur=()=>{b(!1)}));k(!1)}},[c]),bt?React.createElement("span",{"data-msb-dsb-delay-blur":!0,id:`msb-dsb-tooltip-${h}`,ref:a,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`${"msb-dsb-feedback-tooltip msb-dsb-tooltip-text small-tooltip right-aligned-tooltip hide-tail"} ${t.MDSB_LIST_CONTAINER_CLASS}`,"aria-live":"polite","aria-labelledby":l,onMouseLeave:()=>y(0,s)},c==="RequestFeedback"&&React.createElement("div",{id:l,"aria-labelledby":"feedback-text",className:"horizontal_stack feedback-tooltip-content"},React.createElement("div",{id:"feedback-text",className:"feedback-text"},ht),React.createElement(i.WithInstrumentation,{instrumentedItem:vt,isSelectEvent:!0},React.createElement("button",{id:et,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:w,"aria-label":r(rt,it),onClick:async n=>{await lt(n,!0)},onKeyPress:()=>{k(!0)},onFocus:nt,onBlur:tt},rt)),React.createElement(i.WithInstrumentation,{instrumentedItem:yt,isSelectEvent:!0},React.createElement("button",{id:ft,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:w,"aria-label":r(ut,it),onClick:async n=>{await lt(n,!1)},onKeyPress:()=>{k(!0)},onFocus:nt,onBlur:tt},ut))),c==="AcknowledgeFeedbackProvided"&&React.createElement("p",{className:"feedback-tooltip-content",id:l,"aria-label":n.msbDsbHost.getLocString("AcknowledgeFeedbackProvidedText")},n.msbDsbHost.getLocString("AcknowledgeFeedbackProvidedText")),c==="RequestAdvancedFeedback"&&React.createElement("div",{className:"feedback-tooltip-content",id:l,role:"text","aria-label":n.msbDsbHost.getLocString("NegativeFeedbackProvidedText")},n.msbDsbHost.getLocString("NegativeFeedbackProvidedText")," ",React.createElement("button",{ref:st,id:ft,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:w,onFocus:nt,onBlur:tt,onClick:t=>{n.Host.showFeedbackForm(),t.stopPropagation()}},n.msbDsbHost.getLocString("RequestAdvancedFeedbackLinkText")))):null};i.SuggestedInfoIcon=({additionalCssClasses:r,containerLeft:u,containerRight:f})=>{const l=n.View.classNames(r,"info-icon-tooltip-base"),[a,h]=React.useState(!1),[c,e]=React.useState(0),o=React.useRef(),s=React.useRef();return React.useEffect(()=>{const t=o.current,n=s.current,i=new IntersectionObserver((i,r)=>{const o=i[0];if((o===null||o===void 0?void 0:o.isIntersecting)&&t&&n){const o=n.getBoundingClientRect(),s=Math.round((o.left+o.right)/2),i=Math.round(t.getBoundingClientRect().width),h=f-s,c=s-u;i/2>h?e(-1*h):i/2>c?e(c-i):e(i/-2);r.disconnect()}});return i.observe(n),()=>{i.disconnect()}},[o.current,s.current,u,f]),React.createElement("span",{id:"suggested-info-icon",className:l,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,role:"tooltip","aria-labelledby":"suggested_info_tooltip",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)},React.createElement("span",{id:"suggested_info_tooltip",className:"info-icon-tooltip",ref:o,style:c?{right:`${c}px`}:{}},n.msbDsbHost.getLocString("SuggestedInfoToolTipText")),React.createElement("span",{className:"suggested_info",ref:s,onClick:n=>{n.stopPropagation()}},a?React.createElement(i.FluentIcon,{icon:"infoIconHover",additionalCssClasses:"info_icon"}):React.createElement(i.FluentIcon,{icon:"infoIcon",additionalCssClasses:"info_icon"})))};i.SearchSuggestions=({suggestions:r,instrumentedItem:n,suggestionsListId:u})=>{if(!r||r.length==0)return null;const f=i.useDispatchSetWsbRequeryAction();return React.createElement(i.WithInstrumentation,{instrumentedItem:n},React.createElement("div",{className:`msb_dsb_search_suggestion_container ${t.MDSB_LIST_CONTAINER_CLASS}`,tabIndex:-1},r===null||r===void 0?void 0:r.map((n,t)=>React.createElement(i.SuggestionPill,{id:`${u}_${t}`,searchText:n.title,accessibilityProps:r.length>1?{ariaSetPosition:t+1,ariaSetSize:r.length}:{},onClick:t=>{f(n.title,n.scope),t.stopPropagation()},icon:n.icon}))))};i.LearningCard=({learningAnswer:r})=>{const{suggestions:u,instrumentedItem:f}=r,e=u?u.length:0,o=i.useDispatchLaunchProactiveWorkSearchAction(),s=React.useCallback(t=>{o({query:t.title,intent:"None",formCode:n.msbDsbHost.getFormCode()})},[]);return React.createElement("div",{className:"msbdsb_learning_card"},React.createElement("div",null,React.createElement("div",{className:"learning_card_header",role:"text"},React.createElement("div",{className:"learning_card_title"},n.msbDsbHost.getLocString("LearningCardTitle")),React.createElement("div",{className:"learning_card_details"},n.msbDsbHost.getLocString("LearningCardDetails"))),React.createElement("div",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`learning_card_suggestions_container ${t.MDSB_LIST_CONTAINER_CLASS}`},u.map((n,t)=>{const r=t+1;return React.createElement(i.WithInstrumentation,{instrumentedItem:f,isBingTransfer:!0},React.createElement(i.SuggestionPill,{key:`learning-card-suggestion-${t}`,id:`suggestion-${t}`,searchText:n.title,accessibilityProps:{ariaSetPosition:r,ariaSetSize:e},onClick:()=>s(n)}))}))),React.createElement(i.WebSearchImage,null))};i.MsbDsbErrorBoundary=({children:r,wrappedComponentName:o,answerId:n,answerType:t,fallback:u,fallbackInstrumentSectionName:f})=>{const s=i.useErrorBoundaryResetKey(),h=i.useDispatchHideAnswerAction();return React.createElement(e,{answerId:n,answerType:t,fallback:u,fallbackInstrumentSectionName:f,hideAnswer:h,key:s,wrappedComponentName:o},r)};class e extends React.Component{constructor(){super(...arguments);this.state={error:undefined,fallbackInstrumentedItem:undefined}}componentDidCatch(t){const{answerId:e,answerType:u,fallback:o,fallbackInstrumentSectionName:f,hideAnswer:s,wrappedComponentName:i}=this.props,{fallbackInstrumentedItem:h}=this.state;let r=h;if(u)try{s(u,e)}catch(t){const r=t instanceof Error?t.message:"Unknown error",u=JSON.stringify(t,Object.getOwnPropertyNames(t));n.msbDsbLogger.logError("Wsb Dsb Error Boundary Hide Answer Error",r,u)}try{o&&f&&!r&&(r=n.msbDsbHost.instrumentationManager.createInstrumentedItem(f))}catch(t){const r=t instanceof Error?t.message:"Unknown error",u=JSON.stringify(t,Object.getOwnPropertyNames(t));n.msbDsbLogger.logError("Wsb Dsb Error Boundary Create Instrumented Item Error",r,u)}this.setState({error:t,fallbackInstrumentedItem:r});n.msbDsbLogger.logUiError(t,i)}render(){const{error:t,fallbackInstrumentedItem:r}=this.state,{children:u,fallback:f,wrappedComponentName:e}=this.props;if(t){const u=React.createElement(i.WithInstrumentation,{instrumentedItem:r},f),o=n.msbHost.isMsbInternalTenant();if(o&&n.TestHookUrlParameters){const n=`[Error][MsbDsb] ${e} failed to render: ${t}`;return React.createElement("div",{className:"msbdsb_errorboundary_msit_block"},u,React.createElement("div",{className:"msbdsb_errorboundary_msit_error"},n))}return React.createElement(React.Fragment,null,u)}return u}}i.MsbDsbErrorBoundaryImpl=e;i.MsbDsbErrorBoundaryDefaultFallback=()=>{const r=t.DataContext.createLearningCardViewDataModel();return r?(React.useEffect(()=>{n.msbDsbHost.updateInteractionModel()},[]),React.createElement("div",{className:"msbdsb_card_background"},React.createElement("div",{className:"msbdsb-mp-feed-card",role:"feed","aria-label":n.msbDsbHost.getLocString("BaseCardTitle")},React.createElement(i.M365FeedHeader,null),React.createElement("div",{className:"dsb-suggestions"},React.createElement(i.LearningCard,{learningAnswer:r}))))):null};i.OutlookIcon=({cssClasses:t})=>{const i=n.View.classNames("outlook_icon",t);return React.createElement(n.View.Icon,{additionalCssClass:i,icon:n.msbHost.iconUtils.getFluentIcon("outlookIcon")})};i.TeamsIcon=({cssClasses:t})=>{const i=n.View.classNames("teams_icon",t);return React.createElement(n.View.Icon,{additionalCssClass:i,icon:n.msbHost.iconUtils.getFluentIcon("teamsIcon")})};i.Microsoft365Icon=({cssClasses:t})=>{const i=n.View.classNames("microsoft365_icon",t);return React.createElement(n.View.Icon,{additionalCssClass:i,icon:n.msbHost.iconUtils.getFluentIcon("microsoft365Icon")})};i.WebSearchImage=({cssClasses:t})=>{const r=n.View.classNames("msbdsb_web_search_image",t),u=i.useIsDarkMode();return React.createElement(n.View.Icon,{additionalCssClass:r,icon:u?n.msbHost.iconUtils.getFluentIcon("webSearchDarkIcon"):n.msbHost.iconUtils.getFluentIcon("webSearchLightIcon")})};i.FluentIcon=({icon:r,additionalCssClasses:t})=>{const u=n.View.classNames("msbdsb_fluent_icon",t),f=i.useFluentIconSvgHtml(r);return React.createElement("div",{className:u,dangerouslySetInnerHTML:{__html:f}})};i.M365FeedHeader=()=>React.createElement("div",{className:"header"},React.createElement("div",{className:"horizontal_stack"},React.createElement("span",{className:"horizontal_stack"},React.createElement(i.Microsoft365Icon,{cssClasses:"company_icon"}),React.createElement("h2",{id:"header_title",className:"header_title"},n.msbDsbHost.getLocString("BaseCardTitle")))));i.WsbPeopleRequery=({id:s,query:c,referenceId:l,answerType:f,accessibilityProps:r,additionalCssClasses:u,children:o,childRef:e,isTabbable:h,traceId:a})=>{const v=i.useDispatchSetWsbRequeryAction(),y=i.useDispatchLaunchProactiveWorkSearchAction(),p=()=>{if(n.msbDsbSubstrateLogger.logSearchEntityActions(f,n.getDateWithTimezone(),"entityclicked",l,a),n.config.msbDsbOpenInEdge&&(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.isMsbDsbShown()))y({query:c,intent:"Person",formCode:n.msbDsbHost.getFormCode()});else{const t=n.msbHost.features.isWorkScopeDsbRedirectEnabled()?n.Scope.Work:n.Scope.People;v(c,t)}},w=n.View.classNames("people_requery_link",u);return React.createElement("button",{id:s,className:w,tabIndex:h?t.TAB_NAVIGATION_TAB_INDEX:null,ref:e,role:"button",onClick:n=>{p(),n.stopPropagation()},"aria-label":r.ariaLabel,"aria-labelledby":r.ariaLabelledBy,"aria-posinset":r.ariaSetPosition,"aria-setsize":r.ariaSetSize},o)};i.PeopleCentricSuggestions=({fullName:n,sectionName:r})=>{const[u,f]=React.useState(t.DataContext.generateRandomPersonCentricSuggestions(n));return!n||!u?null:(React.useEffect(()=>{f(t.DataContext.generateRandomPersonCentricSuggestions(n))},[n]),React.createElement(i.MsbDsbErrorBoundary,{wrappedComponentName:"PeopleCentricSuggestions"},React.createElement(y,{suggestions:u,sectionName:r})))};i.SuggestionPill=({searchText:s,accessibilityProps:n,onClick:o,icon:u,id:f,maxDisplayedChars:e,buttonProps:r})=>{const[a,h]=React.useState(s),[v,l]=React.useState(!1);return React.useEffect(()=>{const n=e!==null&&e!==void 0?e:c;s.length>n?(h(t.DataContext.getTruncatedText(s,n)),l(!0)):(h(s),l(!1))},[s,e]),React.createElement("button",Object.assign({id:f,tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:"msbdsb_suggestion_pill msb-dsb-tooltip","aria-label":s,"aria-posinset":n.ariaSetPosition,"aria-setsize":n.ariaSetSize,onClick:o},r),v&&React.createElement("div",{className:"msb-dsb-tooltip-text msbdsb_suggestion_pill_tooltip hide-tail"},s),React.createElement("div",{className:"msbdsb_suggestion_contents horizontal_stack hideable"},u&&React.createElement(i.FluentIcon,{icon:u,additionalCssClasses:"suggestion_pill_icon"}),React.createElement("div",{className:"msbdsb_suggestion_pill_txt"},a)))};const y=({suggestions:u,sectionName:r})=>{t.checkTestHookParamsAndThrowError===null||t.checkTestHookParamsAndThrowError===void 0?void 0:t.checkTestHookParamsAndThrowError(r);const c=i.useDispatchSetWsbRequeryAction(),[f,o]=React.useState([]);React.useEffect(()=>{n.msbDsbHost.updateInteractionModel()},[f.length]);const s=React.useRef(null),e=React.useRef(null),l=(n,t,i)=>{const f=i[0],{isIntersecting:e}=f;let r=n.firstElementChild;if(e&&r){let f=0,i=-1;const{paddingLeft:e,paddingRight:s}=window.getComputedStyle(n),c=parseFloat(e)||0,l=parseFloat(s)||0,a=n.clientWidth-c-l;do f+=Math.abs(r.getBoundingClientRect().right-r.getBoundingClientRect().left),i+=1,r=r.nextElementSibling;while(f<=a&&i<u.length&&r);o(u.slice(0,i));h(t)}},h=n=>{n.disconnect()};return React.useEffect(()=>{var n;o(u);const t=s.current;return t&&(e.current=new IntersectionObserver(n=>l(t,e.current,n)),(n=e.current)===null||n===void 0?void 0:n.observe(t)),()=>{h(e.current)}},[u]),React.createElement("div",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,ref:s,className:`msb_dsb_person_centric_search ${t.MDSB_LIST_CONTAINER_CLASS}`},f===null||f===void 0?void 0:f.map((n,t)=>{const f=`msbdsb_search_suggestions_${r}_${t+1}`;return React.createElement(i.WithInstrumentation,{key:f,instrumentedItem:n.instrumentedItem,additionalCssClass:"msb_dsb_inline_instrumentation_container"},React.createElement(i.SuggestionPill,{searchText:n.title,icon:"searchIcon",id:f,key:n.title,accessibilityProps:{ariaSetPosition:t+1,ariaSetSize:u.length},onClick:()=>c(n.query,n.scope)}))}))},p=({paginationId:u,pageIndex:r,activePageIndex:t})=>{const f=i.useDispatchNavigatePageAction(),e=t=>{const i={PaginationId:u};n.InstrumentationHelper.logClientInstEvent("Select","MsbDsbPaginationDotSelected",n.SequenceNumberManager.getSequenceNumber(),i);f(u,t)},o=r==t?"msb_dsb_pagination_dot msb_dsb_pagination_dot_active":"msb_dsb_pagination_dot";return React.createElement("span",{className:o,onClick:()=>e(r),id:`msb_dsb_pagination_dot_${u}_${r}`})};i.PaginationDotList=({paginationId:i,currentPageIndex:n,numberOfPages:t})=>{if(t<=1)return null;const r=[];for(let u=0;u<t;u++){const t=React.createElement(p,{paginationId:i,pageIndex:u,activePageIndex:n,key:`${i}-${u}`});r.push(t)}return React.createElement("div",{className:"msb_dsb_pagination_dot_list_container"},React.createElement("div",{className:"msb_dsb_pagination_dot_list"},r))};i.FlipperControl=({controlType:r,paginationId:e,currentPageIndex:u,numberOfPages:f})=>{if(f<=1)return null;const s=i.useDispatchNavigatePageAction(),[h,c]=React.useState(null),l=t=>{const r={PaginationId:e};n.InstrumentationHelper.logClientInstEvent("Select","MsbDsbPaginationFlipperSelected",n.SequenceNumberManager.getSequenceNumber(),r);const i=(u+t+f)%f;s(e,i);c(`Page ${i+1}`)};let o=r=="NEXT"?"flipper_next":"flipper_prev";o=o.concat(" msb_dsb_pagination_flipper_always_show");const a=r=="NEXT"?React.createElement(i.FluentIcon,{icon:"caretRight",additionalCssClasses:"msbdsb_pagination_flipper_right_icon"}):React.createElement(i.FluentIcon,{icon:"caretLeft",additionalCssClasses:"msbdsb_pagination_flipper_left_icon"}),v=r=="NEXT"?1:-1,y=r=="NEXT"?n.msbDsbHost.getLocString("RecommendPeopleNextPage",`${u+1}`):n.msbDsbHost.getLocString("RecommendPeoplePreviousPage",`${u+1}`);return React.createElement("div",{"aria-live":"polite"},React.createElement("button",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,id:`msb_dsb_pagination_flipper_${e}_${r}`,className:`msb_dsb_pagination_flipper ${o}`,onClick:()=>{l(v)},"aria-label":y},a),React.createElement("div",{className:"b_hide"},h))};i.PaginationFlippersControl=({paginationId:f,currentPageIndex:r,numberOfPages:u})=>(React.useEffect(()=>{n.msbDsbHost.updateInteractionModel()},[r]),React.createElement(React.Fragment,null,React.createElement("div",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`msb_dsb_recommendedpeople_flipper ${t.MDSB_LIST_CONTAINER_CLASS}`},React.createElement(i.FlipperControl,{controlType:"PREV",paginationId:f,numberOfPages:u,currentPageIndex:r})),React.createElement("div",{tabIndex:t.TAB_NAVIGATION_TAB_INDEX,className:`msb_dsb_recommendedpeople_flipper ${t.MDSB_LIST_CONTAINER_CLASS}`},React.createElement(i.FlipperControl,{controlType:"NEXT",paginationId:f,numberOfPages:u,currentPageIndex:r}))));i.M365HeaderCard=({isCondensed:r,children:t})=>React.createElement("div",{className:"msbdsb_card_background"},React.createElement("div",{className:`msbdsb-mp-feed-card ${!!r&&"msbdsb-condensed-feed-card"}`,role:"feed","aria-label":n.msbDsbHost.getLocString("BaseCardTitle")},React.createElement(i.M365FeedHeader,null),React.createElement("div",{className:"dsb-suggestions"},t)));i.combineLabelAndHintText=r;i.makeEnterKeyAsClickInRefComponentHandler=w;i.useSuggestionsInfoTooltipDimensions=b;i.useEffectSkipFirstRender=u;i.generateColourIndexFromId=o})(i=t.Components||(t.Components={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(n){var t;(function(n){function i(n,i,r=t){if(!n||!i)return null;let f=0,u=n;while(u&&!u.hasAttribute(i)&&f++<r)u=u.parentElement;return(u===null||u===void 0?void 0:u.hasAttribute(i))?u:null}const t=30;n.getNearestAncestorWithAttribute=i})(t=n.DataContext||(n.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(n){var t;(function(n){function t(n){return{type:"SET_IS_DARK_MODE",isDarkMode:n}}function i(n){return{type:"SET_MY_ORG_CHART_EXPANSION",isExpanded:n}}function r(n){return{type:"SET_EDU_CLASSES_EXPANSION",isExpanded:n}}function u(n){return{type:"SET_EDU_ASSIGNMENTS_EXPANSION",isExpanded:n}}function f(n){return{type:"SET_LAST_SELECTED_SCOPE",lastSelectedScope:n}}function e(n){return{type:"SET_BLEND_MODE",blendMode:n}}function o(n){return{type:"SET_MAIN_PAGE_DATA",mainPageData:n}}function s(n,t){return{type:"SET_PERSON_PHOTO",photoKey:n,photo:t}}function h(n,t){return{type:"SET_GROUP_PHOTO",photoKey:n,photo:t}}function c(n){return{type:"SET_M365APP_STATE",appStateList:n}}function l(n){return{type:"SET_IMAGE_OF_THE_DAY",imageOfTheDay:n}}function a(){return{type:"FETCH_IMAGE_OF_THE_DAY"}}function v(n){return{type:"FETCH_PERSON_PHOTO",photoKey:n}}function y(n){return{type:"FETCH_GROUP_PHOTO",photoKey:n}}function p(){return{type:"FETCH_M365APP_STATE"}}function w(n,t,i){return{type:"DISMISS_ANSWER",answerType:n,answerId:t,dismissAction:i}}function b(n,t){return{type:"HIDE_ANSWER",answerType:n,answerId:t}}function k(n,t){return{type:"SET_FEED_ITEM_PREVIEW",feedItemId:n,itemPreview:t}}function d(n,t){return{type:"FETCH_FEED_ITEM_PREVIEW",feedItem:n,size:t}}function g(n,t){return{type:"SET_FILE_ICON",extension:n,fileIcon:t}}function nt(n){return{type:"FETCH_FILE_ICON",extension:n}}function tt(n,t){return{type:"SET_FLUENT_ICON_SVG_HTML",icon:n,svgHtml:t}}function it(n){return{type:"FETCH_FLUENT_ICON_SVG_HTML",icon:n}}function rt(n,t){return{type:"SET_WSB_REQUERY",query:n,scope:t}}function ut(n){return{type:"LAUNCH_URI",uri:n}}function ft(n){return{type:"LAUNCH_PROACTIVE_WORK_SEARCH",args:n}}function et(){return{type:"FORCE_DSB_REFRESH_ACTION"}}function ot(n){return{type:"SET_RECOMMENDED_PEOPLE_PAGINATION_SETTING",paginationSetting:n}}function st(n,t){return{type:"NAVIGATE_PAGE",paginationId:n,targetPageIndex:t}}function ht(){return{type:"SET_CHAT_UPSELL_CURRENT_IDX"}}n.setIsDarkModeAction=t;n.setMyOrgChartExpansionAction=i;n.setEduClassesExpansionAction=r;n.setEduAssignmentsExpansionAction=u;n.setLastSelectedScopeAction=f;n.setBlendModeAction=e;n.setMainPageDataAction=o;n.setPersonPhotoAction=s;n.setGroupPhotoAction=h;n.setM365AppStateAction=c;n.setImageOfTheDayAction=l;n.fetchImageOfTheDayAction=a;n.fetchPersonPhotoAction=v;n.fetchGroupPhotoAction=y;n.fetchM365AppStateAction=p;n.dismissAnswerAction=w;n.hideAnswerAction=b;n.setFeedItemPreviewAction=k;n.fetchFeedItemPreviewAction=d;n.setFileIconAction=g;n.fetchFileIconAction=nt;n.setFluentIconSvgHtmlAction=tt;n.fetchFluentIconSvgHtmlAction=it;n.setWsbRequeryAction=rt;n.launchUriAction=ut;n.launchProactiveWorkSearch=ft;n.forceDSBRefreshAction=et;n.setRecommendedPeoplePaginationSettingAction=ot;n.navigatePageAction=st;n.setChatUpsellCurrIdxStateAction=ht})(t=n.DataContext||(n.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){t.CacheSchemaVersion=8;const i="mdsb-",r=i+"v",u="mdsbCacheReused";class f{constructor(){var t;n.config.msbEnableAccountManager?(t=n.msbHost.accountManager)===null||t===void 0?void 0:t.bindAccountStatusChanged(async t=>{if(t.changeType==="AccountSwitchStarted"&&t.currentAccount){if(!this.tempPendingMigrateLightweightStorageCachePromise&&!t.previousAccount)try{this.tempPendingMigrateLightweightStorageCachePromise=this.tempMigrateLightweightStorageCache(t.currentAccount.accountId);await this.tempPendingMigrateLightweightStorageCachePromise}catch(r){}finally{this.tempPendingMigrateLightweightStorageCachePromise=undefined}this.pendingEnsureVersionPromise=this.ensureVersionAsync();try{await this.pendingEnsureVersionPromise}catch(i){const t=n.msbHost.isMsbInternalTenant()?n.stringifyError(i):undefined;_w.bfbWsbTel&&bfbWsbTel.logError("Wsb Dsb Cache Ensure Version Error","",{additionalMessage:t})}finally{this.pendingEnsureVersionPromise=undefined}n.config.msbDsbCleanCache&&await this.internalClearAsync()}}):n.Host.bindBootstrapDone(async()=>{this.pendingEnsureVersionPromise=this.ensureVersionAsync();try{await this.pendingEnsureVersionPromise}catch(t){const i=n.msbHost.isMsbInternalTenant()?n.stringifyError(t):undefined;_w.bfbWsbTel&&bfbWsbTel.logError("Wsb Dsb Cache Ensure Version Error","",{additionalMessage:i})}finally{this.pendingEnsureVersionPromise=undefined}n.config.msbDsbCleanCache&&await this.internalClearAsync()})}async setDataAsync(t,i){try{if(this.pendingEnsureVersionPromise&&await this.pendingEnsureVersionPromise,n.config.msbEnableAccountManager){const{accountId:r}=n.msbHost.accountManager.ensureCurrentAccount("MsbDsb/CacheManager::setDataAsync");await n.msbHost.accountCache.setAccountKvItemAsync(r,this.makeKey(t),i)}else n.LightweightStorage.setItem(this.makeKey(t),JSON.stringify(i))}catch(r){this.logCacheOperationError("set",r)}}async getDataAsync(t){try{if(this.pendingEnsureVersionPromise&&await this.pendingEnsureVersionPromise,n.config.msbEnableAccountManager){const{accountId:i}=n.msbHost.accountManager.ensureCurrentAccount("MsbDsb/CacheManager::getDataAsync");return await n.msbHost.accountCache.getAccountKvItemAsync(i,this.makeKey(t))}else{const i=n.LightweightStorage.getItem(this.makeKey(t));if(!i)return undefined;try{return JSON.parse(i)}catch(r){}return undefined}}catch(i){return this.logCacheOperationError("get",i),undefined}}async deleteDataAsync(t){try{if(this.pendingEnsureVersionPromise&&await this.pendingEnsureVersionPromise,n.config.msbEnableAccountManager){const{accountId:i}=n.msbHost.accountManager.ensureCurrentAccount("MsbDsb/CacheManager::deleteDataAsync");await n.msbHost.accountCache.deleteAccountKvItemAsync(i,this.makeKey(t))}else n.LightweightStorage.removeItem(this.makeKey(t))}catch(i){this.logCacheOperationError("delete",i)}}logCacheOperationError(t,i){let r;(i instanceof n.MsbAccountNoCurrentAccountError||i instanceof n.MsbAccountCacheParameterFalsyError)&&(r=i.message);const u=r?`${t}: ${r}`:t,f=n.msbHost.isMsbInternalTenant()?n.stringifyError(i):undefined;_w.bfbWsbTel&&bfbWsbTel.logError("Wsb Dsb Cache Operation Error",u,{additionalMessage:f})}async internalClearAsync(){if(n.config.msbEnableAccountManager){const{accountId:t}=n.msbHost.accountManager.ensureCurrentAccount("MsbDsb/CacheManager::clearAsync");await n.msbHost.accountCache.deleteAccountKvItemsWithPrefixAsync(t,i)}else n.LightweightStorage.removeItemsWithKeyPrefix(i)}calculateSize(){if(n.config.msbEnableAccountManager)throw new Error("Deprecated - CacheManager.calculateSize");let t=0,r=0,u=0,f=0,e=0,o=0;const s=n.LightweightStorage.getLength();for(let h=0;h<s;h++){const s=n.LightweightStorage.key(h),c=s&&n.LightweightStorage.getItem(s),l=(s===null||s===void 0?void 0:s.length)||0,a=(c===null||c===void 0?void 0:c.length)||0;t+=l;r+=a;(s===null||s===void 0?void 0:s.startsWith(i))?(e+=l,o+=a):(s===null||s===void 0?void 0:s.startsWith("Msb"))&&(u+=l,f+=a)}return{totalKeyStringLength:t,totalValueStringLength:r,msbKeyStringLength:u,msbValueStringLength:f,msbDsbKeyStringLength:e,msbDsbValueStringLength:o}}makeKey(n){return i+n}async tempMigrateLightweightStorageCache(t){if(!n.LightweightStorage.getItem(u)){n.LightweightStorage.setItem(u,"1");const r=n.LightweightStorage.getLength();for(let u=0;u<r;u++){const r=n.LightweightStorage.key(u),f=r&&n.LightweightStorage.getItem(r);f&&(r===null||r===void 0?void 0:r.startsWith(i))&&await n.msbHost.accountCache.setAccountKvItemAsync(t,r,f)}}}async ensureVersionAsync(){if(n.config.msbEnableAccountManager){if(this.tempPendingMigrateLightweightStorageCachePromise)try{await this.tempPendingMigrateLightweightStorageCachePromise}catch(f){}const{accountId:i}=n.msbHost.accountManager.ensureCurrentAccount("MsbDsb/CacheManager::ensureVersionAsync"),u=await n.msbHost.accountCache.getAccountKvItemAsync(i,r);(typeof u!="number"||u<t.CacheSchemaVersion)&&(await this.internalClearAsync(),await n.msbHost.accountCache.setAccountKvItemAsync(i,r,t.CacheSchemaVersion))}else{const u=n.LightweightStorage.getItem(r),i=Number(u);(isNaN(i)||i<t.CacheSchemaVersion)&&(await this.internalClearAsync(),n.LightweightStorage.setItem(r,`${t.CacheSchemaVersion}`))}}}t.CacheManager=f})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){t.MiddleTierResponseCacheKey="mtr";t.MiddleTierResponseTimeCacheKey="mtrt";t.FeedDismissalHistoryCacheKey="dhis";t.LastSuccessfulMTRequestKey="last-successful-mt-request";t.LastMTRequestKey="last-mt-request";t.SuggestionsCacheKey="sugg";t.M365AppPocList=["Microsoft.Office.ONENOTE.EXE.15","Microsoft.Office.WINWORD.EXE.15","Microsoft.Office.POWERPNT.EXE.15","Microsoft.Office.EXCEL.EXE.15"];const r="ImageOfTheDay",f=1e4,u="MainPageFecth";class i{constructor(n){this.message=n}}class e{constructor(t,i,r,u){this.msbServiceClient=t;this.cacheManager=i;this.commercialDsbServiceClient=r;this.dynamicBlendedDataManager=u;this.dataChangedHandlers={};this.pendingCalls={};sb_st(()=>{n.msbDsbHost.bindBlendModeChanged(this.handleBlendModeChangedAsync.bind(this))},1)}async refreshAsync(n){this.isBackgroundUpdate=n.isBackgroundUpdate;await this.refreshMainPageAsync(n)}getPendingRequestCount(){return Object.keys(this.pendingCalls).length}canFetchMainPageData(){return!this.hasPendingCall(u)}bindDataChanged(n,t){this.dataChangedHandlers[n]=t}unbindDataChanged(n){delete this.dataChangedHandlers[n]}isDataChangeHandlerBound(n){return!!this.dataChangedHandlers[n]}async fireDataChangedAsync(n,...t){const i=Object.getOwnPropertyNames(this.dataChangedHandlers).map(async i=>{try{await this.dataChangedHandlers[i](n,...t)}catch(r){}});try{await Promise.all(i)}catch(r){}}getMainPageData(){return this.mainPageData}getBlendedRegionalData(){return this.blendedRegionalData}isBlendedTopRegionDataReady(){var n,t;if((n=this.dynamicBlendedDataManager)!==null&&n!==void 0)return n.isBlendedTopRegionDataReady((t=this.blendedRegionalData)===null||t===void 0?void 0:t.topBlendedRegionData)}getDismissalHistory(){var n;return(n=this.dismissalHistory)!==null&&n!==void 0?n:{}}getSuggestionsData(){return n.config.msbDsbRecentQueriesEnabled?this.suggestionsData:undefined}updateExistingMainPageProperties(n){if(this.mainPageData)for(const t of Object.keys(n))Object.prototype.hasOwnProperty.call(this.mainPageData,t)&&(this.mainPageData[t]=n[t])}isBundleReloadColdStart(){return this.mainPageData==null}log3SRenderEvents(t,i){if(i||n.msbDsbSubstrateLogger.setLogicalIds(this.mainPageData),!t){const t=n.getDateWithTimezone(),r=n.getCurrentTime();i&&n.msbDsbSubstrateLogger.logCachedRenderEvents(this.mainPageData,t);n.msbDsbSubstrateLogger.logResultsRenderEvents(this.mainPageData,i?undefined:r);n.msbDsbSubstrateLogger.logClientLayoutEvents(this.mainPageData,t)}}async handleBlendModeChangedAsync(n){await this.fireDataChangedAsync("BlendMode",n.nextBlendMode)}async constructMainPageDataAsync(i,r,u){const f=t.convertMainPageResponseToViewDataModel(i,r,await this.getLastMtRequestAsync(),u);return n.msbDsbHost.gleamManager.setMainPageGleamData(f),f}async getCachedResponseAsync(){return await this.cacheManager.getDataAsync(t.MiddleTierResponseCacheKey)}async storeMiddleTierResponseAsync(i){await this.cacheManager.setDataAsync(t.MiddleTierResponseCacheKey,i);await this.cacheManager.setDataAsync(t.MiddleTierResponseTimeCacheKey,n.getCurrentTime())}async storeQuerySuggestionsDataAsync(n){await this.cacheManager.setDataAsync(t.SuggestionsCacheKey,n)}async clearMiddleTierResponseAsync(){if(n.config.msbEnableAccountManager)throw new Error("MsbDsb/ExternalDataManager::clearMiddleTierResponseAsync: NotSuported");await this.cacheManager.deleteDataAsync(t.MiddleTierResponseCacheKey);await this.cacheManager.deleteDataAsync(t.MiddleTierResponseTimeCacheKey);await this.cacheManager.deleteDataAsync(t.SuggestionsCacheKey)}async refreshMainPageAsync(r){var h,c,l,a,v,y,p,w,b,k,d,g,nt,tt;const ft=n.getCurrentTime(),{shouldFetch:it,shouldRender:rt,isBackgroundUpdate:f}=r;let e;n.msbPerfLogger&&(typeof this.lastMainPagePerfMarkCallId=="undefined"&&(this.lastMainPagePerfMarkCallId=0),e=this.lastMainPagePerfMarkCallId++,n.msbPerfLogger.mark(n.MsbPerfProbe.DsbMainPageRefreshStarted,e));const ut=!it&&rt,o=this.isBundleReloadColdStart();let s=this.suggestionsData;if(o||ut){const i=!(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbNoCache)&&await this.getCachedResponseAsync();if(i?(this.dismissalHistory=await this.cacheManager.getDataAsync(t.FeedDismissalHistoryCacheKey),this.mainPageData=await this.constructMainPageDataAsync(i,this.dismissalHistory,!0),n.config.msbDsbDynamicBlend&&(this.blendedRegionalData=this.dynamicBlendedDataManager.constructBlendedRegionalData(this.mainPageData)),await this.fireDataChangedAsync("MainPageData",e),this.log3SRenderEvents(f,!0)):(this.mainPageData=await this.constructMainPageDataAsync(undefined,undefined,!1),n.config.msbDsbDynamicBlend&&(this.blendedRegionalData=this.dynamicBlendedDataManager.constructBlendedRegionalData(this.mainPageData)),await this.fireDataChangedAsync("MainPageData",e)),n.config.msbDsbRecentQueriesEnabled){const i=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbNoCache)?undefined:await this.cacheManager.getDataAsync(t.SuggestionsCacheKey);s=i}}if(it){n.msbPerfLogger===null||n.msbPerfLogger===void 0?void 0:n.msbPerfLogger.mark(n.MsbPerfProbe.DsbMainPageRequested,e);const ut=await this.getCachedResponseAsync(),st=t.getAnswersInCacheHashes(ut);let nt="Succeeded",it="",et=undefined,ot=undefined;try{const p=await this.recordRequestAsync(u,()=>this.msbServiceClient.getMainPageAsync(st));et=p.responseContext.requestSentTime;ot=p.responseContext.responseReceivedTime;let i=p.result;it=(h=p.responseContext.serverTraceId)!==null&&h!==void 0?h:"";n.msbPerfLogger===null||n.msbPerfLogger===void 0?void 0:n.msbPerfLogger.mark(n.MsbPerfProbe.DsbMainPageResponded,e);n.config.msbDsbOrgV2&&t.logOrgChartChanges(i,it);const w=t.getAnswersInCache(ut),b=((a=(l=(c=this.dismissalHistory)===null||c===void 0?void 0:c.dismissedAnswers)===null||l===void 0?void 0:l.length)!==null&&a!==void 0?a:0)>0;if(i=t.replaceFailedAnswersWithCachedAnswers(i,w,b),i=t.rehydrateAnswersFromCache(i,w),await this.cacheManager.deleteDataAsync(t.FeedDismissalHistoryCacheKey),this.dismissalHistory=undefined,this.mainPageData=await this.constructMainPageDataAsync(i,undefined,!1),n.config.msbDsbDynamicBlend&&(this.blendedRegionalData=await this.dynamicBlendedDataManager.constructBlendedRegionalData(this.mainPageData)),await this.storeMiddleTierResponseAsync(i),n.config.msbDsbRecentQueriesEnabled&&(s=t.convertMainPageToQuerySuggestionsData(i,await this.getLastMtRequestAsync()),await this.storeQuerySuggestionsDataAsync(s)),n.config.msbDsbBadging){let t=await n.msbDsbHost.getMtHasNewContentAsync();t||(t=!!(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbBadgingMtAlwaysNewContent)||!!(i===null||i===void 0?void 0:i.hasNewContent),await n.msbDsbHost.setMtHasNewContentAsync(t))}await n.msbDsbHost.gleamManager.setGleamContentToDisplayAsync((v=this.mainPageData)===null||v===void 0?void 0:v.gleamDataPair,!0,"MTFetchSucceed",(y=this.mainPageData)===null||y===void 0?void 0:y.scenario,"ExternalDataManager.refreshMainPageAsync",f);const k=`[${(new Date).toLocaleTimeString("en-US")}] `;(o||rt||f)&&(await this.fireDataChangedAsync("MainPageData",e),this.log3SRenderEvents(f,!1))}catch(tt){let t=!1;if(tt instanceof i?(nt="IgnoredConcurrent",t=!0):tt instanceof n.MsbHttpError?(nt="FailedHttpError",it=(p=tt.responseContext.serverTraceId)!==null&&p!==void 0?p:""):nt=tt instanceof n.MsbNoMsbTokenError?"FailedNoToken":"FailedOther",!t){await n.msbDsbHost.gleamManager.setGleamContentToDisplayAsync((w=this.mainPageData)===null||w===void 0?void 0:w.gleamDataPair,!0,"MTFetchFailed",(b=this.mainPageData)===null||b===void 0?void 0:b.scenario,"ExternalDataManager.catchError",f);const t=tt;n.msbDsbLogger.logHttpError("Wsb Dsb Fetch MainPage Feed Failed",tt,f);this.onRefreshFinished()}}if(nt!=="IgnoredConcurrent"){const t=(d=(k=n.msbDsbHost.gleamManager.getDynamicSearchBoxContent())===null||k===void 0?void 0:k.attributes)===null||d===void 0?void 0:d.contentKey;n.msbDsbLogger.logMTRefresh(nt,it,{contentKey:t,scenario:(g=this.mainPageData)===null||g===void 0?void 0:g.scenario,BG:f,rfrStart:ft,rfrEnd:n.getCurrentTime(),ReqTS:et,ResTS:ot})}await this.cacheMTResultAsync(nt,it)}else{let t="NonFetchRefresh",i="ExternalDataManager.NonFetchRefresh";o&&(t="ColdStart",i="ExternalDataManager.isColdStart");await n.msbDsbHost.gleamManager.setGleamContentToDisplayAsync((nt=this.mainPageData)===null||nt===void 0?void 0:nt.gleamDataPair,!1,t,(tt=this.mainPageData)===null||tt===void 0?void 0:tt.scenario,i,f);this.onRefreshFinished(!0)}this.suggestionsData=s}async cacheMTResultAsync(i,r){const u={traceId:r,result:i,timestamp:n.getCurrentTime()};await this.cacheManager.setDataAsync(t.LastMTRequestKey,u);i==="Succeeded"&&await this.cacheManager.setDataAsync(t.LastSuccessfulMTRequestKey,u)}onRefreshFinished(t){!n.msbDsbHost.isMsbDsbShown(n.Host.getQuery())||t||this.isBackgroundUpdate||n.msbDsbHost.instrumentationManager.safeInstrumentDSB();this.isBackgroundUpdate&&n.msbDsbHost.safeCallAllowSuspension();this.isBackgroundUpdate=undefined}async dismissAnswerAsync(i,r,u){const o=await this.cacheManager.getDataAsync(n.MsbDsb.DataContext.FeedDismissalHistoryCacheKey);if(this.dismissalHistory=n.MsbDsb.DataContext.addDismissedAnswerId(r,o),await this.cacheManager.setDataAsync(n.MsbDsb.DataContext.FeedDismissalHistoryCacheKey,this.dismissalHistory),u){const e=t.convertAnswerTypeToServiceContract(i);try{await this.msbServiceClient.dismissAnswerAsync(e,r)}catch(f){const t=f;n.msbDsbLogger.logHttpError("Wsb Dsb Dismiss Answer Failed",f)}}}async flushSubstrateLoggingEventsAsync(){if(n.config.msbDsbEnable3sTelemetry){const i=n.msbDsbSubstrateLogger.getLogs();if(i.length>0)try{await this.msbServiceClient.flushSubstrateLoggingEventsAsync(i);n.msbDsbSubstrateLogger.clearLogs()}catch(t){const i=t;n.msbDsbLogger.logHttpError("Wsb Dsb Flush Substrate Logging Events Failed",t)}}else n.msbDsbSubstrateLogger.clearLogs()}sendTelemetryForUIChange(){n.msbDsbHost.instrumentationManager.safeInstrumentDSB();const t=n.msbDsbHost.instrumentationManager.getShownComponents();n.msbDsbLogger.logMainPageShownEvent(t)}async fetchImageOfTheDayPhotoAsync(){const e=this.getApiCallKey("fetchImageOfTheDay",{ImageOfTheDayCacheKeyName:r}),u=await this.cacheManager.getDataAsync(e),o=n.isNewDay(this.currentImageOfTheDayCacheTime);if(!o&&(u===null||u===void 0?void 0:u.scenarios)){await this.fireDataChangedAsync(r,t.convertImageOfTheDayToViewDataModel(u));return}o&&(this.currentImageOfTheDayCacheTime=n.getCurrentTime());try{const n=await this.recordRequestAsync(e,()=>this.commercialDsbServiceClient.getImageOfTheDayAsync());if(n){await this.cacheManager.setDataAsync(e,n);const i=t.convertImageOfTheDayToViewDataModel(n);await this.fireDataChangedAsync(r,i)}}catch(f){if(f instanceof i)return;const t=f;n.msbDsbLogger.logHttpError("Wsb Dsb Fetch Image Of The Day Failed",f)}}async fetchPersonPhotoAsync(t){const u=this.getApiCallKey("fetchPersonPhotoAsync",{photoKey:t});try{const i=await this.recordRequestAsync(u,()=>n.msbHost.photoManager.getPhotoAsync(t,"PersonPhoto","Dsb",{isBackgroundUpdate:this.isBackgroundUpdate,page:"DSB",serverRefreshGuid:n.msbDsbLogger.getServerRefreshGuid()}));i&&await this.fireDataChangedAsync("PersonPhoto",t,Object.assign({},i))}catch(r){if(r instanceof i)return;n.msbDsbLogger.logError("Wsb Dsb Fetch Person Photo Unexpected Error")}}async fetchGroupPhotoAsync(r){const e=this.getApiCallKey("fetchGroupPhotoAsync",{photoKey:r}),u=await this.cacheManager.getDataAsync(e);if((u===null||u===void 0?void 0:u.imageInBase64)||(u===null||u===void 0?void 0:u.noImage)){await this.fireDataChangedAsync("GroupPhoto",r,u);return}try{const i=await this.recordRequestAsync(e,()=>this.msbServiceClient.getGroupPhotoAsync(r)),n=t.convertPhotoToViewDataModel(i);await this.fireDataChangedAsync("GroupPhoto",r,n);await this.cacheManager.setDataAsync(e,n)}catch(f){if(f instanceof i)return;const r=JSON.stringify(f,Object.getOwnPropertyNames(f)),t=f;n.msbDsbLogger.logHttpError("Wsb Dsb Fetch Group Photo Failed",f)}}async fetchM365AppListStateAsync(){try{const i=await SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findAppsAsync(t.M365AppPocList);if(!i){await this.fireDataChangedAsync("M365AppList",[]);return}const r=t.M365AppPocList.map(async t=>{const r=i[t],u=n.getIcon(r,r.id,"appList",!0,!1,undefined,r.isImmersive?r.logoBackgroundColor:undefined,0),f=await new Promise(n=>{u(8,t=>{n(t)})});return{appItem:r,appIcon:f}}),u=await Promise.all(r);await this.fireDataChangedAsync("M365AppList",u)}catch(i){const t=JSON.stringify(i,Object.getOwnPropertyNames(i));n.msbDsbLogger.logError("Wsb Dsb Fetch M365 App List Failed");await this.fireDataChangedAsync("M365AppList",[])}}async fetchFeedItemPreviewAsync(r,u="Medium"){const{preview:e,itemId:o,category:s}=r||{};if(e){const{previewUrl:h,previewProxyUrl:c}=e;if(!n.msbHost.isEduTenant()){const l=this.getApiCallKey("fetchFeedItemPreviewAsync",{previewType:s,itemId:o});try{const n=await this.recordRequestAsync(l,()=>this.msbServiceClient.getFeedItemPreviewAsync(s,h,c,u)),i=t.convertFeedItemPreviewToViewDataModel(n);await this.fireDataChangedAsync("FeedItemPreview",o,i)}catch(f){if(f instanceof i)return;if(f instanceof n.MsbHttpError){const{responseContext:{statusCode:n}}=f;if(n==204||n==304)return}const t=f;n.msbDsbLogger.logHttpError("Wsb Dsb Fetch FeedItem Preview Failed",f)}}}}async fetchFileIconAsync(t){if(t.toLowerCase()==="pdf"){const i={type:0,content:n.getImageUrl("ODSWG.c661ecaf-8056-4219-9c6d-e7dc16b7fadc")};await this.fireDataChangedAsync("FileIcon",t,i);return}const u=this.getApiCallKey("fetchFileIconAsync",{extension:t});try{const n=await this.recordRequestAsync(u,()=>this.msbServiceClient.getFileIconAsync(t)),i=n;await this.fireDataChangedAsync("FileIcon",t,i)}catch(r){if(r instanceof i)return;const t=r;n.msbDsbLogger.logHttpError("Wsb Dsb Fetch File Icon Failed",t)}}async fetchFluentIconSvgHtmlAsync(t){var u;try{const r=(u=n.msbHost.iconUtils.getFluentIcon(t))===null||u===void 0?void 0:u.content;if(!r){n.msbDsbLogger.logError("Wsb Dsb Fetch Fluent Icon Svg Url Invalid");return}const f={method:"GET",url:r,noCredentials:!0,ignoreDefaultHeaders:!0,skipToken:!0,skipParseResultJson:!0},{result:i}=await n.msbHost.httpWrapper.sendHttpAsync(f);if(!this.isSvgFormat(i)){n.msbDsbLogger.logError("Wsb Dsb Fetch Fluent Icon Svg Format Invalid");return}await this.fireDataChangedAsync("FluentIconSvgHtml",t,i)}catch(r){if(r instanceof i)return;const u=JSON.stringify(r,Object.getOwnPropertyNames(r)),t=r;n.msbDsbLogger.logHttpError("Wsb Dsb Fetch Fluent Icon Svg Failed",r)}}async recordRequestAsync(n,t){if(this.checkAndSetPendingCall(n))throw new i(`Concurrent call with key: ${n}.`);try{return await t()}finally{this.clearPendingCall(n)}}checkAndSetPendingCall(t,i){return this.hasPendingCall(t)?!0:(this.pendingCalls[t]=n.getCurrentTime()+(i?i:f),!1)}hasPendingCall(t){return this.pendingCalls[t]&&this.pendingCalls[t]>n.getCurrentTime()}clearPendingCall(n){delete this.pendingCalls[n]}getApiCallKey(n,t){return`${n}-${JSON.stringify(t)}`}async getLastMtRequestAsync(){return await this.cacheManager.getDataAsync(t.LastMTRequestKey)}isSvgFormat(n){return n.startsWith("<svg")}}t.ExternalDataManager=e})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){function u(t,i){switch(i.type){case"SET_CHAT_UPSELL_CURRENT_IDX":return Object.assign({},t,{currSuggestionIdx:t.currSuggestionIdx+n.NUM_UPSELL_SUGGESTIONS});default:return t}}function f(i,r){switch(r.type){case"SET_IS_DARK_MODE":{const{isDarkMode:n}=r;return Object.assign({},i,{isDarkMode:n})}case"SET_MY_ORG_CHART_EXPANSION":{const{isExpanded:u}=r;return n.config.msbDsbPersistOrgChartExpansion==="storage"&&n.LightweightStorage.setItem(t.MYORGCHART_EXPANSION_STORAGE_KEY,u?"1":"0"),Object.assign({},i,{isMyOrgChartExpanded:u})}case"SET_MAIN_PAGE_DATA":{const r=n.getCurrentTime();let t;return t=n.config.msbDsbPersistOrgChartExpansion==="alwaysOn"?!0:n.config.msbDsbPersistOrgChartExpansion==="alwaysOff"?!1:i.isMyOrgChartExpanded,Object.assign({},i,{errorBoundaryResetKey:r,isMyOrgChartExpanded:t})}case"SET_EDU_CLASSES_EXPANSION":{const{isExpanded:u}=r;return n.LightweightStorage.setItem(t.EDUCLASSES_EXPANSION_STORAGE_KEY,u?"1":"0"),Object.assign({},i,{isEduClassesExpanded:u})}case"SET_EDU_ASSIGNMENTS_EXPANSION":{const{isExpanded:u}=r;return n.LightweightStorage.setItem(t.EDUASSIGNMENTS_EXPANSION_STORAGE_KEY,u?"1":"0"),Object.assign({},i,{isEduAssignmentsExpanded:u})}case"SET_LAST_SELECTED_SCOPE":{const{lastSelectedScope:t}=r;return n.msbDsbHost.setLastSelectedScope(t),i}case"SET_BLEND_MODE":{const{blendMode:n}=r;return Object.assign({},i,{blendMode:n})}default:return i}}function e(t,i,u,f){switch(i.type){case"SET_MAIN_PAGE_DATA":{const{mainPageData:n}=i,t=f?f.getMainPageLayout(n):[];return{mainPageData:n,mainPageLayout:t}}case"DISMISS_ANSWER":{const{answerType:e,answerId:o,dismissAction:s}=i,{mainPageData:h}=t;return(n.msbDsbHost.dismissAnswerAsync(o,e,s.dismissViaRequest),!s.dismissOnView)?t:r(h,u,o,e,f)}case"HIDE_ANSWER":{const{mainPageData:n}=t,{answerType:e,answerId:o}=i;return r(n,u,o,e,f)}default:return t}}function o(n,t,i){switch(t.type){case"SET_RECOMMENDED_PEOPLE_PAGINATION_SETTING":{const{paginationSetting:i}=t;return Object.assign({},n,{recommendedPeoplePaginationSetting:i})}case"NAVIGATE_PAGE":{const{paginationId:u,targetPageIndex:r}=t;switch(u){case"RecommendedPeople":{if(!n.recommendedPeoplePaginationSetting)return n;const t=Object.assign({},n.recommendedPeoplePaginationSetting,{currentPageIndex:r}),u=Object.assign({},n,{recommendedPeoplePaginationSetting:t});return i.updateRecommendedPeoplePageIndexAsync(r),u}default:return n}}default:return n}}function s(n,t,i){switch(t.type){case"FETCH_IMAGE_OF_THE_DAY":return(sb_st(()=>{i.fetchImageOfTheDayPhotoAsync()},1),n.imageOfTheDay===undefined)?Object.assign({},n,{imageOfTheDay:null}):n;case"SET_IMAGE_OF_THE_DAY":{const{imageOfTheDay:i}=t;return Object.assign({},n,{imageOfTheDay:i})}default:return n}}function h(n,t,i){switch(t.type){case"FETCH_PERSON_PHOTO":{const{photoKey:r}=t;return(sb_st(()=>{i.fetchPersonPhotoAsync(r)},1),n[r]===undefined)?Object.assign({},n,{[r]:null}):n}case"SET_PERSON_PHOTO":{const{photoKey:u,photo:f}=t,i=Object.assign({},n,{[u]:f}),r=Object.keys(i);if(r.length>100){const n=r[0];delete i[n]}return i}default:return n}}function c(n,t,i){switch(t.type){case"FETCH_M365APP_STATE":return(sb_st(()=>{i.fetchM365AppListStateAsync()},1),n.appStateList===undefined)?Object.assign({},n,{appStateList:undefined}):n;case"SET_M365APP_STATE":{const{appStateList:i}=t;return Object.assign({},n,{appStateList:i})}default:return n}}function l(n,t,i){switch(t.type){case"SET_MAIN_PAGE_DATA":return{};case"FETCH_GROUP_PHOTO":{const{photoKey:r}=t;return(sb_st(()=>{i.fetchGroupPhotoAsync(r)},1),n[r]===undefined)?Object.assign({},n,{[r]:null}):n}case"SET_GROUP_PHOTO":{const{photoKey:i,photo:r}=t;return Object.assign({},n,{[i]:r})}default:return n}}function a(n,t,i){switch(t.type){case"SET_MAIN_PAGE_DATA":return{};case"FETCH_FEED_ITEM_PREVIEW":{const{feedItem:r,size:f}=t,{itemId:u}=r;return(sb_st(()=>{i.fetchFeedItemPreviewAsync(r,f)},1),n[u]===undefined)?Object.assign({},n,{[u]:null}):n}case"SET_FEED_ITEM_PREVIEW":{const{feedItemId:i,itemPreview:r}=t;return Object.assign({},n,{[i]:r})}default:return n}}function v(n,t,i){switch(t.type){case"SET_MAIN_PAGE_DATA":return{};case"FETCH_FILE_ICON":{const{extension:r}=t;return(sb_st(()=>{i.fetchFileIconAsync(r)},1),n[r]===undefined)?Object.assign({},n,{[r]:null}):n}case"SET_FILE_ICON":{const{extension:i,fileIcon:r}=t;return Object.assign({},n,{[i]:r})}default:return n}}function y(n,t,i){switch(t.type){case"FETCH_FLUENT_ICON_SVG_HTML":{const{icon:r}=t;return(sb_st(()=>{i.fetchFluentIconSvgHtmlAsync(r)},1),n[r]===undefined)?Object.assign({},n,{[r]:null}):n}case"SET_FLUENT_ICON_SVG_HTML":{const{icon:i,svgHtml:r}=t;return Object.assign({},n,{[i]:r})}default:return n}}function p(t){switch(t.type){case"SET_WSB_REQUERY":{const{query:i,scope:r}=t;n.msbDsbHost.setWsbQuery(i,r);return}case"LAUNCH_URI":{const{uri:i}=t;n.Host.launchUrlWithHttpProtocolAsync(i,{medium:"MSBLink"});return}case"LAUNCH_PROACTIVE_WORK_SEARCH":{const{args:i}=t;n.msbHost.proactiveSearchManager.launchProactiveWorkSearchAsync(i);return}case"FORCE_DSB_REFRESH_ACTION":n.msbDsbHost.refresh(3,3);return}}function w(n,t){switch(n.type){case"SET_MY_ORG_CHART_EXPANSION":sb_st(()=>{t.sendTelemetryForUIChange()},1);break;case"DISMISS_ANSWER":{const{dismissAction:i}=n;i.dismissViaRequest&&sb_st(()=>{t.sendTelemetryForUIChange()},1);break}}}function b(n,t,i){return(r,b)=>{const{uiOptions:k,mainPageState:d,imageOfTheDay:g,personPhotos:nt,feedItemPreviews:tt,fileIcons:it,paginationSettings:rt,groupPhotos:ut,fluentIconSvgHtmls:ft,chatUpsellState:et,m365AppsState:ot}=r;return p(b),w(b,n),{uiOptions:f(k,b),mainPageState:e(d,b,n,i),imageOfTheDay:s(g,b,n),personPhotos:h(nt,b,n),groupPhotos:l(ut,b,n),feedItemPreviews:a(tt,b,n),fileIcons:v(it,b,n),fluentIconSvgHtmls:y(ft,b,n),paginationSettings:o(rt,b,t),chatUpsellState:u(et,b),m365AppsState:c(ot,b,n)}}}function r(t,r,u,f,e){if(!t)return{mainPageData:null,mainPageLayout:[]};let o={};if(i.isViewModelAnswerTypeDynamic(f)){const{gleamDataPair:r}=t,i=Object.assign({},r,{scenarioGleamData:null}),u=n.MsbDsb.DataContext.getDynamicAnswerState();o={dynamicAnswer:undefined,gleamDataPair:i,dynamicAnswerState:u,scenario:"Baseline"};n.msbDsbHost.gleamManager.setGleamContentToDisplayAsync(i,!1,"dismissDynamicAnswer","Baseline","Reducer.hideAnswer",!1)}else if(f==="Feed"&&u){const{feedAnswers:n}=t,i=n.filter(n=>n.answerId!==u);o={feedAnswers:i}}else switch(f){case"RecommendedPeople":o={recommendedPeopleAnswer:undefined};break;case"OrgChart":o={myOrgChart:undefined};break;case"PopularSearch":o={popularSearchesAnswer:undefined};break;case"Acronyms":o={acronymsAnswer:undefined};break;case"EduCard":o={eduCardAnswer:undefined};break;case"EduAssignments":o={eduAssignmentAnswer:undefined};break;case"EduClasses":o={eduClassAnswer:undefined}}const s=Object.assign({},t,o);r.updateExistingMainPageProperties(o);const h=e?e.getMainPageLayout(s):[];return{mainPageData:s,mainPageLayout:h}}i.createRootReducer=b})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){const i=20;class r{constructor(n){this.externalDataManager=n;this.resetRenderingFlags()}setMainPageDataRefreshed(){this.resetRenderingFlags();this.isMainPageRefreshed=!0}startPollingMainPageLoaded(){(this.setLastUpdateTime(),this.shouldStartPolling())&&(this.pollingPageLoadTimerStarted=!0,this.pollingPageLoaded(i,this.lastUpdateTime))}setLastUpdateTime(){this.lastUpdateTime=n.getCurrentTime()}shouldStartPolling(){return this.isMainPageRefreshed&&!this.pollingPageLoadTimerStarted}pollingPageLoaded(t,i){if(this.clearPageLoadTimer(),t===0){this.resetRenderingFlags();this.externalDataManager.onRefreshFinished();return}this.pageLoadTimer=n.safeSetTimeout(()=>{this.clearPageLoadTimer(),i==this.lastUpdateTime&&this.externalDataManager.getPendingRequestCount()===0?(this.resetRenderingFlags(),this.externalDataManager.onRefreshFinished()):this.pollingPageLoaded(t-1,this.lastUpdateTime)},100,"MsbDsbRenderingManager")}clearPageLoadTimer(){this.pageLoadTimer&&(sb_ct(this.pageLoadTimer),this.pageLoadTimer=null)}resetRenderingFlags(){this.isMainPageRefreshed=!1;this.pollingPageLoadTimerStarted=!1}}t.RenderingMonitor=r})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){function i(i,r,u,f){n.msbDsbHost.instrumentationManager.resetInstrumentProps();const h=n.msbDsbHost.instrumentationManager.createInstrumentedItem("PeopleSearchBox");if(!(i===null||i===void 0?void 0:i.scenario))return s(h,f);const{scenario:{scenarioType:d,answers:c}}=i;let l=t.convertScenarioToViewDataModel(d),a,v,o=[],e,y,p,w,b,k;if(c)for(const n of c){if(!(n===null||n===void 0?void 0:n.answerType)){t.logAnswerConversionError(new Error("Missing answer type"),undefined,u,n===null||n===void 0?void 0:n.traceId,!!f);continue}const{answerType:i,answerId:s}=n;if(!s||!t.isAnswerDismissed(s,r))try{switch(i){case"RecommendedPeople":a=t.convertRecommendedPeopleAnswerToViewDataModel(n);break;case"OrgChart":v=t.convertOrgChartAnswerToViewDataModel(n);break;case"Feed":o=t.convertFeedAnswersToViewDataModel(n,r,u,f);o=t.resetAnswersPlacement(o);break;case"MeetingPrep":e=t.convertMeetingPrepAnswerToViewDataModel(n);break;case"IndustryNews":e=t.convertIndustryNewsAnswerToViewDataModel(n);break;case"PeopleHighlights":e=t.convertPeopleHighlightsAnswerToViewDataModel(n,r);break;case"PopularSearch":y=t.convertPopularSearchesAnswerToViewModel(n);break;case"SearchBoxGleam":p=n;break;case"EduAssignments":w=t.convertEduAssignmentAnswerToViewDataModel(n);break;case"EduClasses":b=t.convertEduClassAnswerToViewDataModel(n);break;case"Acronyms":k=t.convertAcronymsAnswerToViewDataModel(n)}}catch(h){t.logAnswerConversionError(h,i,u,n.traceId,!!f)}}const g=t.createLearningCardViewDataModel(),nt=t.createEduCardViewDataModel(!!n.msbHost.isEduTenant());e||(l="Baseline");const tt=t.convertSearchBoxGleamAnswer(p,f),it=t.getDynamicAnswerStateInConversion(e);return{scenario:l,recommendedPeopleAnswer:a,myOrgChart:v,feedAnswers:o,learningAnswer:g,popularSearchesAnswer:y,dynamicAnswer:e,dynamicAnswerState:it,gleamDataPair:tt,searchBoxInstrumentedItem:h,eduAssignmentAnswer:w,eduClassAnswer:b,eduCardAnswer:nt,acronymsAnswer:k}}function r(n,i){var r;if(!((r=n===null||n===void 0?void 0:n.scenario)===null||r===void 0?void 0:r.answers))return{};const f=n.scenario.answers;let u=[];for(const n of f){const r=n===null||n===void 0?void 0:n.answerType;if(!r){t.logAnswerConversionError(new Error("Missing answer type"),undefined,i,n===null||n===void 0?void 0:n.traceId);continue}try{switch(r){case"RecentQueries":u=t.convertRecentQueriesAnswerToViewModel(n)}}catch(f){t.logAnswerConversionError(f,r,i,n.traceId,!1)}}return{recentQueries:u}}function u(t){if(!t)return"";const u=t.split("&");let i="";for(const n of u){const[t,r]=n.split("=");if(t==="form"){i=r;break}}const r=n.mapOSFormCode("DSBI10");return i===""?t+`&form=${r}`:t.replace(`form=${i}`,`form=${r}`)}function f(t){var i;if(!((i=t===null||t===void 0?void 0:t.scenarios)===null||i===void 0?void 0:i.length))return null;const r=n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.instrumentationManager.createInstrumentedItem("ImageOfTheDayCard"),f=t.scenarios.map(n=>{const t={};return t.clickThroughUrl=u(n.ClickThroughUrl),t.title=n.Title,t.caption=n.Caption,t.thumbnail=n.Thumbnail,t.copyright=n.Copyright,t}),e=t.imageHostName;return{imageOfTheDayScenarios:f,imageHostName:e,instrumentedItem:r}}function e(n){var t;if(!n)return null;const i=(t=n.imageInBase64)!==null&&t!==void 0?t:n.ImageInBase64;return i?{imageInBase64:i,noImage:!1}:{noImage:!0}}function o(n){if(!n)return null;const{base64EncodedImage:t}=n;return t?{imageInBase64:`data:image/png;base64,${t}`,noImage:!1}:{noImage:!0}}function s(i,r=false){const u=t.createLearningCardViewDataModel(),f=t.convertSearchBoxGleamAnswer(undefined,r),e=t.createEduCardViewDataModel(!!n.msbHost.isEduTenant());return{scenario:"Baseline",learningAnswer:u,eduCardAnswer:e,gleamDataPair:f,searchBoxInstrumentedItem:i,feedAnswers:[]}}t.convertMainPageResponseToViewDataModel=i;t.convertMainPageToQuerySuggestionsData=r;t.convertImageOfTheDayToViewDataModel=f;t.convertPhotoToViewDataModel=e;t.convertFeedItemPreviewToViewDataModel=o})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){function l(t,i,r=false){if(!t||i||t.startsWith("https://")||t.startsWith("<svg"))return t;try{return atob(t)}catch(u){n.msbDsbLogger.logError(r?"Wsb Dsb Gleam Icon From Cache Not Supported":"Wsb Dsb Gleam Icon Not Supported")}return undefined}function ri(n){return n}function ui(t){var i,r;if(t.status!=="Succeeded"||n.msbHost.isEduTenant())return undefined;const{traceId:s,logicalId:h,status:c,answerType:l,hash:a}=t,v=e(l),f=(r=(i=t===null||t===void 0?void 0:t.groups)===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.suggestions;u(f,"recommendedPeopleSuggestions");const o=st(f);u(o,"converted recommendedPeople");const y=n.msbDsbHost.instrumentationManager.createInstrumentedItem("RecommendedPeople");return{traceId:s,logicalId:h,status:c,answerType:v,recommendedPeople:o,instrumentedItem:y,hash:a}}function fi(t){if(!n.config.msbDsbIndustryNews||t.status!=="Succeeded")return undefined;const{answerId:r,status:f,answerType:o,newsArticles:i}=t;u(i,"newsArticles");const s=e(o),h=p(i),c=n.msbDsbHost.instrumentationManager.createInstrumentedItem("IndustryNews");return{answerId:r,status:f,answerType:s,newsItems:h,instrumentedItem:c}}function p(t){const i=`w=64&h=64&m=6`;return t.slice(0,3).map(t=>{var r;const u=((r=t.imageInfo)===null||r===void 0?void 0:r.msnImageUrl)?n.msbHost.urlUtils.insertParameter(t.imageInfo.msnImageUrl,i):undefined;return Object.assign({},t,{imageInfo:{msnImageUrl:u}})})}function ei(t,r){if(!n.msbHost.features.isMsbDsbPeopleHighlightsAnswerEnabled()||(t===null||t===void 0?void 0:t.status)!=="Succeeded")return undefined;const{answerId:h,status:c,answerType:l,peopleHighlights:o}=t,a=e(l),v=h||"";u(o,"peopleHighlights");const y=n=>f(n.fullName)&&f(n.id)&&f(n.highlightType)&&n.highlightType!=="Unknown",p=(n,t)=>!!n.clicked||i.isAnswerDismissed(t,r),s=o.filter(y).map(n=>{const t=`${n.id}#${n.highlightType}`;return{person:{fullName:n.fullName,uid:n.id},highlightType:n.highlightType,showBadge:!p(n,t),answerId:t}});u(s,"peopleHighlights");const w=n.msbDsbHost.instrumentationManager.createInstrumentedItem("PeopleHighlights");return{answerType:a,status:c,answerId:v,peopleHighlights:s,instrumentedItem:w}}function oi(t){if((t===null||t===void 0?void 0:t.status)!=="Succeeded")return undefined;const o=e(t.answerType),u=t.acronymSuggestions,i=t.acronymFeaturedSuggestion;r(i,"acronymFeaturedSuggestion");r(u,"acronymSuggestions");const s=u.filter(n=>f(n.abbreviatedName)).map(n=>({abbreviatedName:n.abbreviatedName}));r(i.abbreviatedName,"acronymFeaturedSuggestion.abbreviatedName");r(i.displayName,"acronymFeaturedSuggestion.displayName");r(i.numberOfResults,"acronymFeaturedSuggestion.numberOfResults");const h={abbreviatedName:i.abbreviatedName,displayName:i.displayName,numberOfResults:i.numberOfResults},c=n.msbDsbHost.instrumentationManager.createInstrumentedItem("Acronyms"),l=n.msbDsbHost.instrumentationManager.createInstrumentedItem("AcronymSuggestions");return{answerType:o,acronyms:s,acronymFeaturedSuggestion:h,instrumentedItem:c,subItemInstrumentedItem:l}}function si(t){var s,h,l;if(t.status!=="Succeeded"||n.msbHost.isEduTenant())return undefined;const{answerType:p,reportingChain:a,directReports:w,peers:b}=t,k=e(p);u(a,"reportingChain");const v=y(a[0]);r(v,"hero");const i=(s=c(a.slice(1)))!==null&&s!==void 0?s:[],f=(h=c(w))!==null&&h!==void 0?h:[],o=(l=c(b))!==null&&l!==void 0?l:[];if((i===null||i===void 0?void 0:i.length)===0&&(f===null||f===void 0?void 0:f.length)===0)if((o===null||o===void 0?void 0:o.length)==0)throw new Error("No org chart available");else throw new Error("Org Chart hidden as no managers or direct reports");const d=n.msbDsbHost.instrumentationManager.createInstrumentedItem("ExpandedOrgChart");return{answerType:k,hero:v,managers:i,directReports:f,peers:o,instrumentedItem:d}}function hi(n){switch(n){case"Hero":return"Hero";default:return"Default"}}function ci(t){let i;switch(t){case"pptx":case"ppt":i="PptHeroCard";break;case"docx":case"doc":i="DocHeroCard";break;case"xlsx":case"xls":i="ExcelHeroCard";break;default:i="OtherHeroCard"}return n.msbDsbHost.instrumentationManager.createInstrumentedItem(i)}function li(t,r,o,s=false){if(t.status!=="Succeeded"||(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbNoFeed))return[];const{answerType:c,items:h,status:l}=t,a=e(c);u(h,"sFeedItems");return h.map(u=>{const f=rt(u,o,t.traceId,s);if(!f)return null;const e=f.itemId+"#"+f.feedbackId;if(i.isAnswerDismissed(e,r))return null;const h=n.config.msbDsbFileHero?hi(u.itemPlacement):"Default";return{answerId:e,status:l,answerType:a,item:f,answerPlacement:h}}).filter(f)}function ai(i){const r=i.filter(n=>n.answerPlacement==="Hero").length;return r>0&&r<t.MIN_NUMBER_OF_HERO_ITEMS?(n.msbDsbLogger.logError("Wsb Dsb not enough hero items"),i.forEach(t=>{t.answerPlacement="Default",t.instrumentedItem=n.msbDsbHost.instrumentationManager.createInstrumentedItem(t.item.category)})):i.forEach(t=>{if(t.answerPlacement=="Default")t.instrumentedItem=n.msbDsbHost.instrumentationManager.createInstrumentedItem(t.item.category);else{const n=t.item;t.instrumentedItem=ci(n.extension)}}),i}function vi(t){if(t.status!=="Succeeded"||n.msbHost.isEduTenant())return undefined;const{answerId:i,logicalId:u,status:f,answerType:o,entitySets:s,traceId:h}=t;r(i,"answerId");const c=e(o);return w(i,c,f,h,u,s)}function w(t,i,f,e,o,s){var h,c,l;const w=(c=(h=s===null||s===void 0?void 0:s[0])===null||h===void 0?void 0:h.resultSets)===null||c===void 0?void 0:c[0];r(w,"entityResults");const{recommendationsContext:v,results:y,totalNumberOfResults:ot}=w,k=(l=v===null||v===void 0?void 0:v.meetingContext)===null||l===void 0?void 0:l.source;r(k,"entityResults");u(y,"entityResults.results");const{id:d,subject:p,start:tt,organizer:st,attendees:it,totalNumberOfAttendees:ht,webLink:rt}=k;u(it,"sAttendees");r(tt,"sStart");r(rt,"webLink");const ct=p!==null&&p!==void 0?p:n.msbDsbHost.getLocString("NoSubjectEmailTitle"),ut=new Date(tt),ft=a(st);r(ft,"organizer");const et=b(it,ft);u(et,"attendees");const lt=g(y.filter(n=>n.type=="Document")),at=nt(y.filter(n=>n.type=="Message")),vt=n.msbDsbHost.instrumentationManager.createInstrumentedItem("MeetingPrep"),yt=n.msbDsbHost.instrumentationManager.createInstrumentedItem("DismissMeetingPrep"),pt=n.msbDsbHost.instrumentationManager.createInstrumentedItem("PositiveMeetingPrep"),wt=n.msbDsbHost.instrumentationManager.createInstrumentedItem("NegativeMeetingPrep");return d||n.msbDsbLogger.logError("Wsb Dsb Missing telemetry field",`Missing meetingId for Meeting Prep`),{answerId:t,traceId:e,logicalId:o,answerType:i,status:f,expiryTime:ut,meetingId:d,subject:ct,start:ut,topAttendees:et,totalNumberOfAttendees:ht,totalNumberOfResults:ot,webLink:rt,fileResults:lt,conversationResults:at,instrumentedItem:vt,subItemInstrumentedItem:yt,positiveFeedbackInstrumentedItem:pt,negativeFeedbackInstrumentedItem:wt}}function b(n,t){return n.map(n=>k(n,t)).filter(f)}function k(n,t){if(!n.emailAddress)return undefined;const{name:i,address:r}=n.emailAddress;if(!i||!r)return undefined;const u=o(i),f=t.email==r?"Organizer":d(n.status);return{fullName:i,initials:u,email:r,status:f}}function d(n){switch(n===null||n===void 0?void 0:n.response){case"Organizer":case"None":case"Accepted":case"Declined":return n.response;case"TentativelyAccepted":return"Tentative";case"NotResponded":return"None";default:return"None"}}function g(n){return n.map(n=>tt(n)).filter(f)}function nt(n){return n.map(n=>it(n)).filter(f)}function tt(t){var r,u,f;if(!(t===null||t===void 0?void 0:t.source))return undefined;const{source:i,referenceId:e}=t,o=(r=i.lastModifiedBy)===null||r===void 0?void 0:r.displayName,s=(f=(u=i.lastShared)===null||u===void 0?void 0:u.sharedby)===null||f===void 0?void 0:f.displayName,l=o?n.msbDsbHost.getLocString("LastModifiedByText",o):s?n.msbDsbHost.getLocString("LastSharedByText",s):n.msbDsbHost.getLocString("FileSubtitleDefault"),h=i.webUrl?i.webUrl:i.url,c=i.title;return!c||!h?undefined:(e||n.msbDsbLogger.logError("Wsb Dsb Missing telemetry field",`Missing referenceId for Meeting Prep Document`),{referenceId:e,title:c,subtitle:l,fileExtension:i.fileExtension,url:h})}function it(t){var i;if(!(t===null||t===void 0?void 0:t.source))return undefined;const{source:r,referenceId:u}=t,f=r.subject,e=a(r.from),o=(i=r.itemId)===null||i===void 0?void 0:i.id;if(!f||!e||!o)return undefined;const s=lt(o);return u||n.msbDsbLogger.logError("Wsb Dsb Missing telemetry field",`Missing referenceId for Meeting Prep Message`),{subject:f,from:e,conversationUri:s,referenceId:u}}function a(n){var t;if(!((t=n===null||n===void 0?void 0:n.emailAddress)===null||t===void 0?void 0:t.name))return undefined;const i=n.emailAddress.name;return{fullName:i,initials:o(i),email:n.emailAddress.address}}function rt(n,t,i,r=false){try{switch(n.category){case"file":return ut(n);case"video":return ft(n);case"emailMessage":return v(n,!0,r);case"teamsChatMessage":return v(n,!1,r);default:return s(n)}}catch(u){const f=u instanceof Error?u.message:"Unknown error.";return dt(new Error(`Error converting ${n.category} feed item: ${f}`),"Feed",t,i,!!r),undefined}}function s(n){var t,u;const{webUrl:c,name:f,itemId:l,feedbackId:e,category:o,subCategory:a,uri:v}=n;r(o,"sCategory");r(e,"feedbackId");r(f,"name");const s=o,y=yi((t=n.inclusionReasons)===null||t===void 0?void 0:t[0]),p=i.getTidbitHeaderIcon((u=n.inclusionReasons)===null||u===void 0?void 0:u[0]),h=s==="teamsChatMessage"?v:c;return r(h,"url"),{itemId:l,feedbackId:e,title:f,uri:h,tidbitItem:y,icon:p,category:s,subCategory:a}}function ut(n){var t;const i=et(n.containerInfo),r=yt(n.previewInfo);return Object.assign({extension:(t=n.file)===null||t===void 0?void 0:t.extension,location:i,preview:r},s(n))}function ft(t){var f,e,o,h,c;const i=(f=t.video)===null||f===void 0?void 0:f.mediaDuration,r=parseInt((o=(e=i===null||i===void 0?void 0:i.match(/\d+(?=H)/))===null||e===void 0?void 0:e[0])!==null&&o!==void 0?o:""),u=r?r>1?`${r}${n.msbDsbHost.getLocString("HoursShortened")}`:`${r}${n.msbDsbHost.getLocString("HourShortened")}`:undefined,a=parseInt((c=(h=i===null||i===void 0?void 0:i.match(/\d+(?=M)/))===null||h===void 0?void 0:h[0])!==null&&c!==void 0?c:""),l=a?`${a}${n.msbDsbHost.getLocString("MinuteShortened")}`:undefined,v=u&&l?`${u} ${l}`:u?u:l,y=n.msbHost.iconUtils.getFluentIcon("previewIcon"),p=yt(t.previewInfo);return Object.assign({previewIcon:y,preview:p,duration:v},s(t))}function v(t,u,f=false){var o,h,c,l,a,v,y,p,w,b,k,d;let e;if(u){const n=(h=(o=t.message)===null||o===void 0?void 0:o.body)===null||h===void 0?void 0:h.content;r(n,"emailBodyContent");e=i.parseEmailMessage(n,f,(l=(c=t.message)===null||c===void 0?void 0:c.body)===null||l===void 0?void 0:l.contentType)}else{const u=(a=t.chatMessageInfo)===null||a===void 0?void 0:a.mentions;r(u,"chatMessageMentions");const o=(y=(v=t.chatMessageInfo)===null||v===void 0?void 0:v.body)===null||y===void 0?void 0:y.content;r(o,"chatMessageContent");const s=!n.msbHost.isEduTenant()&&t.category=="teamsChatMessage";e=i.parseChatMessage({type:"Feed",chatText:o,mentionList:u,isCached:f,contentType:(w=(p=t.chatMessageInfo)===null||p===void 0?void 0:p.body)===null||w===void 0?void 0:w.contentType},s)}r(e,"processedMessageBody");const nt=u?(b=t.message)===null||b===void 0?void 0:b.from:(d=(k=t.chatMessageInfo)===null||k===void 0?void 0:k.from)===null||d===void 0?void 0:d.user,g=ur(nt);r(g,"fromActor");const tt={firstActor:g,tidbit:n.msbDsbHost.getLocString("MentionedYouTidbit"),inclusionType:"Other"};return Object.assign(Object.assign({processedMessageBody:e,isEmailMention:u},s(t)),{tidbitItem:tt,icon:"atIcon"})}function et(t){if(!t)return undefined;const{kind:r,displayName:i}=t;if(i)switch(r){case"OneDrive":case"OneDriveBusiness":return n.msbDsbHost.getLocString("OneDriveItemSourceWithName",i);case"SharePoint":return n.msbDsbHost.getLocString("SharePointItemSourceWithName",i);case"OneDrive & SharePoint":default:return n.msbDsbHost.getLocString("OneDriveAndSharePointItemSourceWithName",i)}else switch(r){case"OneDrive":case"OneDriveBusiness":return n.msbDsbHost.getLocString("OneDriveItemSource");case"SharePoint":return n.msbDsbHost.getLocString("SharePointItemSource");case"OneDrive & SharePoint":default:return n.msbDsbHost.getLocString("OneDriveAndSharePointItemSource")}}function bi(){if(n.msbHost.isEduTenant())return undefined;const t=["LearningCardDocuments","LearningCardProfile","LearningCardManager"].map(t=>{const i=n.msbDsbHost.getLocString(t);return{title:i}}),i=n.msbDsbHost.instrumentationManager.createInstrumentedItem("LearningFeedFallback");return{answerType:"Learning",suggestions:t,instrumentedItem:i}}function ki(t){if(!t)return undefined;const f=n.msbHost.hasEduAssignments(),i=n.msbHost.getAadUserInfo(),e=(i===null||i===void 0?void 0:i.userAadId)||"",r=(i===null||i===void 0?void 0:i.email)||"",s=o(r),h={uid:e,email:r,fullName:r,initials:s},u=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isEduMessagesCardEnabled(),c=f&&!n.config.msbDsbEnableEduScenario?["EduCardAssignments","EduCardClasses",u?"EduCardMessages":"EduCardCalendar"]:["MyProfileSearchSuggestion","EduCardFiles",u?"EduCardMessages":"EduCardCalendar"],l=c.map(t=>{const i=n.msbDsbHost.getLocString(t),r=ot(t),u=n.msbDsbHost.instrumentationManager.createInstrumentedItem(n.Host.getEnUsLocString(t));return{title:i,key:t,color:r,instrumentedItem:u}}),a=n.msbDsbHost.instrumentationManager.createInstrumentedItem("EduCard");return{answerType:"EduCard",suggestions:l,user:h,instrumentedItem:a}}function di(t){if(t.status!=="Succeeded"||n.msbHost.isEduTenant())return undefined;const{status:f,answerType:o,bookmarks:i}=t,s=e(o),r=i===null||i===void 0?void 0:i.map(n=>({title:n}));u(r,"searchQueries");const h=n.msbDsbHost.instrumentationManager.createInstrumentedItem("PopularSearchesFeedFallback");return{answerType:s,status:f,searchQueries:r,instrumentedItem:h}}function ot(n){switch(n){case"MyProfileSearchSuggestion":return"blue";case"EduCardFiles":return"orange";case"EduCardCalendar":return"lightyellow";case"EduCardAssignments":return"purple";case"EduCardClasses":return"green";case"EduCardMessages":return"lightblue";default:return"blue"}}function e(n){return n}function st(n){return n.map(n=>ht(n)).filter(f)}function ht(t){const{id:e,referenceId:s,displayName:u,emailAddresses:f,rankingExplanation:h}=t;if(!e||!u)return undefined;const i=n.getFirstAndLastName(u),l=ct(e),a=o(u),v=f===null||f===void 0?void 0:f[0];s||n.msbDsbLogger.logError("Wsb Dsb Missing telemetry field",`Missing referenceId for Recommended People`);const c={uid:l,referenceId:s,fullName:u,firstName:i===null||i===void 0?void 0:i.firstName,lastName:i===null||i===void 0?void 0:i.lastName,initials:a,email:v};return n.msbDsbHost.isPeopleExplanationEnabled()&&(r(h,"recommendedPerson.rankingExplanation"),c.rankingExplanation=h),c}function ct(n){const t=n.indexOf("@");return t>-1?n.substring(0,t):n}function c(n){return n?n.filter(n=>n).map(n=>y(n)).filter(f):undefined}function y(n){const{id:r,fullName:t,jobTitle:u,userPrincipalName:i}=n;if(!t)return undefined;const f=o(t);return{uid:r,fullName:t,initials:f,jobTitle:u,userPrincipalName:i,email:i}}function o(n){return n.split("(")[0].split(" ").filter(n=>n.match(/^([a-zA-Z])[a-zA-Z]*/)).map(n=>n[0].toUpperCase()).slice(0,2).join("")}function lt(n){let t=encodeURIComponent(n);return t=t.replace(/_/g,"%2B"),t=t.replace(/-/g,"%2F"),`${gt}deeplink?ItemID=${t}`}function gi(n,t){const i=encodeURIComponent(n);return`${ni}${i}/${t}?context={"contextType":"chat"}`}function nr(n){return n}function tr(t,i=false){const r=t===null||t===void 0?void 0:t.baselineGleam,u=at(r,i),f=n.msbDsbHost.gleamManager.getScenarioDescription("Baseline");return{baselineGleamData:{gleamContent:u,description:f,longExpiration:!0,scenario:"Baseline"}}}function at(t,i=false){const r=l(t===null||t===void 0?void 0:t.lightGleam,t===null||t===void 0?void 0:t.isPng),u=(t===null||t===void 0?void 0:t.darkGleam)?l(t===null||t===void 0?void 0:t.darkGleam,t===null||t===void 0?void 0:t.isPng,i):r;return r&&u&&n.msbHost.features.isServerGleamEnabled()?((t===null||t===void 0?void 0:t.gleamKey)||n.msbDsbLogger.logError(i?"Wsb Dsb Gleam key from cache missing":"Wsb Dsb Gleam key missing"),{lightGleam:r,darkGleam:u,isBigGleam:t===null||t===void 0?void 0:t.isBigGleam,gleamKey:t===null||t===void 0?void 0:t.gleamKey}):undefined}function ir(n){const t=i.getDynamicAnswerState(n);return Object.assign({},t)}function vt(n,t=false){switch(n){case"RecommendedPeople":return t?"Wsb Dsb Recommended People answer conversion from cache failed":"Wsb Dsb Recommended People answer conversion failed";case"OrgChart":return t?"Wsb Dsb Org Chart answer conversion from cache failed":"Wsb Dsb Org Chart answer conversion failed";case"Feed":return t?"Wsb Dsb Feed answer conversion from cache failed":"Wsb Dsb Feed answer conversion failed";case"IndustryNews":return t?"Wsb Dsb Industry News answer conversion from cache failed":"Wsb Dsb Industry News answer conversion failed";case"MeetingPrep":return t?"Wsb Dsb Meeting Prep answer conversion from cache failed":"Wsb Dsb Meeting Prep answer conversion failed";case"PopularSearch":return t?"Wsb Dsb Popular Tenant Searches answer conversion from cache failed":"Wsb Dsb Popular Tenant Searches answer conversion failed";case"SearchBoxGleam":return t?"Wsb Dsb Search Box Gleam answer conversion from cache failed":"Wsb Dsb Search Box Gleam answer conversion failed";case"EduAssignments":return t?"Wsb Dsb Edu Assignments answer conversion from cache failed":"Wsb Dsb Edu Assignments answer conversion failed";case"EduClasses":return t?"Wsb Dsb Edu Classes answer conversion from cache failed":"Wsb Dsb Edu Classes answer conversion failed";case"Acronyms":return t?"Wsb Dsb Acronyms answer conversion from cache failed":"Wsb Dsb Acronyms answer conversion failed";case"RecentQueries":return t?"Wsb Dsb Recent Queries answer conversion from cache failed":"Wsb Dsb Recent Queries answer conversion failed";default:return t?"Wsb Dsb answer conversion from cache failed":"Wsb Dsb answer conversion failed"}}function yt(n){if(!n)return undefined;const{image:t,imageProxy:i}=n;return!t||!i?undefined:{previewUrl:t,previewProxyUrl:i}}function rr(n){var i,r,u;const t=(r=(i=n.actors)===null||i===void 0?void 0:i[0])!==null&&r!==void 0?r:n.sharedBy;if(!((u=t===null||t===void 0?void 0:t.user)===null||u===void 0?void 0:u.displayName))return{isMe:!0};const{displayName:e,email:s,isMe:f,id:h}=t.user,c=o(e);return{initials:c,fullName:e,email:s,uid:h,isMe:f!==null&&f!==void 0?f:!1}}function ur(n){if(!n)return undefined;const{displayName:t,email:i,id:r}=n;if(!t)return undefined;const u=o(t);return{initials:u,uid:r,email:i,fullName:t,isMe:!1}}function fr(n){return(n===null||n===void 0?void 0:n.status)!="Succeeded"?[]:(u(n.recentQuerySuggestions,"recentQuerySuggestions"),n.recentQuerySuggestions.map(n=>er(n)))}function er(n){r(n.globalId,"globalId");r(n.query,"query");r(n.workloadName,"workloadName");r(n.lastUsedTimeStamp,"lastUsedTimeStamp");const t=or(n.workloadName);if(!t)throw new h(`Unsupported workload name: ${n.workloadName}`);return{id:n.globalId,query:n.query,canvas:t,searchTime:n.lastUsedTimeStamp}}function or(n){switch(n){case"Outlook":case"Teams":return n;case"Bing":return"BingWorkSearch";case"M365":return"Sharepoint";default:return undefined}}function sr(t){var r,f;if(t.status!=="Succeeded")return undefined;const{traceId:s,logicalId:h,status:c,answerType:l}=t,i=(r=t===null||t===void 0?void 0:t.assignmentPage)===null||r===void 0?void 0:r.educationAssignments;if(!i||i.length==0)return undefined;const o=(f=pt(i))===null||f===void 0?void 0:f.slice(0,2);if(!o||o.length==0)return undefined;u(i,"eduAssignmentsItems");const a=e(l),v=n.msbDsbHost.instrumentationManager.createInstrumentedItem("EduAssignment"),y=n.msbDsbHost.instrumentationManager.createInstrumentedItem("EduAssignmentSeeMoreLink"),p=i.length;return{traceId:s,logicalId:h,status:c,answerType:a,entities:o,instrumentedItem:v,subItemInstrumentedItem:y,totalCount:p}}function pt(n){return n.filter(n=>n).map(n=>wt(n)).filter(f)}function wt(t){var u;const{id:f,name:h,isTeacher:l,dueDateUnixTimestamp:c,educationClass:i,isOverDue:a,webUrl:r}=t;if(!f||!h)return undefined;const e=c?new Date(c*1e3):undefined,v=e===null||e===void 0?void 0:e.toLocaleDateString((u=n.getCurrentLanguage())===null||u===void 0?void 0:u.substring(0,2),{month:"short",day:"numeric"}),s=i===null||i===void 0?void 0:i.name,y=o(s),p=i===null||i===void 0?void 0:i.id,w=n.config.msbDsbEnableAssignmentWebUrl&&(r===null||r===void 0?void 0:r.length)>0?r:hr(i===null||i===void 0?void 0:i.id,f),b=n.msbDsbHost.instrumentationManager.createInstrumentedItem("EduAssignmentItem");return{dueDate:v,className:s,id:f,isTeacher:l,name:h,link:w,instrumentedItem:b,classId:p,description:s,isOverDue:a,classInitials:y}}function hr(n,t){return ti+encodeURIComponent(JSON.stringify({subEntityId:JSON.stringify({action:"navigate",view:"assignment-viewer",appId:"MSB-WSB-DSB",config:{classes:[{id:`${n}`,assignmentIds:[`${t}`]},]}})}))}function cr(t){var r;if(t.status!=="Succeeded")return undefined;const{traceId:o,logicalId:s,status:h,answerType:c}=t,i=t===null||t===void 0?void 0:t.classes;if(!i||i.length==0)return undefined;const f=(r=bt(i))===null||r===void 0?void 0:r.slice(0,2);if(!f||f.length==0)return undefined;u(i,"eduClassItems");const l=e(c),a=n.msbDsbHost.instrumentationManager.createInstrumentedItem("EduClass"),v=n.msbDsbHost.instrumentationManager.createInstrumentedItem("EduClassSeeMoreLink"),y=i.length;return{traceId:o,logicalId:s,status:h,answerType:l,entities:f,instrumentedItem:a,subItemInstrumentedItem:v,totalCount:y}}function bt(n){return n.map(n=>kt(n)).filter(f)}function kt(t){const{id:u,name:r,url:i}=t;if(!u||!r)return undefined;const f=o(r),e=(i===null||i===void 0?void 0:i.length)>0?i:ii,s=n.msbDsbHost.instrumentationManager.createInstrumentedItem("EduClassItem");return{classId:u,name:r,link:e,instrumentedItem:s,classInitials:f}}function f(n){return n!==undefined&&n!==null&&n!==""}function r(n,t){if(!f(n))throw new h(`Missing required field, ${t}`);}function u(n,t){if(r(n,t),n.length==0)throw new h(`Unexpected empty list, ${t}`);}function dt(t,i,r,u,f){const o=t instanceof Error?t.message:"Unknown error",e=JSON.stringify(t,Object.getOwnPropertyNames(t));n.msbDsbLogger.logResponseError(vt(i,f),o,e,r,u)}const gt="https://outlook.office365.com/mail/",ni="https://teams.microsoft.com/l/message/",ti="https://teams.microsoft.com/l/entity/66aeee93-507d-479a-a3ef-8f494af43945/classroom?context=",ii="https://teams.microsoft.com/_#/school/teams-grid/General?ctx=teamsGrid";class h extends Error{constructor(n,t){super(n);this.innerError=t}}i.ResponseFieldError=h;i.convertIconContent=l;i.convertScenarioToViewDataModel=ri;i.convertRecommendedPeopleAnswerToViewDataModel=ui;i.convertIndustryNewsAnswerToViewDataModel=fi;i.convertNewsArticlesToViewDataModel=p;i.convertPeopleHighlightsAnswerToViewDataModel=ei;i.convertAcronymsAnswerToViewDataModel=oi;i.convertOrgChartAnswerToViewDataModel=si;i.convertFeedAnswersToViewDataModel=li;i.resetAnswersPlacement=ai;i.convertMeetingPrepAnswerToViewDataModel=vi;i.convertMeetingPrepEntitySetsToViewDataModel=w;i.convertMeetingPrepAttendeesToViewDataModel=b;i.convertMeetingPrepAttendeeToViewDataModel=k;i.convertMeetingPrepAttendeeStatusToViewDataModel=d;i.convertMeetingPrepDocumentResultsToViewDataModel=g;i.convertMeetingPrepMessageResultsToViewDataModel=nt;i.convertMeetingPrepDocumentResultSourceToViewDataModel=tt;i.convertMeetingPrepMessageResultSourceToViewDataModel=it;i.convertMeetingPrepIdentityToPersonViewDataModel=a;i.convertFeedItemToViewDataModel=rt;i.convertBaseFeedItemToViewDataModel=s;i.convertFileFeedItemToViewDataModel=ut;i.convertVideoFeedItemToViewDataModel=ft;i.convertMentionFeedItemToViewDataModel=v;i.getItemSourceFromContainerInfo=et;const yi=t=>{var u;const f=n.msbDsbHost.getLocString("TrendingTidbit");if(!t)return i.formatTidbitWithActor(f,"Other");const r=rr(t);if(!r)return t.kind==="newsInclusionReason"?i.formatTidbitWithActor(n.msbDsbHost.getLocString("RecentCompanyNewsTidbit"),"Other"):i.formatTidbitWithActor(f,"Other");switch(t.kind){case"activityInclusionReason":case"aggregatedActivityInclusionReason":return i.getActivityTidbit(r,(u=t.activity)===null||u===void 0?void 0:u.kind);case"recommendedInclusionReason":return i.getRecommendedTidbit(t.inclusionKind,r);case"yammerAnnouncementInclusionReason":case"yammerFeaturedConversationInclusionReason":case"yammerPostInclusionReason":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("PostedTidbit"),"Other",r);case"meetingRecordingInclusionReason":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("RecordedMeetingTidbit"),"Other",r);case"newsInclusionReason":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("RecentCompanyNewsTidbit"),"Other");case"trendingInclusionReason":default:return i.formatTidbitWithActor(f,"Other")}};i.getTidbitHeaderIcon=n=>{var t;if(!n)return"trendingIcon";const r=n.inclusionKind;switch(n.kind){case"activityInclusionReason":case"aggregatedActivityInclusionReason":return i.getActivityTidbitIcon((t=n.activity)===null||t===void 0?void 0:t.kind);case"recommendedInclusionReason":return i.getRecommendedTidbitIcon(r);case"meetingRecordingInclusionReason":return pi();case"newsInclusionReason":return wi();case"trendingInclusionReason":default:return"trendingIcon"}};i.getActivityTidbit=(t,r)=>{switch(r){case"authorActivity":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("PostedTidbit"),"Other",t);case"commentActivity":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("CommentedTidbit"),"FileComment",t);case"mentionActivity":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("MentionedTidbit"),"Other",{isMe:!0},t);case"mentionedMeActivity":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("MentionedYouTidbit"),"Other",t);case"modifyActivity":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("ModifiedTidbit"),"FileEdited",t);case"sharingActivity":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("SharedTidbit"),"FileSharedByYou",t);case"viewActivity":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("ViewedTidbit"),"Other",t);default:return i.formatTidbitWithActor(n.msbDsbHost.getLocString("TrendingTidbit"),"Other")}};i.getRecommendedTidbit=(t,r)=>{switch(t){case"SingleCommentYou":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("CommentedTidbit"),"Other",r);case"CommentReplyOthers":case"CommentReplyToYou":case"CommentReplyYou":case"SingleCommentOthers":case"MultipleCommentOthers":case"MultipleCommentYouAndOthers":case"SingleMentionOthers":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("CommentedTidbit"),"FileComment",r);case"SingleMentionYou":case"MultipleMentionYouAndOthers":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("MentionedTidbit"),"Other",{isMe:!0},r);case"SingleMentionedYou":case"MultipleMentionedYou":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("MentionedYouTidbit"),"Other",r);case"SingleEditYou":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("ModifiedTidbit"),"FileEdited",r);case"MultipleEditOthers":case"SingleEditOthers":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("ModifiedTidbit"),"FileEdited",r);case"SharedWithMe":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("SharedTidbit"),"FileSharedByOther",r);case"FrequentlyOpen":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("FrequentlyOpenTidbit"),"Other",r);case"RecentlyOpen":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("RecentlyOpenedTidbit"),"Other",r);case"SingleTaskActivityByOthers":return i.formatTidbitWithActor(n.msbDsbHost.getLocString("TaskCreatedTidbit"),"Other",r);default:return i.formatTidbitWithActor(n.msbDsbHost.getLocString("TrendingTidbit"),"Other")}};i.formatTidbitWithActor=(n,t,i,r)=>({firstActor:i,inclusionType:t,tidbit:n,secondActor:r});i.getActivityTidbitIcon=n=>{switch(n){case"authorActivity":return"postIcon";case"commentActivity":return"commentIcon";case"mentionActivity":return"atCommentIcon";case"mentionedMeActivity":return"atIcon";case"modifyActivity":return"editIcon";case"sharingActivity":return"peopleIcon";case"viewActivity":return"viewedIcon";default:return"trendingIcon"}};i.getRecommendedTidbitIcon=n=>{switch(n){case"CommentReplyToYou":case"CommentReplyOthers":case"CommentReplyYou":case"SingleCommentYou":case"SingleCommentOthers":case"MultipleCommentOthers":case"MultipleCommentYouAndOthers":case"SingleMentionOthers":return"commentIcon";case"SingleMentionYou":case"MultipleMentionYouAndOthers":case"SingleMentionedYou":case"MultipleMentionedYou":return"atCommentIcon";case"SingleEditYou":case"MultipleEditOthers":case"SingleEditOthers":return"editIcon";case"SharedWithMe":return"peopleIcon";case"FrequentlyOpen":return"openFolderIcon";case"RecentlyOpen":return"openFolderIcon";default:return"trendingIcon"}};const pi=()=>"recordingIcon",wi=()=>"postIcon";i.createLearningCardViewDataModel=bi;i.createEduCardViewDataModel=ki;i.convertPopularSearchesAnswerToViewModel=di;i.getColorForEduCards=ot;i.convertAnswerTypeToViewDataModel=e;i.convertRecommendedPeopleToViewDataModel=st;i.convertRecommendedPersonToViewDataModel=ht;i.getUidFromRecommendedPeopleId=ct;i.convertOrgChartPersonListToViewDataModel=c;i.convertOrgChartPersonToViewDataModel=y;i.getInitialsFromFullName=o;i.getOutlookEmailDeepLinkFromId=lt;i.getTeamsChatDeepLinkFromId=gi;i.convertAnswerTypeToServiceContract=nr;i.convertSearchBoxGleamAnswer=tr;i.convertSearchBoxGleam=at;i.getDynamicAnswerStateInConversion=ir;i.convertAnswerToErrorEventType=vt;i.convertRecentQueriesAnswerToViewModel=fr;i.convertEduAssignmentAnswerToViewDataModel=sr;i.convertEduAssignmentToViewDataModel=pt;i.convertEduAssignmentItemToViewDataModel=wt;i.convertEduClassAnswerToViewDataModel=cr;i.convertEduClassToViewDataModel=bt;i.convertEduClassItemToViewDataModel=kt;i.logAnswerConversionError=dt})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){i.ViewDataContext=React.createContext(undefined);class r{constructor(t,r,u,f){this.externalDataManager=t;this.renderingMonitor=r;this.recommendedPeopleViewDataManager=u;this.mainPageLayoutManager=f;this.ContextProvider=({blendedRegion:t,children:r})=>{const f="ContextProvider-"+t;this.initState.uiOptions.blendMode=n.msbDsbHost.getBlendMode();const[e,u]=React.useReducer(this.rootReducer,this.initState),[s,h]=React.useState(!1),[o,c]=React.useState(undefined);return this.renderingMonitor.startPollingMainPageLoaded(),this.externalDataManager.isDataChangeHandlerBound(f)||this.externalDataManager.bindDataChanged(f,async(r,...f)=>{switch(r){case"MainPageData":{let r=this.externalDataManager.getMainPageData();if(n.config.msbDsbDynamicBlend){const n=this.externalDataManager.getBlendedRegionalData();if(n)switch(t){case"BrMain":r=n.mainBlendedRegionData;break;case"BrTop":r=n.topBlendedRegionData;break;default:r=undefined}}const e=f[0];c(e);n.msbPerfLogger===null||n.msbPerfLogger===void 0?void 0:n.msbPerfLogger.mark(n.MsbPerfProbe.DsbMainPageRenderStarted,e);u(i.setMainPageDataAction(r));const o=await this.recommendedPeopleViewDataManager.getRecommendedPeoplePaginationSettingAsync(r===null||r===void 0?void 0:r.recommendedPeopleAnswer);u(i.setRecommendedPeoplePaginationSettingAction(o));break}case"BlendMode":{const[n]=f;u(i.setBlendModeAction(n));break}case"ImageOfTheDay":{const[n]=f;u(i.setImageOfTheDayAction(n));break}case"PersonPhoto":{const[n,t]=f;u(i.setPersonPhotoAction(n,t));break}case"GroupPhoto":{const[n,t]=f;u(i.setGroupPhotoAction(n,t));break}case"FeedItemPreview":{const[n,t]=f;u(i.setFeedItemPreviewAction(n,t));break}case"FileIcon":{const[n,t]=f;u(i.setFileIconAction(n,t));break}case"FluentIconSvgHtml":{const[n,t]=f;u(i.setFluentIconSvgHtmlAction(n,t));break}case"M365AppList":{const[n]=f;u(i.setM365AppStateAction(n));break}}}),s||(n.Host.bindDismissed(()=>{var r;const t=(r=this.externalDataManager.getMainPageData())===null||r===void 0?void 0:r.dynamicAnswer;!n.config.msbDsbMockServiceClients&&t&&i.isDynamicScenarioExpired(t)&&u(i.dismissAnswerAction(t.answerType,t.answerId,{dismissOnView:!0,dismissViaRequest:!1}));n.config.msbEnableChatUpsell&&n.msbHost.getChatEligibility()!="None"&&u(i.setChatUpsellCurrIdxStateAction())}),h(!0)),React.useEffect(()=>()=>this.externalDataManager.unbindDataChanged(f),[]),React.useEffect(()=>{const t=()=>u(i.setIsDarkModeAction(n.isDarkModeEnabled()));return n.Host.bindShown(t),()=>{n.Host.unbindShown(t)}},[]),React.useEffect(()=>{n.msbPerfLogger===null||n.msbPerfLogger===void 0?void 0:n.msbPerfLogger.mark(n.MsbPerfProbe.DsbMainPageRenderEnd,o),this.renderingMonitor.setMainPageDataRefreshed()},[e.mainPageState,o]),React.createElement(i.ViewDataContext.Provider,{value:{state:e,dispatch:u}},r)};this.rootReducer=i.createRootReducer(this.externalDataManager,this.recommendedPeopleViewDataManager,this.mainPageLayoutManager);this.initState=this.buildInitState()}buildInitState(){const n=i.getIsMyOrgChartExpanded(),r=i.getIsEduClassesExpanded(),u=i.getIsEduAssignmentsExpanded();return{uiOptions:{isDarkMode:!1,errorBoundaryResetKey:0,isMyOrgChartExpanded:n,isEduClassesExpanded:r,isEduAssignmentsExpanded:u,blendMode:t.DEFAULT_BLEND_MODE},paginationSettings:{},mainPageState:{mainPageData:undefined,mainPageLayout:[]},imageOfTheDay:{imageOfTheDay:undefined},personPhotos:{},groupPhotos:{},feedItemPreviews:{},fileIcons:{},fluentIconSvgHtmls:{},chatUpsellState:{currSuggestionIdx:0},m365AppsState:{appStateList:undefined}}}}i.ViewDataManager=r})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){function r(){let t=n.config.msbDsbPersistOrgChartExpansion==="alwaysOn";if(n.config.msbDsbPersistOrgChartExpansion==="storage"){const i=n.LightweightStorage.getItem(n.MsbDsb.MYORGCHART_EXPANSION_STORAGE_KEY);t=i?i==="1":!!n.config.msbDsbColdStartOrgChartOpen}return t}function u(){const t=n.LightweightStorage.getItem(n.MsbDsb.EDUCLASSES_EXPANSION_STORAGE_KEY);return t?t==="1":!0}function f(){const t=n.LightweightStorage.getItem(n.MsbDsb.EDUASSIGNMENTS_EXPANSION_STORAGE_KEY);return t?t==="1":!0}function e(t){var i;const r=(i=t===null||t===void 0?void 0:t.expiryTime)===null||i===void 0?void 0:i.getTime();return typeof r=="number"&&n.getCurrentTime()>r}function i(n){return n==="MeetingPrep"}function o(n){return i(n)||n==="IndustryNews"||n==="PeopleHighlights"}function s(n){const t=(n===null||n===void 0?void 0:n.status)==="Succeeded",r=t&&i(n.answerType);return{isAnswerStatusSucceeded:t,isAnswerM365Content:r}}function h(t,i){const r=t.slice(0,i);return n.msbDsbHost.getLocString("TruncatedTextPattern",r)}function c(n){const t=[...n];for(let n=t.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[t[n],t[i]]=[t[i],t[n]]}return t}function l(t){var i,r;const u=[{title:"PersonCentricOrgSearch",instrumentationQuery:"org"},{title:"AuthorsFilesSearchSuggestions",instrumentationQuery:"files"},{title:"PersonCentricContactSearch",instrumentationQuery:"contact"},{title:"PersonCentricCalenderSearch",instrumentationQuery:"calendar"},],f=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.staticPeopleCentricSuggestions)?u:c(u),e=(r=(i=n.getFirstAndLastName(t))===null||i===void 0?void 0:i.firstName)!==null&&r!==void 0?r:"";return f.map(t=>{const i=n.msbDsbHost.getLocString(t.title,e);return{title:i,icon:"personIcon",query:i,scope:n.Scope.Work}})}t.getIsMyOrgChartExpanded=r;t.getIsEduClassesExpanded=u;t.getIsEduAssignmentsExpanded=f;t.isDynamicScenarioExpired=e;t.isViewModelAnswerTypeDynamicM365=i;t.isViewModelAnswerTypeDynamic=o;t.getDynamicAnswerState=s;t.getTruncatedText=h;t.generateRandomPersonCentricSuggestions=l})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){function c(i,u){var w,b;const{chatText:y,isCached:g,type:nt}=i,p=y===null||y===void 0?void 0:y.trim();if(!p)throw new t.ParserError("chatText cannot be empty string");const k=i.contentType;if(k&&!t.isContentTypeHtml(k))return{messageContent:p,isHtml:!1};const c=(new DOMParser).parseFromString(y,"text/html");if(!(((b=(w=c===null||c===void 0?void 0:c.body)===null||w===void 0?void 0:w.children)===null||b===void 0?void 0:b.length)>0)){if(t.isPotentiallyHtml(p)){n.msbDsbLogger.logError(g?"Wsb Dsb message snippet is bad html cached":"Wsb Dsb message snippet is bad html");throw new t.ParserError(`Chat message is badly formatted html string with content type: ${k}`);}return{messageContent:p,isHtml:!1}}const s=c.createTreeWalker(c.body,NodeFilter.SHOW_ELEMENT);let e=s.currentNode;while(e)t.isNodeWhitespace(e)&&t.removeNode(s,e),e.nodeName===f?t.removeNode(s,e):o.indexOf(e.nodeName)==-1?t.sanitizeNode(s,e):e.nodeName===r?(e.className=h,u&&t.sanitizeNode(s,e)):l(e)&&(nt=="Feed"?a(s,e,i.mentionList):v(s,e)),e.removeAttribute("style"),e=s.nextNode();const d=c.body.innerHTML.trim();if(!d)throw new t.ParserError("chatText does not appear to have any content");return{messageContent:d,isHtml:!0,messageString:c.body.textContent}}function l(n){if(!n||n.nodeName!==i)return!1;const t=n.getAttribute("itemtype");return t===e}function a(n,t,i){var r,f,e;const s=y(i);let o;const h=parseInt((r=t.getAttribute("itemid"))!==null&&r!==void 0?r:"");n.parentNode();o=h in s?u(t):document.createTextNode((f=t.textContent)!==null&&f!==void 0?f:"");(e=t.parentNode)===null||e===void 0?void 0:e.replaceChild(o,t)}function v(n,t){var i;n.parentNode();const r=u(t);(i=t.parentNode)===null||i===void 0?void 0:i.replaceChild(r,t)}function u(n){const t=document.createElement(i);return t.textContent=n.textContent,t.className=s,t}function y(n){const t={};return n.forEach(n=>{const i=n.id.toString();i in t||(t[i]=n)}),t}const r="A",i="SPAN",f="BLOCKQUOTE",e="http://schema.skype.com/Mention",o=["BODY","P","DIV",r,i],s="chat-message-mentioned-name",h="chat-message-link";t.parseChatMessage=c})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){function o(i,e,o,c=false){var p,w;if(!i)throw new t.ParserError("emailText cannot be null or undefined");i=i.replace(/^\s*[\r\n]/gm,"");const y=i===null||i===void 0?void 0:i.trim();if(!y)throw new t.ParserError("emailText cannot be empty string");if(o&&!t.isContentTypeHtml(o))return{messageContent:y,isHtml:!1};const a=(new DOMParser).parseFromString(i,"text/html");if(!(((w=(p=a===null||a===void 0?void 0:a.body)===null||p===void 0?void 0:p.children)===null||w===void 0?void 0:w.length)>0)){if(t.isPotentiallyHtml(y)){n.msbDsbLogger.logError(e?"Wsb Dsb message snippet is bad html cached":"Wsb Dsb message snippet is bad html");throw new t.ParserError(`email snippet is badly formatted html string with content type: ${o}`);}return{messageContent:y,isHtml:!1}}const v=a.createTreeWalker(a.body,NodeFilter.SHOW_ELEMENT);let l=v.currentNode;while(l)t.isNodeWhitespace(l)&&t.removeNode(v,l),u.indexOf(l.nodeName)==-1?t.sanitizeNode(v,l):l.nodeName===r&&(h(l)?s(v,l):(l.className=f,c||l.removeAttribute("href"))),l.removeAttribute("style"),l=v.nextNode();const b=a.body.innerHTML.trim();if(!b)throw new t.ParserError("chatText does not appear to have any content");return{messageContent:b,isHtml:!0,messageString:a.body.textContent}}function s(n,t){var r;n.parentNode();const u=document.createElement(i);if(t.textContent){const n=t.textContent.length;u.textContent=t.textContent.substring(1,n)}u.className=e;(r=t.parentNode)===null||r===void 0?void 0:r.replaceChild(u,t)}function h(n){var t,r,u,f;if(!((t=n.getAttribute("href"))===null||t===void 0?void 0:t.startsWith("mailto:"))||((r=n.childNodes)===null||r===void 0?void 0:r.length)!==1)return!1;const e=(u=n.childNodes)===null||u===void 0?void 0:u[0];return(e===null||e===void 0?void 0:e.nodeName)!==i?!1:(f=n.innerText)===null||f===void 0?void 0:f.startsWith("@")}const r="A",i="SPAN",u=["BODY","P","DIV",r,i],f="email-message-link",e="email-message-mentioned-name";t.parseEmailMessage=o})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(n){var t;(function(n){function i(n,t){var i;n.parentNode();const r=document.createTextNode(t.textContent);(i=t.parentNode)===null||i===void 0?void 0:i.replaceChild(r,t)}function r(n,t){var i;n.parentNode();(i=t.parentNode)===null||i===void 0?void 0:i.removeChild(t)}function u(n){return n.innerHTML==="&nbsp;"||n.innerHTML===""}function f(n){return n.toUpperCase()==="HTML"}function e(n){var t;return((t=n.match(/<\/\w[\s\S]*>/i))===null||t===void 0?void 0:t.length)>0}class t extends Error{constructor(n,t){super(n);this.innerError=t}}n.ParserError=t;n.sanitizeNode=i;n.removeNode=r;n.isNodeWhitespace=u;n.isContentTypeHtml=f;n.isPotentiallyHtml=e})(t=n.DataContext||(n.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){const r="rec-ppl-pg",u=2,f=36e5;class e{constructor(n){this.cacheManager=n;this.pendingInitPromise=this.loadRecommendedPeoplePaginationInfoAsync().then(n=>{this.recommendedPeoplePaginationInfo=n}).catch(()=>{})}async getRecommendedPeoplePaginationSettingAsync(t){var f;this.pendingInitPromise&&(await this.pendingInitPromise,this.pendingInitPromise=undefined);const e=n.getCurrentTime(),o=this.getRecommendedNumberOfShownPeople(),s=(f=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbRecPeoplePageRefreshIntervalInHours)!==null&&f!==void 0?f:u;let i=0,r=!1;return t&&(this.recommendedPeoplePaginationInfo?(i=this.recommendedPeoplePaginationInfo.currentPageIndex,this.isNewAnswer(this.recommendedPeoplePaginationInfo.hash,t.hash)?(i=0,r=!0):this.isExpired(s,this.recommendedPeoplePaginationInfo.lastRefreshTimestamp)&&(i=i+1,r=!0)):r=!0,r&&(this.recommendedPeoplePaginationInfo={hash:t.hash,currentPageIndex:i,lastRefreshTimestamp:e},await this.saveRecommendedPeoplePaginationInfoAsync())),{currentPageIndex:i,pageSize:o}}async updateRecommendedPeoplePageIndexAsync(t){this.pendingInitPromise&&(await this.pendingInitPromise,this.pendingInitPromise=undefined);this.recommendedPeoplePaginationInfo&&(this.recommendedPeoplePaginationInfo.currentPageIndex=t,this.recommendedPeoplePaginationInfo.lastRefreshTimestamp=n.getCurrentTime());await this.saveRecommendedPeoplePaginationInfoAsync()}isNewAnswer(n,t){return t?n!=t:!0}getRecommendedNumberOfShownPeople(){const i=n.msbDsbHost.isPeopleExplanationEnabled();return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbRecommendedPeoplePageSize)&&!i?n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbRecommendedPeoplePageSize:i?t.PEOPLEHERO_PERSON_DISPLAY_COUNT:t.RECOMMENDED_PEOPLE_DISPLAY_COUNT}isExpired(t,i){const r=n.getCurrentTime();return i?r-i>=t*f?!0:!1:!0}async loadRecommendedPeoplePaginationInfoAsync(){return await this.cacheManager.getDataAsync(r)}async saveRecommendedPeoplePaginationInfoAsync(){this.recommendedPeoplePaginationInfo&&await this.cacheManager.setDataAsync(r,this.recommendedPeoplePaginationInfo)}}i.RecommendedPeopleViewManager=e})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){const i=["SearchBox","Dynamic"],r=["RecommendedPeople","OrgChart","PopularSearch","Feed","Acronyms"];class u{getMainPageLayout(t){const i=n.config.msbDsbStaticRanking;switch(i){case 1:return this.createStaticRankingLayoutT1();case 2:return this.createStaticRankingLayoutT2();case 3:return this.createStaticRankingLayoutT3();case 4:return this.createStaticRankingLayoutT4();case 5:return this.createStaticRankingLayoutT5();case 6:return this.createStaticRankingLayoutT6();case 7:return this.createStaticRankingLayoutT7();case 0:default:return this.createMainPageLayout(t)}}createMainPageLayout(t){var r;if(n.msbHost.isEduTenant())return[];const i=[];i.push("SearchBox");n.config.msbEnableScopeSwitchButton&&i.push("ScopeSwitch");n.config.msbEnableM365AppList&&i.push("M365AppList");t.dynamicAnswer?i.push("Dynamic"):i.push("FileHero");i.push("RecommendedPeople");i.push("OrgChart");((r=n.msbHost.msbWorkChatUtils)===null||r===void 0?void 0:r.validChatEligibilityStateForCard())&&(n.config.msbChatUpsellLocation!=-1?i.splice(n.config.msbChatUpsellLocation,0,"WorkChatCard"):i.push("WorkChatCard"));const u=t.dynamicAnswer?"None":"Feed";return i.push("PopularSearch"),i.push(u),i.push("Acronyms"),i}createStaticRankingLayoutT1(){return["SearchBox","Dynamic","RecommendedPeople","OrgChart","PopularSearch","Feed","Acronyms"]}createStaticRankingLayoutT2(){return["Dynamic","RecommendedPeople","OrgChart","PopularSearch","Feed","Acronyms"]}createStaticRankingLayoutT3(){return["Dynamic","RecommendedPeople","PopularSearch","Feed","Acronyms","OrgChart"]}createStaticRankingLayoutT4(){return["Dynamic","RecommendedPeople","Acronyms","Feed","PopularSearch","OrgChart"]}createStaticRankingLayoutT5(){return["Dynamic","Feed","RecommendedPeople","OrgChart","PopularSearch","Acronyms"]}createStaticRankingLayoutT6(){return i.concat(this.createRandomOrder(r))}createStaticRankingLayoutT7(){if(n.isNewDay(this.currentDateTime)){const t=i.concat(this.createRandomOrder(r));return this.currentDateTime=n.getCurrentTime(),this.currentOrder=t,t}return this.currentOrder}createRandomOrder(n){for(let t=n.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1)),r=n[t];n[t]=n[i];n[i]=r}return n}}t.MainPageLayoutManager=u})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){function f(t,i){var u;const r=[];let f=!1;if(Object.keys(i).length>0&&((u=t===null||t===void 0?void 0:t.scenario)===null||u===void 0?void 0:u.answers)){const{scenario:{answers:u}}=t;for(const t of u){const e=t.answerType,u=i[e];(u===null||u===void 0?void 0:u.hash)&&t&&t.hash&&u.hash===t.hash?r.push(u):t.status==="Succeeded"||t.status==="Empty"?(r.push(t),n.config.msbDsbBadging&&t.status==="Succeeded"&&!o(e)&&(f=!0)):e==="SearchBoxGleam"&&u?r.push(u):r.push(t)}t.scenario.answers=r;t.hasNewContent=f}return t}function e(n,t,i){var f;const e=[];if(Object.keys(t).length>0&&((f=n===null||n===void 0?void 0:n.scenario)===null||f===void 0?void 0:f.answers)){const{scenario:{answers:f}}=n;for(const n of f){const o=n.answerType,f=t[o];r(n.answerType)||i&&u(n.answerType)||(n===null||n===void 0?void 0:n.status)==="Succeeded"||(n===null||n===void 0?void 0:n.status)==="Empty"||(f===null||f===void 0?void 0:f.status)!=="Succeeded"?e.push(n):e.push(f)}n.scenario.answers=e}return n}function r(n){switch(n){case"MeetingPrep":case"IndustryNews":return!0;default:return!1}}function u(n){switch(n){case"MeetingPrep":case"IndustryNews":case"Feed":case"RecentQueries":return!0;default:return!1}}function o(t){switch(t){case"RecommendedPeople":case"OrgChart":case"Feed":case"EduAssignments":case"EduClasses":return!1;case"MeetingPrep":return!n.config.msbDsbBadgingDynamic;default:return!0}}function s(n,t){var i;return(t===null||t===void 0?void 0:t.dismissedAnswers)||(t={dismissedAnswers:[]}),t.dismissedAnswers=[n].concat((i=t.dismissedAnswers)!==null&&i!==void 0?i:[]),t}function h(n,t){return(t===null||t===void 0?void 0:t.dismissedAnswers)?t.dismissedAnswers.indexOf(n)!==-1:!1}function c(n){var t;const i={};if((t=n===null||n===void 0?void 0:n.scenario)===null||t===void 0?void 0:t.answers){const{scenario:{answers:t}}=n;for(const n of t)(n===null||n===void 0?void 0:n.hash)&&(i[n.answerType]=n.hash)}return{AnswersInCache:i}}function l(n){var t;const i={};if((t=n===null||n===void 0?void 0:n.scenario)===null||t===void 0?void 0:t.answers){const{scenario:{answers:t}}=n;for(const n of t)(n===null||n===void 0?void 0:n.answerType)&&(i[n.answerType]=n)}return i}function a(t,i){var r,u,f,e,o;if((r=t===null||t===void 0?void 0:t.scenario)===null||r===void 0?void 0:r.answers){const{scenario:{answers:r}}=t;for(const t of r)if((t===null||t===void 0?void 0:t.answerType)==="OrgChart"&&(t===null||t===void 0?void 0:t.status)==="Succeeded"){const r=t,h=(f=(u=r.reportingChain)===null||u===void 0?void 0:u.slice(1))!==null&&f!==void 0?f:[],c=(e=r.directReports)!==null&&e!==void 0?e:[],l=(o=r.peers)!==null&&o!==void 0?o:[],s=v(h,c,l);if(s!==null)return n.msbDsbLogger.logOrgChartAnswerChangeType(s.changeType,i,{}),!0}}return!1}function v(n,t,r){const u=n===null||n===void 0?void 0:n.filter(i),f=t===null||t===void 0?void 0:t.filter(i),e=r===null||r===void 0?void 0:r.filter(i);if((u===null||u===void 0?void 0:u.length)>0||(f===null||f===void 0?void 0:f.length)>0||(e===null||e===void 0?void 0:e.length)>0){let n;return(u===null||u===void 0?void 0:u.length)>0?n=u[0]:(f===null||f===void 0?void 0:f.length)>0?n=f[0]:(e===null||e===void 0?void 0:e.length)>0&&(n=e[0]),n}return null}function i(n){return(n===null||n===void 0?void 0:n.changeType)&&(n===null||n===void 0?void 0:n.changeType)!=="None"}t.rehydrateAnswersFromCache=f;t.replaceFailedAnswersWithCachedAnswers=e;t.isResponseAnswerTypeDynamic=r;t.isResponseAnswerTypeDismissable=u;t.addDismissedAnswerId=s;t.isAnswerDismissed=h;t.getAnswersInCacheHashes=c;t.getAnswersInCache=l;t.logOrgChartChanges=a})(i=t.DataContext||(t.DataContext={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(n){function f(n){return i(n,!0)}function e(n){return i(n,!1)}function i(n,t){try{const i=(new DOMParser).parseFromString(n,"image/svg+xml"),r=i.querySelector("parsererror");if(r)throw new Error(`Parser error: ${r.textContent}`);if(s(i))return n;const u=o(t);c(i,u);let f=h(i);return f.replace('xmlns=""',"")}catch(i){return n}}function o(n){return n?r:u}function s(n){const i=`[tag="${t}"]`,r=n.querySelector(i);return!!r}function h(n){const t=new XMLSerializer;return t.serializeToString(n)}function c(n,i){const r=n.createElement("circle");r.setAttribute("cx",i.cx);r.setAttribute("cy",i.cy);r.setAttribute("r",i.r);r.setAttribute("fill",i.color);r.setAttribute("stroke",i.stroke);r.setAttribute("stroke-width",i.strokeWidth);r.setAttribute("tag",t);n.documentElement.appendChild(r)}const t="badging",r={cx:"217",cy:"24",r:"15",color:"#005FB7",stroke:"#FFFFFF",strokeWidth:"6"},u={cx:"217",cy:"24",r:"15",color:"#60CDFF",stroke:"#333333",strokeWidth:"6"};n.addBadgeToSvgLightMode=f;n.addBadgeToSvgDarkMode=e})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i{constructor(){this.serverRefreshGuid="";this.lastSentShownEventKey=""}getServerRefreshGuid(){return this.serverRefreshGuid}logMainPageShownEvent(n,t){const i=`${_G.IG},${n}`;if(i!=this.lastSentShownEventKey){const r=Object.assign({},this.getContextualProperties(),t);bfbWsbTel.logDsbImpression(n,r);this.lastSentShownEventKey=i}}startNewRefresh(){this.serverRefreshGuid=n.Host.createGuid()}logClickEvent(n,t){const i=Object.assign({},this.getContextualProperties(),t);bfbWsbTel.logDsbClick(n,i)}logHttpError(t,i,r){const u=Object.assign({},this.getContextualProperties(),{BG:r});if(i instanceof n.MsbHttpError){const e=i,{responseContext:o,errorMessage:r,innerError:s,isBrowserOnline:h,hResultString:c}=e,{statusCode:l,serverTraceId:a,requestSentTime:v,responseReceivedTime:y}=o;let f;n.msbHost.isMsbInternalTenant()&&(f=r===null||r===void 0?void 0:r.privateMessage,u.InnerError=n.stringifyError(s));u.Online=h;u.HResult=c;u.ReqTS=v;u.ResTS=y;bfbWsbTel.logHttpError(t,r===null||r===void 0?void 0:r.publicMessage,{statusCode:l,additionalMessage:f,serverTraceId:a},u)}else if(i instanceof n.MsbNoMsbTokenError){const{codeLocation:r}=i;u.CodeLocation=r;bfbWsbTel.logHttpError(t,"No MSB token refreshed",{statusCode:n.ClientErrorCode.NoToken},u)}else n.msbHost.isMsbInternalTenant()&&(u.InnerError=n.stringifyError(i)),bfbWsbTel.logHttpError(t,"Uncaught error",{statusCode:n.ClientErrorCode.UncaughtError},u)}logMTRefresh(n,t,i){const r=Object.assign({},this.getContextualProperties(),{serverTraceId:t},i);bfbWsbTel.logValue("DSB_MT_Refresh",n,r)}logOrgChartAnswerChangeType(n,t,i){const r=Object.assign({},this.getContextualProperties(),{serverTraceId:t},i);bfbWsbTel.logValue("DSB_OrgChartChangeType",n,r)}logGleamMismatchError(n,t,i,r,u,f){const e=Object.assign({},this.getContextualProperties(),{scenario:t,hasLogo:i,gleamKey:r,BG:f,triggeredBy:n,mtReqInfo:u});bfbWsbTel.logError("Wsb Dsb Gleam Icon Mismatch","",undefined,e)}logGleamExpiredError(t,i,r,u,f,e){const o=Object.assign({},this.getContextualProperties(),{scenario:i,hasLogo:r,gleamKey:u,BG:e,triggeredBy:t,mtReqInfo:f,isTenantMsbEnabled:n.msbHost.isTenantMsbEnabled()});bfbWsbTel.logError("Wsb Dsb Gleam Icon Expired","",undefined,o)}logGleamDataContentError(n,t,i){const r=n,u=Object.assign({},this.getContextualProperties(),{scenario:t,gleamKey:i});bfbWsbTel.logError("Wsb Dsb Gleam data content has error",r,undefined,u)}logUiError(t,i){const r="Wsb Dsb UI Error",u=`${i} failed to render: ${t instanceof Error?t.message:"Unknown error"}`,f=JSON.stringify(t,Object.getOwnPropertyNames(t)),e=n.msbHost.isMsbInternalTenant()?f:"",o=Object.assign({},this.getContextualProperties(),{CodeLocation:i,additionalMessage:e});bfbWsbTel.logError(r,u,o)}logResponseError(n,t,i,r,u){const{traceId:o,timestamp:e}=r!==null&&r!==void 0?r:{},s=e?new Date(e).toISOString():null;let f=this.getContextualProperties();u&&(f=Object.assign({},f,{AnswerTraceId:u,RefreshTime:s}));this.logErrorWithProperties(n,f,t,i,o)}logError(n,t,i,r){let u=this.getContextualProperties();r&&r!==""&&(u=Object.assign({},u,{CodeLocation:r}));this.logErrorWithProperties(n,u,t,i)}logErrorWithProperties(t,i,r,u,f){const e=n.msbHost.isMsbInternalTenant()?u:"";bfbWsbTel.logError(t,r,{additionalMessage:e,serverTraceId:f},i)}logEvent(t,i){const r=n.getCurrentTime(),u=Object.assign({},this.getContextualProperties(),i);bfbWsbTel.logValue(t!==null&&t!==void 0?t:"",r,u)}getContextualProperties(){return{page:"DSB",IG:_G===null||_G===void 0?void 0:_G.IG,impressionGuid:_G===null||_G===void 0?void 0:_G.IG,serverRefreshGuid:this.serverRefreshGuid,tenantVariants:n.msbHost.getTenantVariants()}}}t.MsbDsbLogger=i})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i{constructor(){this.substrateEvents=[];this.pageRefreshStartTime=0;this.logicalIds={}}startNewRefresh(n){this.pageRefreshStartTime=n}setLogicalIds(n){if(n){const{scenario:r,recommendedPeopleAnswer:t,dynamicAnswer:i}=n;(t===null||t===void 0?void 0:t.logicalId)&&this.setLogicalId("RecommendedPeople",t.logicalId);r==="MeetingPrep"&&(i===null||i===void 0?void 0:i.logicalId)&&this.setLogicalId("MeetingPrep",i.logicalId)}}clearLogs(){this.substrateEvents=[]}getLogs(){return this.substrateEvents}logSearchFeedbackEvent(n,t,i,r,u,f){const e=this.logicalIds[n];if(e){const s={type:"ResultFoundResponse",responseValue:i,feedbackString:r},o={name:"searchfeedback",attributes:[{key:"logicalid",value:e},{key:"version",value:"2"},{key:"localtime",value:t},{key:"id",value:u},{key:"FeedbackResponse",value:JSON.stringify(s)},]};f&&o.attributes.push({key:"traceId",value:f});this.log(n,e,o)}}logSearchEntityActions(n,t,i,r,u){const f=this.logicalIds[n];if(f){const e={name:"searchentityactions",attributes:[{key:"userid",value:bfbWsbTel===null||bfbWsbTel===void 0?void 0:bfbWsbTel.getUid()},{key:"tenantid",value:bfbWsbTel===null||bfbWsbTel===void 0?void 0:bfbWsbTel.getTenantId()},{key:"logicalid",value:f},{key:"version",value:"2"},{key:"localtime",value:t},{key:"id",value:r},{key:"eventtype",value:i}]};u&&e.attributes.push({key:"traceId",value:u});this.log(n,f,e)}}logResultsRenderEvents(n,t){const i=t?t-this.pageRefreshStartTime:0;this.checkAndLogEvent("resultsrendered",n,i.toString())}logCachedRenderEvents(n,t){this.checkAndLogEvent("cachedcontentrendered",n,t)}logClientLayoutEvents(n,t){this.checkAndLogEvent("clientlayout",n,t)}checkAndLogEvent(n,t,i){if(t){const{scenario:e,recommendedPeopleAnswer:r,dynamicAnswer:u}=t,f={};(r===null||r===void 0?void 0:r.status)==="Succeeded"&&(f.RecommendedPeople=r);e==="MeetingPrep"&&(u===null||u===void 0?void 0:u.status)==="Succeeded"&&(f.MeetingPrep=u);for(const t in f){const r=t,u=f[r];switch(n){case"resultsrendered":this.logResultsRenderedForAnswer(r,i,u.logicalId);break;case"cachedcontentrendered":this.logCachedAnswerRendered(r,i,u.logicalId,u.traceId);break;case"clientlayout":switch(r){case"RecommendedPeople":this.logRecommendedPeopleLayout(i,u);break;case"MeetingPrep":this.logMeetingPrepLayout(i,u)}}}}}logRecommendedPeopleLayout(n,t){const i="horizontal",r={type:"Group",name:"RecommendedPeople",referenceId:null,entityType:null,layoutType:i,position:1,resultsView:t.recommendedPeople.map((n,t)=>({type:"Entity",name:null,referenceId:n.referenceId,entityType:"People",layoutType:null,position:t+1,resultsView:null}))};this.logClientLayout(n,"RecommendedPeople",this.logicalIds[t.answerType],i,r)}logMeetingPrepLayout(n,t){var i,r,u,f,e,o,s;const h="vertical",c=(r=(i=t.fileResults)===null||i===void 0?void 0:i.map((n,t)=>{var i;return{type:"Entity",name:null,referenceId:(i=n.referenceId)!==null&&i!==void 0?i:null,entityType:"File",layoutType:null,position:t+1,resultsView:null}}))!==null&&r!==void 0?r:[],l=(f=(u=t.fileResults)===null||u===void 0?void 0:u.length)!==null&&f!==void 0?f:0,a=(o=(e=t.conversationResults)===null||e===void 0?void 0:e.map((n,t)=>{var i;return{type:"Entity",name:null,referenceId:(i=n.referenceId)!==null&&i!==void 0?i:null,entityType:"Email",layoutType:null,position:t+1+l,resultsView:null}}))!==null&&o!==void 0?o:[],v=c.concat(a),y={type:"Group",name:"AnswerBlock",referenceId:null,entityType:null,layoutType:h,position:1,resultsView:[{type:"Entity",name:null,referenceId:(s=t.meetingId)!==null&&s!==void 0?s:null,entityType:"MeetingProposal",layoutType:null,position:1,resultsView:null},{type:"Group",name:"Recommended Files",referenceId:null,entityType:null,layoutType:"vertical",position:1,resultsView:v}]};this.logClientLayout(n,"MeetingPrep",this.logicalIds[t.answerType],h,y)}setLogicalId(n,t){this.logicalIds[n]=t}logResultsRenderedForAnswer(n,t,i){if(i){const r={name:"resultsrendered",attributes:[{key:"version",value:"2"},{key:"logicalid",value:i},{key:"latency",value:t}]};this.log(n,i,r)}}logClientLayout(n,t,i,r,u){const f={name:"clientlayout",attributes:[{key:"version",value:"2"},{key:"logicalid",value:i},{key:"localtime",value:n},{key:"layouttype",value:r},{key:"resultsview",value:JSON.stringify([u])}]};this.log(t,i,f)}logCachedAnswerRendered(t,i,r,u){if(u){let f=n.Host.createGuid();f=f.replace(/{|}/g,"");this.setLogicalId(t,f);const e={name:"cachedcontentrendered",attributes:[{key:"userid",value:bfbWsbTel===null||bfbWsbTel===void 0?void 0:bfbWsbTel.getUid()},{key:"tenantid",value:bfbWsbTel===null||bfbWsbTel===void 0?void 0:bfbWsbTel.getTenantId()},{key:"version",value:"2"},{key:"localtime",value:i},{key:"logicalid",value:r},{key:"newlogicalid",value:f}]};this.log(t,u,e)}}log(n,t,i){let r=this.substrateEvents.find(n=>n.key===t);r==undefined&&(r={answerType:n,key:t,value:[]},this.substrateEvents.push(r));r.value.push(i)}}t.MsbDsbSubstrateLogger=i})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(n){const t="FeedbackTracker";n.FeedbackTrackerCacheKey="fbt";class i{constructor(i,r){this.cacheManager=i;r.bindDataChanged(t,async t=>{var i,u;switch(t){case"MainPageData":{const t=r.getMainPageData();n.DataContext.isViewModelAnswerTypeDynamicM365((i=t===null||t===void 0?void 0:t.dynamicAnswer)===null||i===void 0?void 0:i.answerType)?await this.setAnswerIdAsync((u=t===null||t===void 0?void 0:t.dynamicAnswer)===null||u===void 0?void 0:u.answerId):await this.setAnswerIdAsync();break}}})}async updateProvidedFeedbackIdAsync(n){let t=await this.getCachedAnswerFeedbackAsync();t||(t={answerId:undefined,providedFeedbackIds:[]});t.providedFeedbackIds.push(n);await this.updatedCachedAnswerFeedbackAsync(t)}async getHasProvidedFeedbackAsync(n){const t=await this.getCachedAnswerFeedbackAsync();return t?t.providedFeedbackIds.indexOf(n)!==-1:!1}async getCachedAnswerFeedbackAsync(){return await this.cacheManager.getDataAsync(n.FeedbackTrackerCacheKey)}async updatedCachedAnswerFeedbackAsync(t){await this.cacheManager.setDataAsync(n.FeedbackTrackerCacheKey,t)}async setAnswerIdAsync(n){n||await this.clearFeedbackAsync();let t=await this.getCachedAnswerFeedbackAsync();(t===null||t===void 0?void 0:t.answerId)!=n&&(t={answerId:n,providedFeedbackIds:[]},await this.updatedCachedAnswerFeedbackAsync(t))}async clearFeedbackAsync(){await this.cacheManager.deleteDataAsync(n.FeedbackTrackerCacheKey)}}n.MsbDsbFeedbackTracker=i})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){const r=216e5,i="lstglinst";class u{constructor(n){this.cacheManager=n;this.resetInstrumentProps()}async instrumentGleamAsync(t,r,u,f){const o=await this.shouldSendInstrumentationAsync();if(o){await this.cacheManager.setDataAsync(i,n.getCurrentTime());let e={};e={gleamData:{text:t,key:r},tenantHasLogo:u,isNewDSBContentFetched:f};n.InstrumentationHelper.instrumentDSBEvent(e)}}resetInstrumentProps(){this.currentKValue=n.InstrumentationCommon.KVALUE_DSB_MSB_CONTENT;this.resetInstrumentPropsDict()}resetInstrumentPropsDict(){this.instrumentedPropsDict={}}getInstrumentProps(){const t=this.getInstrumentPropsFromElement(n.StaticHtmlElements.msbDsbBrTop),i=this.getInstrumentPropsFromElement(n.StaticHtmlElements.msbDsbRoot);return[...t,...i]}getInstrumentPropsFromElement(n){const i=[];if(!n)return i;const r=n.querySelectorAll(`[${t.MDSB_INSTRUMENTED_ITEM_ATTRIBUTE}]`);for(let n=0;n<r.length;n++){const u=r[n],f=u===null||u===void 0?void 0:u.getAttribute(t.MDSB_INSTRUMENTED_ITEM_ATTRIBUTE);if(f){const n=this.instrumentedPropsDict[f];n&&i.push(n)}}return i}getShownComponents(){const n={},t=this.getInstrumentProps();t&&t.forEach(t=>{switch(t.scenario){case"DismissMeetingPrep":case"PositiveMeetingPrep":case"NegativeMeetingPrep":n.MeetingPrep=!0;break;default:n[t.scenario]=!0}});const i=Object.keys(n).sort();return i.unshift("MainPage"),i.join("_")}createInstrumentedItem(t){const i=n.InstrumentedItem.createInstrumentedItemKvalueOverride(this.currentKValue++,t,22);return this.addInstrumentedItemToDict(i),i}safeInstrumentDSB(){const t=n.SequenceNumberManager.getSequenceNumber(),i=t==0;i||n.safeExecute(()=>n.InstrumentationHelper.instrumentDSB(),"MsbDsb.safeInstrumentDSB")}addInstrumentedItemToDict(n){const t=n.getQsCode(),i=n.getKValue(),r=this.getInstrumentedItemKey(t,i);this.instrumentedPropsDict[r]={scenario:t,instrumentedItem:n}}getInstrumentedItemKey(n,t){return`${n}-${t}`}async getLastInstrumentedTimeAsync(){return this.cacheManager.getDataAsync(i)}async shouldSendInstrumentationAsync(){var t;const i=(t=await this.getLastInstrumentedTimeAsync())!==null&&t!==void 0?t:0,u=n.getCurrentTime();return!i||u-i>=r}}t.InstrumentationManager=u})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){const i=864e5,r=6e4,u="badging-showing",f="badging-last-shown-time",k=["MeetingPrep","MeetingPrep_Win11"],d=["IndustryNews"],g=["Baseline_BriefCase","Baseline_BriefCase_Win11","Baseline_MicrosoftLogo","Baseline_BriefCase_Badging","Baseline_MicrosoftLogo_Win11","Baseline_People_Win10","Baseline_People_Win11","Baseline_File_Win10","Baseline_File_Win11"],nt=["Baseline_Edu","Baseline_Edu_Badging"],tt=["RoundedTenantLogo","RoundedTenantLogo_Badging"],it=["RectangularTenantLogo","RectangularTenantLogo_Badging"],rt=3,e="DsbGleamDataPair",o="last-gleam-api-request",s="ODSWG.87579794-8a2e-4319-9f40-25c4af4ca0cf",h="ODSWG.9ef935da-2197-49cb-8fe4-78fab4b37ffb",c="ODSWG.a0742075-b34d-4c6c-9633-b6470cdde61a",l="ODSWG.71700da8-645f-4eba-8761-a12591b53739",ut="ODSWG.b3e7317e-63ff-499c-955d-f33c4913ccfb",ft="ODSWG.086a5892-02b9-40bf-aaee-4d973b303a68",et="ODSWG.84a7cece-c17c-47ea-bc80-8af2edbb7234",ot="ODSWG.f06eb5b2-7d28-478d-b9dd-562a6e39a02c",a="ODSWG.82f218b9-7c8c-4fce-ba8e-c93f665f076c",v="ODSWG.36161f0d-6f80-4877-ace8-af6d4d11d9f3",st="ODSWG.b085da96-47e8-4ac1-bf6e-91aeeeca8839",ht="ODSWG.fcb2fdb0-c330-4ca4-9703-1453195dd7ff",y="ODSWG.44c8274a-2bcb-47f6-8aee-36512012abf9",p="ODSWG.3ed5d221-00c2-43d0-9bb3-28e8867d76f8",w="ODSWG.1f8e27bf-2a37-4a5d-a543-f23344f44bff",b="ODSWG.95bb7a39-91b7-4dc0-a37f-961584fb733a";class ct{constructor(n){this.cacheManager=n;this.rotationPointer=0}getDynamicSearchBoxContent(){return this.dynamicSearchBoxContent}setMainPageGleamData(n){if(n){const t=n===null||n===void 0?void 0:n.scenario,i=this.getDefaultScenarioGleamData(t),r=this.getBaselineGleamData(n);n.gleamDataPair={scenarioGleamData:i,baselineGleamData:r}}}async setGleamContentToDisplayAsync(t,i,r,u,f,e){var h;let s,c=!1;r!=="MTFetchFailed"?(this.isGleamValid(t===null||t===void 0?void 0:t.scenarioGleamData)?(s=t.scenarioGleamData,c=!0):s=this.isGleamValid(t===null||t===void 0?void 0:t.baselineGleamData)?t.baselineGleamData:this.getDefaultFallbackGleamData(),await this.setGleamDataPairAsync(s)):s=(h=await this.getGleamDataPairAsync())!==null&&h!==void 0?h:this.getDefaultFallbackGleamData();const l=Object.assign({},s.gleamContent),o=Object.assign({},s,{gleamContent:l});if(o.description="",n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbLastUpdateTimeInSearchBar){const n=`[${(new Date).toLocaleTimeString("en-US")}${e?"*":""}] `;o.description=n+o.description}if(n.config.msbDsbBadging){let i=n.config.msbDsbBadgingSuppressionTimeInHours*36e5;(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbBadgingSupressionPeriodInMin)&&(i=n.TestHookUrlParameters.msbDsbBadgingSupressionPeriodInMin*6e4);const r=await n.msbDsbHost.getMtHasNewContentAsync();let t=!1;if(r&&(!c||n.config.msbDsbBadgingDynamic)){const r=n.getCurrentTime(),u=await this.getBadgingLastShownEndTimeAsync();r-u>i&&(t=!0)}t&&(o.gleamContent.lightGleam.startsWith("https")?(o.gleamContent.lightGleam=n.getImageUrl(st),o.gleamContent.darkGleam=n.getImageUrl(ht)):(o.gleamContent.lightGleam=n.MsbDsb.addBadgeToSvgLightMode(o.gleamContent.lightGleam),o.gleamContent.darkGleam=n.MsbDsb.addBadgeToSvgDarkMode(o.gleamContent.darkGleam)));o.isBadgeAdded=t;await this.setIsBadgingShowingAsync(t)}await this.checkIsGleamMismatchedAsync(o,u,r,e);await this.checkIsGleamExpiredAsync(o,u,r,e);this.setWsbSearchBoxContent(o,f+" MsbDsbGleamManager.setGleamContentToDisplayAsync",i)}async updateBadgingInShownAsync(t,i){const r=await this.getIsBadgingShowingAsync();if(r){const r=n.getCurrentTime();await this.setIsBadgingShowingAsync(!1);await this.setBadgingLastShownEndTimeAsync(r);await this.setGleamContentToDisplayAsync(t===null||t===void 0?void 0:t.gleamDataPair,!1,"updateBadgingAfterWsbOpen",t===null||t===void 0?void 0:t.scenario,i+" MsbDsbGleamManager.updateBadgingInShownAsync",!1)}}async setGleamDataPairAsync(n){await this.cacheManager.setDataAsync(e,n)}async getGleamDataPairAsync(){return await this.cacheManager.getDataAsync(e)}getBaselineGleamData(t){var r;let i=(r=t===null||t===void 0?void 0:t.gleamDataPair)===null||r===void 0?void 0:r.baselineGleamData;return(i===null||i===void 0?void 0:i.gleamContent)&&!n.config.msbDsbGleamRotation||(i=this.getDefaultBaselineGleamData()),i}getDefaultScenarioGleamData(n){return n=="Baseline"?undefined:{gleamContent:this.getDefaultScenarioGleams(n),longExpiration:n=="MeetingPrep",scenario:n,description:this.getScenarioDescription(n)}}getDefaultBaselineGleamData(){return{gleamContent:this.getDefaultScenarioGleams("Baseline"),longExpiration:!0,scenario:"Baseline",description:this.getScenarioDescription("Baseline")}}getDefaultFallbackGleamData(){const t=this.getDefaultBaselineGleamData();return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbLastUpdateTimeInSearchBar)&&(t.description=`[fallback] ${t.description}`),t}isGleamValid(n){var t;return!!((t=n===null||n===void 0?void 0:n.gleamContent)===null||t===void 0?void 0:t.lightGleam)&&!!(n===null||n===void 0?void 0:n.description)}setWsbSearchBoxContent(t,u,f){var o,s;const{description:h,longExpiration:a,gleamContent:e,scenario:c}=t;(e===null||e===void 0?void 0:e.lightGleam)||n.msbDsbLogger.logGleamDataContentError("gleamContent.lightGleam is empty",t.scenario,(o=t.gleamContent)===null||o===void 0?void 0:o.gleamKey);const v=n.msbDsbHost.getUpdateIntervalMins(),l=a?n.getCurrentTime()+i:n.getCurrentTime()+v*2*r;const y={placeholderText:h,lightGleamDataOrUrl:e===null||e===void 0?void 0:e.lightGleam,darkGleamDataOrUrl:e===null||e===void 0?void 0:e.darkGleam,expirationTime:l,gleamSize:(e===null||e===void 0?void 0:e.isBigGleam)?1:0},p=((s=e===null||e===void 0?void 0:e.lightGleam)===null||s===void 0?void 0:s.startsWith("http"))?1:0,w={gleamFormat:p,contentKey:this.getGleamKey(t)};this.dynamicSearchBoxContent={attributes:w,parameters:y};n.msbDsbHost.instrumentationManager.instrumentGleamAsync(c,this.getGleamKey(t),n.msbHost.tenantHasLogo(),!!f);n.logToMC("Bing_QF_MsbDsbGleamManager","MsbGleamManager_updateContent","logMsbDsbGleamManager");n.dsbManager===null||n.dsbManager===void 0?void 0:n.dsbManager.updateDynamicSearchBoxContent(u+" MsbDsbGleamManager.setWsbSearchBoxContent",n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.getName())}async getIsBadgingShowingAsync(){return await this.cacheManager.getDataAsync(u)}async setIsBadgingShowingAsync(n){await this.cacheManager.setDataAsync(u,n)}async getBadgingLastShownEndTimeAsync(){var n;return(n=await this.cacheManager.getDataAsync(f))!==null&&n!==void 0?n:0}async setBadgingLastShownEndTimeAsync(n){await this.cacheManager.setDataAsync(f,n)}getGleamKey(n){var t;const i=(t=n===null||n===void 0?void 0:n.gleamContent)===null||t===void 0?void 0:t.gleamKey,r=(n===null||n===void 0?void 0:n.isBadgeAdded)?"_Badging":"";return`${i}${r}`}getDefaultScenarioGleams(t){const i=n.config.useCobaltCSS?this.getDefaultMeetingPrepWin11Gleam():this.getDefaultMeetingPrepGleam(),r=this.getDefaultIndustryNewsGleam();switch(t){case"MeetingPrep":return i;case"IndustryNews":return r;default:return this.getDefaultBaselineGleam()}}getDefaultBaselineGleam(){return n.msbHost.isEduTenant()?this.getEduDefaultBaselineGleam():n.config.msbDsbGleamRotation?this.getIterationBaselineGleam():this.getDefaultBaselineTenantGleam()}getIterationBaselineGleam(){const t=n.config.useCobaltCSS?this.getDefaultWin11RotationGleams():this.getDefaultWin10RotationGleams();return t[this.rotationPointer++%rt]}getScenarioDescription(n){let t="";switch(n){case"MeetingPrep":t=this.getMeetingPrepDescription();break;case"IndustryNews":t=this.getIndustryNewsDescription();break;default:t=this.getBaselineDescription()}return t}getBaselineDescription(){const t=n.Host.getLocString("BaselineScenarioDescriptionDefault");return n.Host.getLocString("BaselineScenarioDescriptionSearchTenantAndPC",t)}getMeetingPrepDescription(){const t=n.Host.getLocString("MeetingPrepScenarioDescriptionDefault");return n.Host.getLocString("MeetingPrepScenarioDescriptionPattern",t)}getIndustryNewsDescription(){const t=n.msbHost.getTenantName()||n.Host.getLocString("CompanyNamePlaceholder");return n.Host.getLocString("IndustryNewsScenarioDescriptionPattern",t)}async checkIsGleamMismatchedAsync(t,i,r,u){const o=n.msbHost.tenantHasLogo(),f=this.getGleamKey(t),s=n.msbHost.isEduTenant();let e=!1;switch(i){case"MeetingPrep":e=k.includes(f);break;case"IndustryNews":e=d.includes(f);break;case"Baseline":e=s?nt.includes(f):o&&n.msbHost.features.isServerGleamEnabled()?this.isTenantLogoMatched(f):g.includes(f);break;default:e=!1}if(!e){const t=await this.getLastMTRequestInfoAsync();n.msbDsbLogger.logGleamMismatchError(r,i,o,f,t,u)}}async checkIsGleamExpiredAsync(t,i,r,u){const f=await this.isGleamExpired(t.longExpiration);if(f){const f=n.msbHost.tenantHasLogo(),e=this.getGleamKey(t),o=await this.getLastMTRequestInfoAsync();n.msbDsbLogger.logGleamExpiredError(r,i,f,e,o,u)}}isTenantLogoMatched(t){return n.config.undocked?tt.includes(t):it.includes(t)}async isGleamExpired(t){const u=await this.cacheManager.getDataAsync(o);if(!u)return!1;const f=n.getCurrentTime();if(t)return f-u>i;const e=n.msbDsbHost.getUpdateIntervalMins();return f-u>e*2*r}async setLastSetGleamApiTimeAsync(){await this.cacheManager.setDataAsync(o,n.getCurrentTime())}async getLastMTRequestInfoAsync(){const n=await this.cacheManager.getDataAsync(t.DataContext.LastSuccessfulMTRequestKey),i=await this.cacheManager.getDataAsync(t.DataContext.LastMTRequestKey);return(n===null||n===void 0?void 0:n.traceId)==(i===null||i===void 0?void 0:i.traceId)?`${n===null||n===void 0?void 0:n.traceId};${n===null||n===void 0?void 0:n.timestamp}`:`${n===null||n===void 0?void 0:n.traceId};${n===null||n===void 0?void 0:n.timestamp};${i===null||i===void 0?void 0:i.traceId};${i===null||i===void 0?void 0:i.timestamp}`}getDefaultBaselineTenantGleam(){return n.msbHost.isMsbInternalTenant()?n.config.useCobaltCSS?this.getDefaultBaselineMicrosoftLogoWin11Gleam():this.getDefaultBaselineMicrosoftLogoWin10Gleam():n.config.useCobaltCSS?this.getDefaultBaselineBriefcaseWin11Gleam():this.getDefaultBaselineBriefcaseWin10Gleam()}getDefaultMeetingPrepGleam(){return{lightGleam:n.getImageUrl(s),darkGleam:n.getImageUrl(s),isBigGleam:!0,gleamKey:"MeetingPrep"}}getDefaultMeetingPrepWin11Gleam(){return{lightGleam:n.getImageUrl(h),darkGleam:n.getImageUrl(h),isBigGleam:!0,gleamKey:"MeetingPrep_Win11"}}getDefaultIndustryNewsGleam(){return{lightGleam:n.getImageUrl(c),darkGleam:n.getImageUrl(c),isBigGleam:!0,gleamKey:"IndustryNews"}}getEduDefaultBaselineGleam(){return{lightGleam:n.getImageUrl(l),darkGleam:n.getImageUrl(l),isBigGleam:!0,gleamKey:"Baseline_Edu"}}getDefaultBaselineBriefcaseWin10Gleam(){return{lightGleam:n.getImageUrl(a),darkGleam:n.getImageUrl(a),isBigGleam:!0,gleamKey:"Baseline_BriefCase"}}getDefaultBaselineBriefcaseWin11Gleam(){return{lightGleam:n.getImageUrl(v),darkGleam:n.getImageUrl(v),isBigGleam:!0,gleamKey:"Baseline_BriefCase_Win11"}}getDefaultBaselineMicrosoftLogoWin10Gleam(){return{lightGleam:n.getImageUrl(ut),darkGleam:n.getImageUrl(ft),isBigGleam:!0,gleamKey:"Baseline_MicrosoftLogo"}}getDefaultBaselineMicrosoftLogoWin11Gleam(){return{lightGleam:n.getImageUrl(et),darkGleam:n.getImageUrl(ot),isBigGleam:!0,gleamKey:"Baseline_MicrosoftLogo_Win11"}}getDefaultBaselineSvgPeopleWin10Gleam(){return{lightGleam:n.getImageUrl(y),darkGleam:n.getImageUrl(y),isBigGleam:!0,gleamKey:"Baseline_People_Win10"}}getDefaultBaselineSvgPeopleWin11Gleam(){return{lightGleam:n.getImageUrl(p),darkGleam:n.getImageUrl(p),isBigGleam:!0,gleamKey:"Baseline_People_Win11"}}getDefaultBaselineSvgFileWin10Gleam(){return{lightGleam:n.getImageUrl(w),darkGleam:n.getImageUrl(w),isBigGleam:!0,gleamKey:"Baseline_File_Win10"}}getDefaultBaselineSvgFileWin11Gleam(){return{lightGleam:n.getImageUrl(b),darkGleam:n.getImageUrl(b),isBigGleam:!0,gleamKey:"Baseline_File_Win11"}}getDefaultWin10RotationGleams(){return this.defaultWin10RotationGleams||(this.defaultWin10RotationGleams=[this.getDefaultBaselineTenantGleam(),this.getDefaultBaselineSvgPeopleWin10Gleam(),this.getDefaultBaselineSvgFileWin10Gleam()]),this.defaultWin10RotationGleams}getDefaultWin11RotationGleams(){return this.defaultWin11RotationGleams||(this.defaultWin11RotationGleams=[this.getDefaultBaselineTenantGleam(),this.getDefaultBaselineSvgPeopleWin11Gleam(),this.getDefaultBaselineSvgFileWin11Gleam()]),this.defaultWin11RotationGleams}}t.MsbDsbGleamManager=ct})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){class r{constructor(n,t){this.msbTokenManager=n;this.msbHttpWrapper=t}async getMainPageAsync(t){const i=n.msbHost.isEduTenant()?"api/v1/dsb/edufeed":"api/v1/dsb/feed",u=r.buildUrl(i),{token:f,tokenJwtExp:e,tokenRefreshTime:o}=await this.refreshMsbTokenAsync(),s={"X-Client-LocalTime":n.getDateWithTimezone()};return await this.msbHttpWrapper.sendHttpAsync({method:"POST",url:u,body:JSON.stringify(t),headers:s,token:f,tokenJwtExp:e,tokenRefreshTime:o})}async dismissAnswerAsync(t,i){const r={answerType:t,answerId:i};const u=n.msbHost.urlUtils.getDsbUrl("api/v1/dsb/feed/dismiss"),{token:f,tokenJwtExp:e,tokenRefreshTime:o}=await this.refreshMsbTokenAsync();await this.msbHttpWrapper.sendHttpAsync({method:"POST",url:u,body:JSON.stringify(r),token:f,tokenJwtExp:e,tokenRefreshTime:o})}async flushSubstrateLoggingEventsAsync(t){const i={events:t};const u=r.buildUrl("api/v1/dsb/feed/3sevents"),f={"X-Client-LocalTime":n.getDateWithTimezone()},{token:e,tokenJwtExp:o,tokenRefreshTime:s}=await this.refreshMsbTokenAsync();await this.msbHttpWrapper.sendHttpAsync({method:"POST",url:u,body:JSON.stringify(i),headers:f,token:e,tokenJwtExp:o,tokenRefreshTime:s})}async getGroupPhotoAsync(t){const i=n.msbHost.urlUtils.getMsbUrl("v3/search/group/photo"),r=this.buildPhotoFetchPostRequestBody(t),{token:u,tokenJwtExp:f,tokenRefreshTime:e}=await this.refreshMsbTokenAsync(),{result:o}=await this.msbHttpWrapper.sendHttpAsync({method:"POST",url:i,body:r,token:u,tokenJwtExp:f,tokenRefreshTime:e});return o}async getFeedItemPreviewAsync(t,i,r,u){const f=n.msbHost.urlUtils.getDsbUrl("api/v1/dsb/feed/preview"),e=`previewType=${t}&previewUrl=${encodeURIComponent(i)}&previewProxyUrl=${encodeURIComponent(r)}&size=${u}`,o=`${f}?${e}`;const{token:s,tokenJwtExp:h,tokenRefreshTime:c}=await this.refreshMsbTokenAsync(),{result:l}=await this.msbHttpWrapper.sendHttpAsync({method:"GET",url:o,token:s,tokenJwtExp:h,tokenRefreshTime:c});return l}async getFileIconAsync(i){const r=n.getIconForTypeAsync(t.DEFAULT_FILE_ICON,"."+i,0);return new Promise(n=>{r(4,t=>{n(t)})})}async refreshMsbTokenAsync(){const t="MsbServiceClient::refreshMsbTokenAsync";if(n.config.msbEnableAccountManager)try{const{token:t,jwtExp:i,lastRefreshTime:r}=await n.msbHost.accountManager.refreshMsbTokenAsync();return{token:t,tokenJwtExp:i,tokenRefreshTime:r}}catch(i){throw new n.MsbNoMsbTokenError(t);}else return new Promise((i,r)=>{this.msbTokenManager.refreshMsbTokenAndCall(n=>{var t,r;const u=(t=BingAtWork===null||BingAtWork===void 0?void 0:BingAtWork.wsb)===null||t===void 0?void 0:t.wsbAccessTokenJwtExp,f=(r=BingAtWork===null||BingAtWork===void 0?void 0:BingAtWork.wsb)===null||r===void 0?void 0:r.wsbAccessTokenRefreshTime;return i({token:n,tokenJwtExp:u,tokenRefreshTime:f})},()=>r(new n.MsbNoMsbTokenError(t)),t)})}buildPhotoFetchPostRequestBody(n){const t={clientContext:{clientType:"Wsb"},id:n};return JSON.stringify(t)}static buildUrl(n){switch(n){case"api/v1/dsb/feed":case"api/v1/dsb/edufeed":return r.buildFeedUrl(n);case"api/v1/dsb/feed/3sevents":return r.build3SEventMTUrl(n)}return undefined}static build3SEventMTUrl(t){const i=n.msbHost.urlUtils.getDsbUrl(t),u=r.getFeatureParams(t);return u!=null?`${i}?&${u}`:i}static buildFeedUrl(t){let i="";(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbIconType)&&(i=`iconType=${n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbIconType}`);const u=r.getFeatureParams(t);u!=null&&(i=i?`${i}&${u}`:`${u}`);const f=n.msbHost.urlUtils.getDsbUrl(t);return i?`${f}?${i}`:f}static getFeatureParams(n){const t=r.getFeatureFlagsToSend(n);if(t.length>0){const n=t.join(",");return`setflight=${n}&features=${n}`}return undefined}static getFeatureFlagsToSend(t){function i(n,t){n&&f.push(t)}var r,u;const f=[];switch(t){case"api/v1/dsb/feed":case"api/v1/dsb/edufeed":{i(n.config.msbDsbMtCacheOff,"msbdsbmtcacheoff");i(n.msbHost.features.isMsbDsbPeopleHighlightsAnswerEnabled(),"msbdsbphs");i(n.config.msbDsbIndustryNews&&n.isMsbInternalTenant(),"msbdsbmtindustrynews");i(n.config.msbDsbIndustryNewsTimeFrameOff,"msbdsbnwstmoff");i(!n.config.msbDsbUseServerGleam,"msbdsbtenantsetoff");i(n.config.undocked,"msbdsbmtwin11");i(n.config.msbDsbWide,"msbdsbwide");i(n.config.msbDsbFileHero,"msbdsbfilehero");i(n.config.msbDsbFeedLikePeople,"msbdsbfeedlikeppl");i(n.config.msbDsbPeopleExplanationsEnabled,"msbdsbpxai");i(n.config.msbDsbOrgV2,"msbdsborgv2");i(n.config.msbEnableIconUrl,"msbdsbrtnurllg");n.msbHost.isEduTenant()&&(i(n.config.msbDsbEnableEduScenario,"msbdsbeduscon"),i(n.config.msbDsbEnableAssignmentWebUrl,"msb3samwburl"));const t=(r=n.config.msbDsbPeopleHighlightsMaxSize)!==null&&r!==void 0?r:0;i(t>0,`msbdsbphs${t}`);const f=(u=n.config.msbDsbPeopleHighlightsMockItems)!==null&&u!==void 0?u:0;i(f>0,`msbdsbphsmock${f}`);const e=n.config.msbDsbMaxM365Cards;i(e>=4,`msbdsbc${e}feed`);break}}return f}}i.MsbServiceClient=r})(i=t.ServiceClients||(t.ServiceClients={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){class i{composeDSBUrlParams(t){const i=n.getCurrentDate(),r=i.toLocaleString("en-US"),u=`clientDateTime=${encodeURIComponent(r)}&cc=${n.Host.getRegion()}&setlang=${n.getCurrentLanguage()}&dsbschemaversion=1.1`;return i<n.DateTimeReference&&n.log(`getCurrentDate() return incorrect time! getCurrentDate(): '${r}' `),n.msbHost.urlUtils.insertParameter(t,u)}async getImageOfTheDayAsync(){let t="/dsb/scenario?name=ImageOfTheDayOnly";t=this.composeDSBUrlParams(t);let i;try{const r=await fetch(t,{headers:n.Host.getCustomHeaders(null)});if(r.ok){try{i=await r.json()}catch(u){return n.DSBLogError("fetchWSBDSBCurrentImageOfTheDayData",`failed to read wsb dsb response ${JSON.stringify(i)}. Url: '${t}': ${u}.`),null}if(!i)throw`Invalid DSB content returned from '${t}'`;return i}n.DSBLogError("fetchWSBDSBCurrentImageOfTheDayData",`failed to fetch wsb dsb from ${t}`)}catch(r){return n.DSBLogError("fetchWSBDSBCurrentDayImageOfTheDayData",`failed to parse wsb dsb response ${JSON.stringify(i)}. Url: '${t}': ${r}.`),null}return null}}t.CommercialDsbServiceClient=i})(i=t.ServiceClients||(t.ServiceClients={}))})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i{constructor(){this.targetIndexAfterMoveFocus=null}reapplyKeyboardFocus(n){var i,r,u,f,e,o,s;const t=(i=this.allSelectableElementGroups)===null||i===void 0?void 0:i.findIndex(t=>{var i;return((i=t[0])===null||i===void 0?void 0:i.id)===n});if(t!==undefined){const c=(f=(u=(r=this.allSelectableElementGroups[t-1])===null||r===void 0?void 0:r[0])===null||u===void 0?void 0:u.id)===null||f===void 0?void 0:f.includes("msbdsb-dynamic-card");let h=t-1;if(!c){const n=(s=(o=(e=this.allSelectableElementGroups[t-2])===null||e===void 0?void 0:e[0])===null||o===void 0?void 0:o.id)===null||s===void 0?void 0:s.includes("msbdsb-feed-dismiss"),i=this.allSelectableElementGroups.length-1===t;i&&n&&(h=t-3)}this.targetIndexAfterMoveFocus=h}}buildInteractionModel(t){this.selectableElementGroupsInSwitch=this.buildInteractionModelInternal(n.StaticHtmlElements.msbDsbSwitch,t);this.selectableElementGroupsInBrTop=this.buildInteractionModelInternal(n.StaticHtmlElements.msbDsbBrTop,t);this.selectableElementGroupsInBrMain=this.buildInteractionModelInternal(n.StaticHtmlElements.msbDsbRoot,t);this.allSelectableElementGroups=[...this.selectableElementGroupsInSwitch,...this.selectableElementGroupsInBrTop,...this.selectableElementGroupsInBrMain]}getSelectableItems(){const n=[];return this.selectableElementGroupsInBrMain?n.concat(...this.selectableElementGroupsInBrMain):n}getSelectableItemsByGroup(){var n;return(n=this.selectableElementGroupsInBrMain)!==null&&n!==void 0?n:[]}getTopRegionSelectableItems(){const n=[];return this.selectableElementGroupsInBrTop?n.concat(...this.selectableElementGroupsInBrTop):n}getTopRegionSelectableItemsByGroup(){var n;return(n=this.selectableElementGroupsInBrTop)!==null&&n!==void 0?n:[]}getSwitchSelectableItems(){const n=[];return this.selectableElementGroupsInSwitch?n.concat(...this.selectableElementGroupsInSwitch):n}getSwitchSelectableItemsByGroup(){var n;return(n=this.selectableElementGroupsInSwitch)!==null&&n!==void 0?n:[]}resetDismissMode(){this.targetIndexAfterMoveFocus=null}createNodeIteratorFromElement(n){return n?document.createNodeIterator(n,NodeFilter.SHOW_ELEMENT,{acceptNode(n){const t=n;return(t===null||t===void 0?void 0:t.getAttribute("tabindex"))=="-1"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}):undefined}findAndUpdateSelectedItemId(){var n;const t=this.getSelectableItems().filter(n=>n.selected);this.prevSelectedItemId=(n=t===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.id}createSelectableItem(n,i=false){return{dsb:!0,isMsb:!0,id:n.id,selected:i,onSelected:()=>n.classList.add(t.MDSB_KEYBOARD_FOCUS_CLASS),onUnselected:()=>n.classList.remove(t.MDSB_KEYBOARD_FOCUS_CLASS)}}delayFocusingItem(n){sb_st(()=>{n.classList.add(t.MDSB_KEYBOARD_FOCUS_CLASS),n.focus()},1)}updateSelectedItemFocus(n,t){n.selected=!0;this.delayFocusingItem(t);this.resetDismissMode()}buildInteractionModelInternal(n,i){const u=[];i&&this.findAndUpdateSelectedItemId();const o=this.createNodeIteratorFromElement(n);let s,f,r,e;while((s=o===null||o===void 0?void 0:o.nextNode())!=null){const i=s;if(i.classList.contains(t.MDSB_LIST_CONTAINER_CLASS)){(r===null||r===void 0?void 0:r.length)&&u.push([...r]);f=i;r=[];continue}const o=i.id===this.prevSelectedItemId,n=this.createSelectableItem(i,o);if(n.selected&&this.delayFocusingItem(i),f===null||f===void 0?void 0:f.contains(s)){const e=u.length;(r===null||r===void 0?void 0:r.length)===0&&e===this.targetIndexAfterMoveFocus&&this.updateSelectedItemFocus(n,i);f.hasAttribute(t.MDSB_DELAY_BLUR_ATTRIBUTE)&&(n.hiddenAfterFocus=!0);f.hasAttribute(t.MDSB_PREVENT_SCROLL_ATTRIBUTE)&&(n.preventScroll=!0);n.id&&(r===null||r===void 0?void 0:r.push(n));continue}else(r===null||r===void 0?void 0:r.length)&&(u.push([...r]),f=undefined,r=[]);if(i.classList.contains("dismiss")){e=n;continue}else if(e&&i.classList.contains("msbdsb_feed_card_content")){const t=u.length;t===this.targetIndexAfterMoveFocus&&this.updateSelectedItemFocus(n,i);u.push([n]);u.push([e]);e=undefined}else u.length===this.targetIndexAfterMoveFocus&&this.updateSelectedItemFocus(n,i),u.push([n])}return(r===null||r===void 0?void 0:r.length)&&u.push([...r]),u}}t.KeyNavManager=i})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(n){n.MAINPAGE_CONTAINER_ID="msbdsb-mp";n.MAINPAGE_CONTAINER_SCROLL="msbdsb-mp-scroll";n.MYORGCHART_EXPANSION_STORAGE_KEY="msbdsb_moce";n.EDUCLASSES_EXPANSION_STORAGE_KEY="msbdsb_edu_cls_exp";n.EDUASSIGNMENTS_EXPANSION_STORAGE_KEY="msbdsb_edu_assi_exp";n.MDSB_KEYBOARD_FOCUS_CLASS="msbdsb_keyboard_selected";n.MDSB_LIST_CONTAINER_CLASS="msbdsb-keyboard-selectable-group";n.MDSB_INSTRUMENTED_ITEM_ATTRIBUTE="data-msb-dsb-inst-key";n.MDSB_DELAY_BLUR_ATTRIBUTE="data-msb-dsb-delay-blur";n.MDSB_PREVENT_SCROLL_ATTRIBUTE="data-msb-dsb-prevent-scroll";n.MDSB_BING_TRANSFER_ATTRIBUTE="data-msb-dsb-bing-transfer";n.MDSB_FEEDBACK_ELEMENT_CLASS="msbdsb-instrumented-feedback-element";n.VISIBLE_TOOLTIP_CLASS="msb-dsb-item-with-visible-feedback";n.TAB_NAVIGATION_TAB_INDEX=-1;n.RECOMMENDED_PEOPLE_DISPLAY_COUNT=4;n.PEOPLEHERO_PERSON_DISPLAY_COUNT=1;n.NUMBER_OF_PROFILE_COLOURS=30;n.MIN_NUMBER_OF_HERO_ITEMS=3;n.DEFAULT_SUGGESTION_CARD_CHAR_LIMIT=20;n.MDSB_POPULAR_SEARCH_ROWS=2})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){var t;(function(t){t.DEFAULT_FILE_ICON=n.ScopeConfig[n.Scope.Documents].icon;t.MIDDLE_TIER_REFRESH_RATIO=2;t.BADGING_MT_HAS_NEW_CONTENT_KEY="badging-mt-new-content";const u=20,f=360,e="mdsb-last-refresh",i="last-scope",r="wide";t.DEFAULT_BLEND_MODE="Work";const o=["Discover","Work"],s=["Discover","Blended","Work"];class h{constructor(){this.inWsbAccountSwitching=!1;this.waitingForTenantEnabled=!1;this.isVisible=!1;this.dwellStartTime=-1;this.dwellEndTime=-1;this.dwellTime=-1;this.blendModeChangedAsyncHandlers=[];this.isWideLayoutEnabled()&&this.setWideModeStyle(!0);this.keyNavManager=new t.KeyNavManager;n.msbDsbLogger=new t.MsbDsbLogger;n.msbDsbSubstrateLogger=new t.MsbDsbSubstrateLogger;this.cacheManager=new t.DataContext.CacheManager;this.msbServiceClient=n.config.msbDsbMockServiceClients?new t.ServiceClients.MsbServiceClientMock:new t.ServiceClients.MsbServiceClient(n.msbHost.tokenManager,n.msbHost.httpWrapper);this.commercialDsbServiceClient=n.config.msbDsbMockCommercialServiceClients?new t.ServiceClients.CommercialDsbServiceClientMock:new t.ServiceClients.CommercialDsbServiceClient;n.config.msbDsbDynamicBlend&&(this.dynamicBlendedDataManager=new t.DataContext.DynamicBlendedDataManager);this.externalDataManager=new t.DataContext.ExternalDataManager(this.msbServiceClient,this.cacheManager,this.commercialDsbServiceClient,this.dynamicBlendedDataManager);this.mainPageLayoutManager=new t.DataContext.MainPageLayoutManager;this.instrumentationManager=new t.InstrumentationManager(this.cacheManager);const i=new t.DataContext.RenderingMonitor(this.externalDataManager);this.recommendedPeopleViewDataManager=new t.DataContext.RecommendedPeopleViewManager(this.cacheManager);this.viewDataManager=new t.DataContext.ViewDataManager(this.externalDataManager,i,this.recommendedPeopleViewDataManager,this.mainPageLayoutManager);this.gleamManager=new t.MsbDsbGleamManager(this.cacheManager);this.loadLastSelectedScopeCacheAsync();this.msbDataModule=_w.BingAtWork;n.msbDsbFeedbackTracker=new t.MsbDsbFeedbackTracker(this.cacheManager,this.externalDataManager);n.config.msbDsbEnableBlendFeature&&this.initBlendAsync().catch(t=>{});n.Host.bindBootstrapDone(()=>this.render());n.Host.bindDismissed(()=>{n.isDynamicSearchContentPossible()&&this.externalDataManager.flushSubstrateLoggingEventsAsync(),n.config.wsbWebView2&&this.setVisibility(!1)});n.Host.bindDynamicSearchBoxUpdate(async()=>{if(this.clientQfBackgroundRefreshResolver=null,this.clientQfBackgroundRefreshRejector){const n=this.clientQfBackgroundRefreshRejector;this.clientQfBackgroundRefreshRejector=null;n()}if(this.shouldTryRefreshToken()){const t=()=>{var n;const t=this.msbDataModule&&typeof this.msbDataModule.fetchDataAndRefreshTrie=="function";if(t){this.clientQfBackgroundRefreshed=new Promise((n,t)=>{this.clientQfBackgroundRefreshResolver=n,this.clientQfBackgroundRefreshRejector=t});const t=n=>{const t=n===undefined||n;if(this.clientQfBackgroundRefreshResolver&&t){const n=this.clientQfBackgroundRefreshResolver;this.clientQfBackgroundRefreshResolver=null;this.clientQfBackgroundRefreshRejector=null;n()}};(n=this.msbDataModule)===null||n===void 0?void 0:n.fetchDataAndRefreshTrie(n=>{t(n)},n=>{t()})}};if(n.config.msbEnableAccountManager)try{await n.msbHost.accountManager.refreshMsbTokenAsync();t()}catch(i){}else return new Promise(i=>{n.msbHost.tokenManager.refreshMsbTokenAndCall(()=>{t(),i()},()=>{i()},"BindDynamicSearchBoxUpdate")})}});n.Host.bindShown(async()=>{if(n.msbHost.switchScope(),this.isMsbDsbShown()&&(this.externalDataManager.isBundleReloadColdStart()||this.externalDataManager.log3SRenderEvents(!1,!0),n.config.msbDsbBadging)){await this.setMtHasNewContentAsync(!1);const n=this.externalDataManager.getMainPageData();await this.gleamManager.updateBadgingInShownAsync(n,"MsbDsbHost.bindShown")}});n.config.msbEnableAccountManager?(n.getAccessTokenManager().bindSelectedAccountChangedBeforeConnect(()=>{this.inWsbAccountSwitching=!0}),n.msbHost.accountManager.bindAccountStatusChanged(async t=>{this.inWsbAccountSwitching=!1;const{changeType:i}=t;i==="AccountSwitchStarted"&&this.refresh(2,3);(i==="TenantSettingsDone"||i==="TenantSettingsError")&&(n.isDSBAllowedInEntryPoint()||SearchAppWrapper.CortanaApp.entryPoint=="WNSHID")&&n.isDynamicSearchContentBaseEnabled()&&((n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)||n.dsbManager.forceRefresh())})):(n.Host.bindAccountChanged(async()=>{await this.externalDataManager.clearMiddleTierResponseAsync()}),n.msbHost.tenantManager.bindTenantEnabled(()=>{n.isDSBAllowedInEntryPoint()&&n.isDynamicSearchContentBaseEnabled()&&this.checkAvailability()}))}getName(){return"MsbDsbHost"}isWideLayoutEnabled(){return n.config.msbDsbWide&&n.RuntimeConfig.AlwaysWide}isPeopleExplanationEnabled(){const t=n.uiLanguageCache.toLowerCase().startsWith("en-");return n.config.msbDsbPeopleExplanationsEnabled&&t}setWideModeStyle(t){t?n.StaticHtmlElements.msbDsbRoot.classList.add(r):n.StaticHtmlElements.msbDsbRoot.classList.remove(r)}isMsbDsbShown(t){const i=n.shouldShowDSBLayout(t);return i&&this.isEnabledInternal()}bindQueryChange(){n.Host.bindQueryChangedOrInitialized(async i=>{if(this.currentQuery=i,this.isMsbDsbShown(i))if(document.querySelector(`[data-id=${t.MAINPAGE_CONTAINER_ID}]`)||this.externalDataManager.isBundleReloadColdStart()){const r=this.instrumentationManager.getShownComponents(),i=await this.cacheManager.getDataAsync(t.DataContext.MiddleTierResponseTimeCacheKey),u=i==undefined?undefined:{cacheAge:n.getCurrentTime()-i};n.msbDsbLogger.logMainPageShownEvent(r,u);n.InstrumentationHelper.logClientInstEvent("ClientInst","MainPageShown",n.SequenceNumberManager.getSequenceNumber())}else n.msbDsbLogger.logError("Wsb Dsb Show DSB Content Failed"),n.InstrumentationHelper.logClientInstEvent("ClientInst","MainPageBlankShown",n.SequenceNumberManager.getSequenceNumber())})}async initBlendAsync(){var i,r,u;const f=(i=this.parseBlendMode(n.config.msbDsbDefaultBlendMode))!==null&&i!==void 0?i:t.DEFAULT_BLEND_MODE;if(await this.setBlendModeAsync(f,"Init"),n.msbHost.features.isMsbDsbSwitchConfigEnabled()){const i=(u=await((r=n.msbHost.settingsManager)===null||r===void 0?void 0:r.getBlendModeAsync()))!==null&&u!==void 0?u:t.DEFAULT_BLEND_MODE;await this.setBlendModeAsync(i,"Init")}}parseBlendMode(n){switch(n){case"Discover":case"Work":case"Blended":return n;default:return undefined}}getSupportedBlendModes(){return n.config.msbDsbBlendEnableBlendedMode?s:o}isBlendModeSupported(n){return n&&this.getSupportedBlendModes().indexOf(n)>=0}getBlendMode(){return this.blendMode}async setBlendModeAsync(t,i){var r;if(!n.msbHost.features.isMsbDsbBlendFeatureEnabled()&&!this.isBlendModeSupported(t)){n.dsbManager===null||n.dsbManager===void 0?void 0:n.dsbManager.forceRenderOnlyRefresh();return}if(t!=this.blendMode){const u=this.blendMode;if(this.blendMode=t,i=="UserSelected")try{await((r=n.msbHost.settingsManager)===null||r===void 0?void 0:r.setBlendModeAsync(t))}catch(f){}const e={previousBlendMode:u,nextBlendMode:t,reason:i},o=this.blendModeChangedAsyncHandlers.map(async t=>{try{await t(e)}catch(i){}});Promise.all(o);n.dsbManager===null||n.dsbManager===void 0?void 0:n.dsbManager.forceRenderOnlyRefresh()}}bindBlendModeChanged(n){this.blendModeChangedAsyncHandlers.push(n)}isInDiscoverMode(){return n.msbHost.features.isMsbDsbBlendFeatureEnabled()&&this.blendMode==="Discover"&&n.msbHost.isTenantMsbEnabled()}isInWorkMode(){return n.msbHost.features.isMsbDsbBlendFeatureEnabled()&&this.blendMode==="Work"&&n.msbHost.isTenantMsbEnabled()}isInBlendedMode(){if(!n.config.msbDsbBlendEnableBlendedMode)return!1;const t=n.getAccessTokenManager(),i=(t===null||t===void 0?void 0:t.isMsaAvailable())&&(t===null||t===void 0?void 0:t.isAadAvailable());return i&&this.blendMode==="Blended"&&n.msbHost.features.isMsbDsbBlendFeatureEnabled()}isEnabled(){const t=this.isEnabledInternal();return n.msbHost.isTenantMsbEnabled()||(this.waitingForTenantEnabled=!0),t!==null&&t!==void 0?t:!1}isEnabledInternal(){var t;return!n.shouldDisplayMsbDsbInWorkScope((t=this.currentQuery)===null||t===void 0?void 0:t.isWorkScopeZI)&&(this.isOffWorkHourDisabledAad()||this.isInDiscoverMode())?!1:n.msbHost.isTenantMsbEnabled()&&!n.msbHost.isGccTenant()}isOffWorkHourDisabledAad(){return!n.config.msbDsbOffHour||!n.msbHost.isTenantMsbEnabled()||n.msbHost.isGccTenant()||n.msbHost.isEduTenant()?!1:this.isCurrentTimeInOffWorkHour()&&!this.isInBlendedMode()}isWeekendOffWorkHour(t){return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.dsbWeekendOn)||n.isWeekend(t)}getRemainingTimeToWorkStartHour(){const r=n.getCurrentTime(),i=n.getCurrentDate(),t=new Date(i),u=this.getWorkStartHour();return t.setHours(u,0,0,0),i>t&&t.setDate(i.getDate()+1),Math.floor((t.getTime()-r)/6e4)}isInNextWorkTimePeriod(n){return this.isTimeInWorkHour(n)}isCurrentTimeInOffWorkHour(){const t=n.getCurrentDate();return!this.isTimeInWorkHour(t)}isTimeInWorkHour(n){const i=this.getWorkStartHour(),r=this.getWorkEndHour(),t=n.getHours();return t>=i&&t<r&&!this.isWeekendOffWorkHour(n)}getWorkStartHour(){var t;return(t=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.dsbWorkStartHour)!==null&&t!==void 0?t:n.config.msbDsbWorkStartHour}getWorkEndHour(){var t;return(t=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.dsbWorkEndHour)!==null&&t!==void 0?t:n.config.msbDsbWorkEndHour}getUpdateIntervalMins(){return n.msbHost.isEduTenant()?f:u}getDynamicSearchBoxContent(){return this.gleamManager.getDynamicSearchBoxContent()}async refresh(t,i){if(!this.inWsbAccountSwitching)try{if(this.isEnabled()){const r=this.createRefreshParameters(t,i);if(r.shouldFetch&&!this.externalDataManager.canFetchMainPageData())return;n.LightweightStorage.setItem(e,n.getCurrentTime().toString());const u=n.getCurrentTime();n.msbDsbSubstrateLogger.startNewRefresh(u);n.msbDsbLogger.startNewRefresh();await this.externalDataManager.refreshAsync(r)}}catch(r){n.msbDsbLogger.logError("Wsb Dsb Uncaught Refresh Error",undefined,n.stringifyError(r),"MsbDsbHost::refresh")}}setVisibility(t){this.isVisible=t;n.setVisibility(n.StaticHtmlElements.msbDsbRoot,t);const i=t&&this.externalDataManager.isBlendedTopRegionDataReady();n.setVisibility(n.StaticHtmlElements.msbDsbBrTop,!!i)}getVisibility(){return this.isVisible}safeCallAllowSuspension(){const t=()=>{sb_st(()=>{n.dsbManager.allowSuspension()},1)};if(this.clientQfBackgroundRefreshResolver&&this.clientQfBackgroundRefreshed){const i=this.clientQfBackgroundRefreshed;this.clientQfBackgroundRefreshed=null;i.then(()=>t()).catch(t=>{})}else t()}getSelectableItems(){return this.keyNavManager.getSelectableItems()}getSelectableItemsByGroup(){return this.keyNavManager.getSelectableItemsByGroup()}getTopRegionSelectableItems(){return this.keyNavManager.getTopRegionSelectableItems()}getTopRegionSelectableItemsByGroup(){return this.keyNavManager.getTopRegionSelectableItemsByGroup()}hasContent(){return!0}getCodexStatus(){return""}shouldUpdateGleamAndTimeInterval(){var t;return!n.shouldDisplayMsbDsbInWorkScope((t=this.currentQuery)===null||t===void 0?void 0:t.isWorkScopeZI)}getInstrumentProps(){return this.instrumentationManager.getInstrumentProps()}getLocString(t,...i){return n.Host.getLocString(t,...i)}setLastSelectedScope(t){n.Host.switchToScope(t);this.setLastSelectedScopeCacheAsync(t);n.dsbManager.forceRefresh()}getLastSelectedScope(){return this.lastSelectedScope}isConsumerContentEnabled(){return!n.Host.isFirstPartySearchDisabled()}async setMtHasNewContentAsync(n){await this.cacheManager.setDataAsync(t.BADGING_MT_HAS_NEW_CONTENT_KEY,n)}async getMtHasNewContentAsync(){return await this.cacheManager.getDataAsync(t.BADGING_MT_HAS_NEW_CONTENT_KEY)}setWsbQuery(t,i){var r,u;const f=(u=(r=n.ScopeConfig===null||n.ScopeConfig===void 0?void 0:n.ScopeConfig[i])===null||r===void 0?void 0:r.prefixes)===null||u===void 0?void 0:u[0],e=f?`${f}: ${t}`:t;n.Host.reformulateNonForcedMiniSerp(e,!0,undefined);n.Host.searchBoxHasFocus()||n.Host.setFocusInSearchBox(null,"msbDsb setWsbQuery")}getFormCode(t){return n.mapOSFormCode(t?"EDSB10":"MDSB10")}updateInteractionModel(n){this.keyNavManager.buildInteractionModel(n)}getSuggestionsData(){return this.externalDataManager.getSuggestionsData()}async dismissAnswerAsync(n,t,i){await this.externalDataManager.dismissAnswerAsync(t,n,i)}getDismissedAnswers(){var n;return(n=this.externalDataManager.getDismissalHistory().dismissedAnswers)!==null&&n!==void 0?n:[]}createRefreshParameters(n,t){const i=(n&1)==1,r=i&&t!=2,u=(n&6)==2,f=t===1;return{shouldFetch:r,shouldRender:u,isBackgroundUpdate:f}}render(){n.safeExecute(()=>ReactDOM.render(React.createElement(t.Components.MsbDsbContainer),n.StaticHtmlElements.msbDsbRoot),"MsbDsbHost_render");n.config.msbDsbDynamicBlend&&n.StaticHtmlElements.msbDsbBrTop&&n.safeExecute(()=>ReactDOM.render(React.createElement(t.Components.MsbDsbTopContainer),n.StaticHtmlElements.msbDsbBrTop),"MsbDsbHost_render_top")}shouldTryRefreshToken(){const t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return t!=1?!1:(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbForceDsbTokenRefresh)?!0:n.msbHost.isTenantRecentlyEnabled()}checkAvailability(){this.waitingForTenantEnabled&&this.isEnabled()&&(this.waitingForTenantEnabled=!1,n.dsbManager.forceRefresh())}setDwellStartTime(n){this.dwellStartTime=n}setDwellEndTime(n){this.dwellEndTime=n}getDwellStartTime(){return this.dwellStartTime}getDwellEndTime(){return this.dwellEndTime}resetDwellTime(){this.dwellStartTime=-1;this.dwellEndTime=-1;this.dwellTime=-1}setDwellTime(n){this.dwellTime=n}getDwellTime(){return this.dwellTime}isDwellStarted(){return this.getDwellStartTime()!=-1}async setLastSelectedScopeCacheAsync(t){const r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();r==1&&(this.lastSelectedScope=t,await this.cacheManager.setDataAsync(i,t))}async loadLastSelectedScopeCacheAsync(){const r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();if(r==1){const t=await this.cacheManager.getDataAsync(i);this.lastSelectedScope=t?t:undefined}}instrumentDSBDwellTime(){}logGleamSetup(t,i,r){const u=n.getCurrentDate().toString(),f=n.AccessTokenManager.getWindowsAccountType(),e=n.msbHost.getTenantMsbStatus(),o=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isTenantRecentlyEnabled(),s=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.shouldForceEnterprise(),h=SearchAppWrapper.CortanaApp.entryPoint,c=JSON.stringify(n.Host.getQuery()),l=i?JSON.stringify(i===null||i===void 0?void 0:i.getDynamicSearchBoxContent()):null,a={dateString:u,accountType:f,caller:r,tenantMsbStatus:e,isTenantRecentlyEnabled:o,shouldForceEnterprise:s,entryPoint:h,hostQuery:c,vmContent:l};_w.bfbWsbTel&&bfbWsbTel.logValue("GleamSetup",t,a)}}t.MsbDsbHost=h})(t=n.MsbDsb||(n.MsbDsb={}))}(WSB||(WSB={})),function(n){const t="RWQ";class i{constructor(){this.getName=()=>"MsbDsbRecentQueryDataProvider"}fetch(n,i){if(n.enabledDataSources[t]){const n=this.getResponse();i(t,n)}}onRemove(t,i){n.msbDsbHost&&n.msbDsbHost.dismissAnswerAsync(t,"RecentQueries",!0).then(()=>{i&&i()}).catch(()=>{})}getResponse(){var t;let i=this.getQueries();const r=(t=n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.getDismissedAnswers())!==null&&t!==void 0?t:[];return i=i.filter(n=>!r.includes(n.id)),{queries:i,remove:this.onRemove}}getQueries(){var t,i;return n.MockUrlParameters&&typeof n.MockedRecentWorkQueriesData=="object"?n.MockedRecentWorkQueriesData:(i=(t=n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.getSuggestionsData())===null||t===void 0?void 0:t.recentQueries)!==null&&i!==void 0?i:[]}}n.MsbDsbRecentQueryDataProvider=i}(WSB||(WSB={})),function(n){class t{parse(t,i,r,u,f,e){var o;const s=[];for(const r of(o=u===null||u===void 0?void 0:u.queries)!==null&&o!==void 0?o:[]){if(!f())break;n.safeExecute(()=>{const f=this.createSuggestionFromQuery(t,r,i),e={verb:"HideFromRecentHistory",displayName:n.Host.getLocString("HideFromRecentHistory"),executeSync:()=>{u.remove&&(u.remove(r.id,()=>{n.Host.refreshCurrentPane()}),delete u.remove)},icon:{content:"&#xE711",type:2}};n.setExtraVerbs(f,()=>[e],!1);s.push(f)},"RecentQuerySuggestionsParser")}e(r,s,null)}getSuggestionTypeForQuery(n){switch(n.canvas){case"Outlook":return"RSHOUT";case"Teams":return"RSHTMS";case"Sharepoint":return"RSHSP";case"BingWorkSearch":return"RSHB"}}createSuggestionFromQuery(t,i,r){const f=this.getSuggestionTypeForQuery(i),e=`recent_query${r}_${i.id}`,o=n.InstrumentedItem.createInstrumentedItem(r,f),s={type:0,content:n.getImageUrl("ODSWG.442929a6-6384-4694-91ac-b644cd4c77a3")},h=()=>{n.Host.switchToScope(n.Scope.Work,i.query)},u=n.createSuggestion(t,i.query,undefined,s,f,i.query,o,998,r,!0,e,h,!1,e);return u.lastLaunchTime=i.searchTime,u.tooltip=i.query,u.narratorText=i.query,u}}n.MsbDsbRecentQuerySuggestionsParser=t}(WSB||(WSB={}))